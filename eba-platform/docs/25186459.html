<!DOCTYPE html>
<html>
    <head>
        <title>Design note - Environment &amp; Release Management V1.x</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Design note - Environment &amp; Release Management V1.x
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <h2 id="Designnote-Environment&amp;ReleaseManagementV1.x-/*&lt;![CDATA[*/div.rbtoc1455124464106{padding:0px;}div.rbtoc1455124464106ul{list-style:disc;margin-left:0px;}div.rbtoc1455124464106li{margin-left:0px;padding-left:0px;}/*]]&gt;*/ReleaseDatabase#Designnote-Environmen"><style type='text/css'>/*<![CDATA[*/
div.rbtoc1455124464106 {padding: 0px;}
div.rbtoc1455124464106 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1455124464106 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1455124464106'>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-ReleaseDatabase'>Release Database</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-EbsaReleasePlugin'>Ebsa Release Plugin</a>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-GlobalConfiguration'>Global Configuration</a>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Version1.5ChangestoGlobalConfiguration'>Version 1.5 Changes to Global Configuration</a></li>
</ul>
</li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-CreateaComponentVersion'>Create a ComponentVersion</a>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps'>Build steps</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Execution'>Execution</a></li>
</ul>
</li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-CreateanApplicationVersion'>Create an ApplicationVersion</a>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Parameters'>Parameters</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps.1'>Build steps</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Execution.1'>Execution</a></li>
</ul>
</li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Createareportofitemsinthedatabase'>Create a report of items in the database</a>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps.2'>Build steps</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Execution.2'>Execution</a></li>
</ul>
</li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-DeployacomponentusingtheSelfServicefacility'>Deploy a component using the Self Service facility</a>
<ul class='toc-indentation'>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Parameters.1'>Parameters</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps.3'>Build steps</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Execution.3'>Execution</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Outputs'>Outputs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-ChangesrequiredtotheComponentDeployfeaturetosupportdeploymentstoSTandNP'>Changes required to the ComponentDeploy feature to support deployments to ST and NP</a></li>
<li><a href='#Designnote-Environment&amp;ReleaseManagementV1.x-Summary'>Summary</a></li>
</ul>
</div></h2><h2 id="Designnote-Environment&amp;ReleaseManagementV1.x-ReleaseDatabase">Release Database</h2><p>

<map id="gliffy-map-25433089-879" name="gliffy-map-25433089-879"></map>
<table width="100%" class="gliffy-macro-table">
    <tr>
        <td >
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
 </caption>

                <tr>
                    <td>
                        <img style="border: none; width: 892px;" usemap="#gliffy-map-25433089-879" src="attachments/25186459/25433090.png" alt="" class="gliffy-macro-image"/>
                    </td>
                </tr>
            </table>
 
        </td>
    </tr>
</table>


</p><p>The diagram above shows the tables contained in the EBSA release database.  All of the tables are present in V1.0 of the environment management tools except for the ApplicationVersionDeployment table which is present in only V2.0 of the environment management tools suite. See <a href="https://<confluenceurl>/display/EN/Release+database+V3.x">Release database V3.x</a> for the additional tables added in V3.</p><h2 id="Designnote-Environment&amp;ReleaseManagementV1.x-EbsaReleasePlugin">Ebsa Release Plugin</h2><p>This is a Jenkins plugin that provides the following features</p><h3 id="Designnote-Environment&amp;ReleaseManagementV1.x-GlobalConfiguration">Global Configuration</h3><p>Certain global configuration is needed for the Release Management function.  It can be found in the &quot;Manage Jenkins &gt; Configure System&quot; area. Go the Configure system page, scroll down the page until you find the&quot;Ebsa Release Management&quot; section.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="411" width="912" src="attachments/25186459/25433122.png" data-image-src="attachments/25186459/25433122.png" data-unresolved-comment-count="0" data-linked-resource-id="25433122" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="GlobalConfiguration.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>In this section you will be able to configure the application to connect to a database using the fields provided.  Be aware that the jp_rm_prd database is the production database and no testing systems should be connected to this database.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Version1.5ChangestoGlobalConfiguration">Version 1.5 Changes to Global Configuration</h4><p>In version 1.5 (introduction of self service to NP and ST) some new Global Configuration was introduced.  The screen now looks as per the image below.  Changes are:</p><ul><li>Renamed &quot;EBSA Release Management&quot; section to &quot;EBSA Release Management Database&quot;</li><li>Added &quot;Ebsa Yum Servers&quot; section to capture the yum FQDN, scp user and scp folder for each environment.  The Ebsa YUM servers are used by the Component deployment feature.  Depending on the target environment selected by the users (e.g. &quot;st&quot; or &quot;np&quot;) it will populate the CD_YUM_SERVER, CD_YUM_SCP_USER and CD_YUM_SCP_PATH differently.  It does this by matching the environment selected to the &quot;Environment Prefix field in this configuration)</li><li>Added &quot;Ebsa Environment Management&quot; section (this is version 2.0 and is present but remains inert)</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="904" width="930" src="attachments/25186459/25433344.png" data-image-src="attachments/25186459/25433344.png" data-unresolved-comment-count="0" data-linked-resource-id="25433344" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2014-9-24 12:7:33.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><h3 id="Designnote-Environment&amp;ReleaseManagementV1.x-CreateaComponentVersion">Create a ComponentVersion</h3><p>This feature allows us to create a Jenkins job which will insert a row into the ComponentVersion table.  In Jenkins Click on &quot;<strong>New Item</strong>&quot; and then select &quot;<strong>Build a free-style software project</strong>&quot; and give the new job a relevant name.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps">Build steps</h4><p>On the job configuration screen, add a build step to create a ComponentVersion as follows:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="338" width="365" src="attachments/25186459/25433094.png" data-image-src="attachments/25186459/25433094.png" data-unresolved-comment-count="0" data-linked-resource-id="25433094" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAComponentVersion add a build step.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>Then configure the fields as follows:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="412" width="749" src="attachments/25186459/25433095.png" data-image-src="attachments/25186459/25433095.png" data-unresolved-comment-count="0" data-linked-resource-id="25433095" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAComponentVersion build step.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>Note the ${VARIABLE_NAME} declarations, this shows that we can use environment variable substitution.  One use of this is to add parameters to the build and use the values of the parameters in the build step.  Note the last field is a drop-down.  This drop-down allows the user to select the application for which they will be making ComponentVersions.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Execution">Execution</h4><p>When we build this job it will use the values in the configuration fields to create a new row in the ComponentVersion table.  There is very little validation on purpose.  No fields are mandatory.</p><p>When &quot;Build&quot; or &quot;Build with parameters&quot;  is clicked the code plugin will create a new row in theComponentVersion table</p><p>The following log extracts form the job console shows some of the output.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="477" width="1410" src="attachments/25186459/25433124.png" data-image-src="attachments/25186459/25433124.png" data-unresolved-comment-count="0" data-linked-resource-id="25433124" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAComponentVersion log.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><h3 id="Designnote-Environment&amp;ReleaseManagementV1.x-CreateanApplicationVersion">Create an ApplicationVersion</h3><p>This feature allows us to create a Jenkins job which will insert a row into the ApplicationVersion table.  In Jenkins Click on &quot;<strong>New Item</strong>&quot; and then select &quot;<strong>Build a free-style software project</strong>&quot; and give the new job a relevant name.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Parameters">Parameters</h4><p>On the job configuration screen, you need to add a special type of parameter as well as a special type of build step.</p><p>First add a parameter.  Check the checkbox that stays &quot;This build is parameterised&quot; and then select &quot;IPT Application Version parameter&quot; from the drop down menu.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="370" width="270" src="attachments/25186459/25433104.png" data-image-src="attachments/25186459/25433104.png" data-unresolved-comment-count="0" data-linked-resource-id="25433104" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAnApplicationVersion add a Parameter.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>You will then need to save the job and go back into the configuration screen for the list of Applications to become visible.  This is a known defect which can be fixed given the right priority.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="136" width="961" src="attachments/25186459/25433106.png" data-image-src="attachments/25186459/25433106.png" data-unresolved-comment-count="0" data-linked-resource-id="25433106" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAnApplicationVersion configureParameter.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>Once you can see the list of Applications, select the one which you will be creating ApplicationVersions for as per the screenshot above.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps.1">Build steps</h4><p>Now go and add a build step.  To do this, select the &quot;Release a new version of an IPT Application&quot; from the &quot;Add a build step&quot; drop down.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="338" width="329" src="attachments/25186459/25433107.png" data-image-src="attachments/25186459/25433107.png" data-unresolved-comment-count="0" data-linked-resource-id="25433107" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAnApplicationVersion add a BuildStep.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>No configuration is required for this step.  It will simply appear on the configuration screen as follows:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="95" width="757" src="attachments/25186459/25433108.png" data-image-src="attachments/25186459/25433108.png" data-unresolved-comment-count="0" data-linked-resource-id="25433108" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAnApplicationVersion configureBuildStep.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Execution.1">Execution</h4><p>In order to run the job, you will now need to use the &quot;Build with parameters&quot; link, instead of the &quot;Build&quot; link.  The &quot;Build&quot; link will no longer be avaliable.</p><p>When the build starts you will be presented with a screen similar to the following image.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="1204" width="1080" src="attachments/25186459/25433109.png" data-image-src="attachments/25186459/25433109.png" data-unresolved-comment-count="0" data-linked-resource-id="25433109" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAnApplicationVersion buildWithParameters.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>The screen contains</p><ul><li>a list of all of the components associated with the IPT Application that you have selected during configuration.  Next to each of the components will be a list of each of the versions for that component.</li><li>A series of text fields which allow the user to enter data (no validation is applied to these fields)</li><li>A &quot;build&quot; button</li></ul><p>The user will select a version for each of the components (or &quot;–&quot; if they wish to exclude it from the release)  and then click &quot;Build&quot;. </p><p>When &quot;Build&quot; is clicked the code plugin will create a new row in the ApplicationVersion table and associate it with all of the selected ComponentVersions.</p><p>The following log extracts form the job console shows some of the output.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="375" width="1500" src="attachments/25186459/25433110.png" data-image-src="attachments/25186459/25433110.png" data-unresolved-comment-count="0" data-linked-resource-id="25433110" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateAnApplicationVersion log.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><h3 id="Designnote-Environment&amp;ReleaseManagementV1.x-Createareportofitemsinthedatabase">Create a report of items in the database</h3><p>This feature allows us to create a Jenkins job which will produce a HTML report which contains all of the rows in selected tables.  In Jenkins Click on &quot;<strong>New Item</strong>&quot; and then select &quot;<strong>Build a free-style software project</strong>&quot; and give the new job a relevant name.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps.2">Build steps</h4><p>On the job configuration screen, add a build step to &quot;Generate a report which shows all IPT Component Versions&quot; as follows:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="359" width="336" src="attachments/25186459/25433111.png" data-image-src="attachments/25186459/25433111.png" data-unresolved-comment-count="0" data-linked-resource-id="25433111" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateReport add a build step.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>Then configure the fields as follows:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="271" width="1125" src="attachments/25186459/25433112.png" data-image-src="attachments/25186459/25433112.png" data-unresolved-comment-count="0" data-linked-resource-id="25433112" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="CreateReport configure.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>The Release report field is mandatory but the Template field is optional.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Execution.2">Execution</h4><p>There are 5 tables and each of them can be accessed by placing its token in the Template field.  The template allows the fields to be wrapped in a HTML structure which suites the needs to the person viewing the report.</p><p>The reports are as follows:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Report</th><th class="confluenceTh">Token</th><th class="confluenceTh">Fields</th></tr><tr><td class="confluenceTd">Application Release table - A list of all application releases by BRP release</td><td class="confluenceTd">@applicationreleasereport@</td><td class="confluenceTd"><ul><li>Release ID</li><li>Application</li><li>Application Name</li><li>Application Version</li><li>Version ID</li><li>Components</li><li>Notes</li></ul></td></tr><tr><td class="confluenceTd">Application table - a list of all Applications</td><td class="confluenceTd">@applicationreport@</td><td class="confluenceTd"><ul><li>ID</li><li>Name</li></ul></td></tr><tr><td class="confluenceTd">Application Version Deployment table - a list of all deployments of ApplicationVersions (only in V2.0)</td><td class="confluenceTd">@applicationversiondeploymentreport@</td><td class="confluenceTd"><ul><li>Application Version</li><li>Id</li><li>Environment</li><li>Succeeded</li><li>Date started</li><li>Date ended</li><li>JenkinsBuildId</li></ul></td></tr><tr><td class="confluenceTd">Application Version table - a list of all ApplicationVersions and their associated ComponentVersions</td><td class="confluenceTd">@applicationversionreport@</td><td class="confluenceTd"><ul><li>Application</li><li>Id</li><li>Name</li><li>Version</li><li>JIRA ID</li><li>BRPF/BTD ID&quot;);</li><li>DateCreated</li><li>Components</li><li>Notes</li></ul></td></tr><tr><td class="confluenceTd">ComponentVersion table - a list of all ComponentVersions (Note, in production this table is well over 4000 rows)</td><td class="confluenceTd">@componentversionreport@</td><td class="confluenceTd"><ul><li>Application</li><li>Id</li><li>Name</li><li>Date created</li><li>Group</li><li>Artifact</li><li>Version</li><li>Classifier</li><li>Packaging</li><li>RPM Package</li><li>Type</li></ul></td></tr></tbody></table></div><h3 id="Designnote-Environment&amp;ReleaseManagementV1.x-DeployacomponentusingtheSelfServicefacility">Deploy a component using the Self Service facility</h3><p>Once a component has been added to the ComponentVersion table then it can be said to be a candidate for deployment into other environments. </p><p>This feature allows us to create a Jenkins job which will initiate the deployment of a component (represented by a ComponentVersion) into the environment of choice of the user executing the job.  </p><p>In Jenkins Click on &quot;<strong>New Item</strong>&quot; and then select &quot;<strong>Build a free-style software project</strong>&quot; and give the new job a relevant name.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Parameters.1">Parameters</h4><p>On the job configuration screen, you need to add a special type of parameter as well as a special type of build step.</p><p>First add a parameter.  Check the checkbox that stays &quot;This build is parameterised&quot; and then select &quot;IPT Component Deployment parameter&quot; from the drop down menu.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="366" width="245" src="attachments/25186459/25433134.png" data-image-src="attachments/25186459/25433134.png" data-unresolved-comment-count="0" data-linked-resource-id="25433134" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent add a Parameter.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>The parameter is configured by selecting an Application and by putting in a location where the Hieradata files can be loaded.</p><p>The hieradata files are taken straight out of GIT and on the CI Jenkins we have a job (EBSA_TOOLS_PUPPETHIERADB_FETCH) which fetches the latest hieradata from GIT every 1 minute or so.</p><ul><li>The Puppet Hieradata location provides the dataset for the environment selection.</li><li>The Application provides the dataset for the ComponentVersion selection</li></ul><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="156" width="716" src="attachments/25186459/25433135.png" data-image-src="attachments/25186459/25433135.png" data-unresolved-comment-count="0" data-linked-resource-id="25433135" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent configureParameter.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Buildsteps.3">Build steps</h4><p>Now the build steps need to be configured.</p><p>First add a &quot;Trigger a remote parameterized job&quot; build step</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="324" width="367" src="attachments/25186459/25433136.png" data-image-src="attachments/25186459/25433136.png" data-unresolved-comment-count="0" data-linked-resource-id="25433136" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent add a RemoteBuildStep.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>And configure it as per the details below</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="554" width="1475" src="attachments/25186459/25433137.png" data-image-src="attachments/25186459/25433137.png" data-unresolved-comment-count="0" data-linked-resource-id="25433137" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent configureRemoteJob.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>Now add an &quot;Execute shell&quot; build step</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="314" width="340" src="attachments/25186459/25433139.png" data-image-src="attachments/25186459/25433139.png" data-unresolved-comment-count="0" data-linked-resource-id="25433139" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent add a EXECUTEStep.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>And configure it as per the confgig below.  This will fetch the log from the remote server so that the user can see what happened.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="197" width="1466" src="attachments/25186459/25433140.png" data-image-src="attachments/25186459/25433140.png" data-unresolved-comment-count="0" data-linked-resource-id="25433140" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent configureFetchLog.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Execution.3">Execution</h4><p>When the user selects &quot;Build with parameters&quot; they will be presented with the screen below.  They need to select an version of a component, as well as a environment and a role.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="1400" width="1188" src="attachments/25186459/25433141.png" data-image-src="attachments/25186459/25433141.png" data-unresolved-comment-count="0" data-linked-resource-id="25433141" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="DeployComponent buildWithParameters.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="25186459" data-linked-resource-container-version="19"></span></p><p>When they click &quot;Build&quot; the component they selected will be deployed to the environment that they selected.</p><p>The &quot;Role details&quot; in the screen shot above shows the software which can be found in the &quot;system:: packages&quot; section of the yaml file in the roel drop down.  It is there for convenience purposes so that the user can use it as a reference when they have selected an environment.</p><h4 id="Designnote-Environment&amp;ReleaseManagementV1.x-Outputs">Outputs</h4><p>The Component Deploy facility produces three outputs. </p><ul><li>The first is a set of environment variables which get set in the build which contain information relating to the users choices and other environmental factors.  These environment variables are used by follow on build steps to pass data to downstream processes.</li><li>The second is a properties file called &quot;deploy.properties&quot; which it writes into the job workspace folder.  This contains a listing of all of the properties for the build, including those which have been added by the process.  This file provides a great way of knowing the exact values which the tool outputs and can be used during testing to quickly validate certain outputs without having to execute the rest of the downstream processes.</li><li>The third output is a csv file called &lt;uuid&gt;.csv (where uuid is a universally unique identifier) which contains a comma separated set of values which can be used as input to the createrepo-q-tool to populate the yum repository.</li></ul><p>The following table lists the environment variables which get inserted into the build by the component deployment code.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">KEY</th><th class="confluenceTh">Example value</th></tr><tr><td class="confluenceTd">CD_APPLICATION_ID</td><td class="confluenceTd">4</td></tr><tr><td class="confluenceTd">CD_APPLICATION_NAME</td><td class="confluenceTd">Shared Service Bus Simulators</td></tr><tr><td class="confluenceTd">CD_ARTIFACT</td><td class="confluenceTd">pkiss-simulator-rpm</td></tr><tr><td colspan="1" class="confluenceTd">CD_CLASSIFIER</td><td colspan="1" class="confluenceTd">often blank but an example might be &quot;-win&quot;</td></tr><tr><td colspan="1" class="confluenceTd">CD_COMPONENTVERSION_ID</td><td colspan="1" class="confluenceTd">6852</td></tr><tr><td colspan="1" class="confluenceTd">CD_COMPONENTVERSION_NAME</td><td colspan="1" class="confluenceTd">SSB_PKISS_SIMULATOR_RPM</td></tr><tr><td colspan="1" class="confluenceTd">CD_CSV_PATH</td><td colspan="1" class="confluenceTd">/var/lib/jenkins/jobs/DEPLOY_COMPONENT_VERSION/yumupdate_e3122571-3cfa-48c0-9524-71fb99532127.csv</td></tr><tr><td colspan="1" class="confluenceTd">CD_ENVIRONMENT</td><td colspan="1" class="confluenceTd">st-collab1</td></tr><tr><td colspan="1" class="confluenceTd">CD_ENVIRONMENT_XML</td><td colspan="1" class="confluenceTd">IPT_ST_COLLAB1</td></tr><tr><td colspan="1" class="confluenceTd">CD_FILTER</td><td colspan="1" class="confluenceTd">role=app</td></tr><tr><td colspan="1" class="confluenceTd">CD_GROUP</td><td colspan="1" class="confluenceTd">gov.uk.homeoffice</td></tr><tr><td colspan="1" class="confluenceTd">CD_PACKAGING</td><td colspan="1" class="confluenceTd">rpm</td></tr><tr><td colspan="1" class="confluenceTd">CD_ROLE</td><td colspan="1" class="confluenceTd">role\=app</td></tr><tr><td colspan="1" class="confluenceTd">CD_RPM_PACKAGE_NAME</td><td colspan="1" class="confluenceTd">pkiss-simulator-rpm</td></tr><tr><td colspan="1" class="confluenceTd">CD_TYPE</td><td colspan="1" class="confluenceTd">often blank but an example might be &quot;zip&quot;</td></tr><tr><td colspan="1" class="confluenceTd">CD_VERSION</td><td colspan="1" class="confluenceTd">0.0.370-1</td></tr><tr><td colspan="1" class="confluenceTd">CD_YAML</td><td colspan="1" class="confluenceTd">st/st-collab1/app.yaml</td></tr><tr><td colspan="1" class="confluenceTd">CD_YUM_SCP_PATH</td><td colspan="1" class="confluenceTd">/home/jenkins</td></tr><tr><td colspan="1" class="confluenceTd">CD_YUM_SCP_USER</td><td colspan="1" class="confluenceTd">jenkins</td></tr><tr><td colspan="1" class="confluenceTd">CD_YUM_SERVER</td><td colspan="1" class="confluenceTd">ym.st-tooling1.ipt.local</td></tr></tbody></table></div><h2 id="Designnote-Environment&amp;ReleaseManagementV1.x-ChangesrequiredtotheComponentDeployfeaturetosupportdeploymentstoSTandNP">Changes required to the ComponentDeploy feature to support deployments to ST and NP</h2><p>TO allow deployments to ST we needed to</p><ul><li>enhance the UI to allow the selection of NP environments in the environment drop down.. You will now see a prefix (np or st) in front of every environment in the drop down.</li><li>Enhance the output of the plugin by<ul><li>Creating the output csv file and an accompanying environment variable (CD_CSV_PATH)</li><li>Provide additional logic to select the correct yum repository details and specify their values in new environment variables (CD_YUM_SCP_PATH, CD_YUM_SCP_USER, CD_YUM_SERVER)</li></ul></li></ul><h2 id="Designnote-Environment&amp;ReleaseManagementV1.x-Summary">Summary</h2><p>The items in this document show the features available in V1.0 of the Self Service deployment tool, otherwise known as the environment-management tools.</p>
                    </div>

                                        
                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
