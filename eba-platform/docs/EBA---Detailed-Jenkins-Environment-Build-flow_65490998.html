<!DOCTYPE html>
<html>
    <head>
        <title>EBA - Detailed Jenkins Environment Build flow</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            EBA - Detailed Jenkins Environment Build flow
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <p>The Jenkins user flow looks like this;</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65493360.bmp" data-image-src="attachments/65490998/65493360.bmp" data-unresolved-comment-count="0" data-linked-resource-id="65493360" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Jenkins_build_flow.bmp" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/bmp" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p> </p><p> </p><p>(1) Load up Jenkins - Environment Build</p><p> </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490989.png" data-image-src="attachments/65490998/65490989.png" data-unresolved-comment-count="0" data-linked-resource-id="65490989" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (12).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p> </p><p>2) Click &quot;Build with parameters&quot; in the top left and you get this screen;</p><p> </p><p> </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490980.png" data-image-src="attachments/65490998/65490980.png" data-unresolved-comment-count="0" data-linked-resource-id="65490980" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (1).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p> </p><p> </p><p>3) Click on &quot;Environment Build&quot; (this corresponds to the &quot;Jenkins Job List&quot; orange box in the diagram at the top)</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65490998/65492132.png" data-image-src="attachments/65490998/65492132.png" data-unresolved-comment-count="0" data-linked-resource-id="65492132" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="jenkinsjoblist1.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490981.png" data-image-src="attachments/65490998/65490981.png" data-unresolved-comment-count="0" data-linked-resource-id="65490981" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (3).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p>4) Select the environment and action as desired; (this corresponds to the select environment:action box in the diagram above)</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65490998/65492131.png" data-image-src="attachments/65490998/65492131.png" data-unresolved-comment-count="0" data-linked-resource-id="65492131" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="environmentaction2.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490982.png" data-image-src="attachments/65490998/65490982.png" data-unresolved-comment-count="0" data-linked-resource-id="65490982" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (5).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p>Then select the version for that environment from the pull-down box; (selecting the environment will populate the versions from the database on the fly)</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65490998/65492130.bmp" data-image-src="attachments/65490998/65492130.bmp" data-unresolved-comment-count="0" data-linked-resource-id="65492130" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="version3.bmp" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/bmp" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490983.png" data-image-src="attachments/65490998/65490983.png" data-unresolved-comment-count="0" data-linked-resource-id="65490983" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (6).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p>Looking at the screen we have these fields;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"> </th><th class="confluenceTh">Sample Value</th><th colspan="1" class="confluenceTh">Notes</th><th class="confluenceTh">Data Source</th></tr><tr><td class="confluenceTd">Cloud provider</td><td class="confluenceTd">Amazon or Skyscape</td><td colspan="1" class="confluenceTd">This will cause the plan to be executed in either Amazon or Skyscape</td><td class="confluenceTd">index.jelly file</td></tr><tr><td class="confluenceTd">Environment</td><td class="confluenceTd">&quot;HO_IPT_PR_PRD1_DAZO:HDNIM03 Build&quot;</td><td colspan="1" class="confluenceTd"><p>This value is a 2-part string separated with a colon.</p><p>The first part is the name of the environment as according to <a href="EBA---Infrastructure-Naming-Standards_58295113.html">EBA - Infrastructure Naming Standards</a></p><p>The second part is the action, which is the link back to the build plan and identifies the sequence(s) that will be applied to those environments. E.g. the sequences labelled &quot;create&quot; may take all steps necessary to build the given environment in the correct order so firewalls and loadbalancers may be created before the database servers etc.</p><p>In this case, the Action part of the string is &quot;HDNIM03 Build&quot; which tells the user the HDNIM03 (from <a href="VM-Role-Identifiers_24382975.html">VM Role Identifiers</a>, HDN is a Hadoop Data Node, from <a href="EBA---Infrastructure-Naming-Standards_58295113.html#EBA-InfrastructureNamingStandards-vmhostname">EBA - Infrastructure Naming Standards</a> the fourth-character of &quot;I&quot; says it's in Compartment I, the fifth character of M says it uses &quot;Management&quot; traffic, and the &quot;03&quot; is an instance number) host (within the HO_IPT_PR_PRD1_DAZO environment - read as &quot;Home Office, Immigration Platform Technologies, Production, Data Access Zone&quot;) will be built. This is a naming convention so to guarantee what the script actually does you would need to look inside it.</p><p>The build plan is assembled manually and re-used between environments</p><p>Note the list of environments based on the user's LDAP roles (so that only production-cleared users can see and deploy to production). If you're not seeing the Environments, check your LDAP entries.</p></td><td class="confluenceTd"><p>Git (i.e. Stash) (the Jenkins plugin code clones the git &quot;management&quot; repo to Jenkin's local working directory and then reads it from there)</p><p> </p><p>The &quot;action&quot; string is the Displayname from the build plan (not the execution plan), which is a human readable summary of the sequences it will carry out.</p></td></tr><tr><td colspan="1" class="confluenceTd">Environment container</td><td colspan="1" class="confluenceTd">Not used</td><td colspan="1" class="confluenceTd">Leave this blank</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">Version</td><td colspan="1" class="confluenceTd">0.12, 0.13 etc</td><td colspan="1" class="confluenceTd">This is the version of the environment design to apply the build plan to. Normally you would use the latest version unless you needed an older one e.g. for a rollback or to investigate an issue.</td><td colspan="1" class="confluenceTd"><p>This comes from the Visio Version Information tab originally, which gets imported into the Environment Database by the import job. Jenkins looks up this information from the database once the Environment has been selected</p></td></tr></tbody></table></div><p> </p><p>5) Click &quot;Generate Plan&quot; (this will not physically change any servers), and review the output</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65490998/65492129.bmp" data-image-src="attachments/65490998/65492129.bmp" data-unresolved-comment-count="0" data-linked-resource-id="65492129" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="review4.bmp" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/bmp" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490985.png" data-image-src="attachments/65490998/65490985.png" data-unresolved-comment-count="0" data-linked-resource-id="65490985" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (8).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p> </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490986.png" data-image-src="attachments/65490998/65490986.png" data-unresolved-comment-count="0" data-linked-resource-id="65490986" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (9).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p> </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65490998/65490987.png" data-image-src="attachments/65490998/65490987.png" data-unresolved-comment-count="0" data-linked-resource-id="65490987" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Screenshot (10).png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p> </p><p>6) When you have reviewed this and are ready to execute this plan on actual servers, click &quot;Build&quot;.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65490998/65492128.bmp" data-image-src="attachments/65490998/65492128.bmp" data-unresolved-comment-count="0" data-linked-resource-id="65492128" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="execute5.bmp" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/bmp" data-linked-resource-container-id="65490998" data-linked-resource-container-version="14"></span></p><p>This will call the Environment build code (see <a href="EBA---Environment-Build-Automation---an-overview_65477488.html">EBA - Environment Build Automation - an overview</a>; it calls the  <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-plugin" rel="nofollow">environment-build-plugin</a> to run <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-metadata-export" rel="nofollow">environment-build-metadata-export</a> code to export the data from the database in the appropriate format for Skyscape/Amazon, and then iterates over the Build Plan and sends the commands to ACloud or executes them over SSH). This use of ACloud is nearly identical to the <a href="EBA---ACloud_61115560.html">EBA - ACloud</a> open-sourced tool; it's the same jar file, just called multiple times from within the Java code (as called from Jenkins) with parameters in the &quot;Generate Plan&quot; output. See step 3 on <a href="EBA---Key-Functional-Interactions_65482098.html#EBA-KeyFunctionalInteractions-sequencediagram1">EBA - Key Functional Interactions</a> sequence diagram)</p><h2 id="EBA-DetailedJenkinsEnvironmentBuildflow-Pluginconfiguration">Plugin configuration</h2><p>The plugin is configured in the &quot;EBSA Environment Build&quot; section of the Jenkins System Configuration (Jenkins-&gt;Manage Jenkins-&gt;Configure System). This includes database connection settings, the location of the Environment Build Tool engine CLI, and whether to filter the list of environments based on the user's LDAP roles.</p><p>Can be run in a local Jenkins instance using ebsa-ci-components\Function\environment-build-plugin\run.sh (from Git Bash if using Windows). To attach a remote debugger from eclipse:</p><ol><li>Run &gt; Debug Configurations...</li><li>Right click Remote Java Application then New</li><li>Choose Project: environment-build-plugin and Port: 5005 (this matches the address value set on the MAVEN_OPTS command line in run.sh)</li><li>Add the environment-build-plugin project on the Source tab</li><li>Click Debug</li></ol><p>The Jenkins Environment Build plugin is built by the EBSA_ENVIRONMENT_BUILD_PLUGIN_FLOW job on Dev Jenkins.</p><p>The Jenkins Environment Build plugin is packaged as a Jenkins plugin in the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/ServiceDescription/environment-build-plugin-rpm" rel="nofollow">environment-build-plugin-rpm</a> which is built by the EBSA_ENVIRONMENT_BUILD_PLUGIN_RPM_BUILD job on Dev Jenkins.</p><p>The Jenkins Environment Build plugin is deployed to Environment Management Jenkins using the EBSA_ENVIRONMENT_BUILD_PLUGIN_PUPPET_DEPLOY job on Dev Jenkins.</p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p>
                    </div>

                                        
                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
