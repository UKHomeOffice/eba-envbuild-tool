<!DOCTYPE html>
<html>
    <head>
        <title>EBA - Build Plans</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            EBA - Build Plans
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <h2 id="EBA-BuildPlans-Introduction">Introduction</h2><p>The Build Plan is an XML file that contains the sequence of steps required to build a given environment. It can contain instructions to generate multiple Execution plans that can be passed to ACloud to have the infrastructure built, plus SSH and Puppet calls. Build plans are designed to be</p><ul><li>Re-usable - the sequences of steps used for one environment are generic, and can be re-used elsewhere</li><li>Extensible - sequences can call other sequences, hence complex behaviors can be built up</li><li>Modular - the build plans are kept in files and can be easily split up or combined into functional modules</li></ul><h2 id="EBA-BuildPlans-Structure">Structure</h2><p>Build plan xml files can be viewed as a collection of XML-scripts (which are a number of steps which complete a process, not shell scripts) and a mechanism to link one or more of these scripts to specific environments. The XSD file and sample XML can be found here;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><a href="attachments/29039733/29231815.xsd" rel="nofollow">EnvironmentBuildSequence-1.0.xsd</a></td><td class="confluenceTd"><a href="attachments/29039733/29231816.xml" rel="nofollow">EnvironmentBuildSequenceExample.xml</a></td></tr></tbody></table></div><h3 id="EBA-BuildPlans-EnvironmentBuildXSD"> Environment Build XSD</h3><p>Each XML file has</p><ul><li>an optional set of globalparameters, things like timeouts and the location of the Puppet Master server.</li><li>an optional set of environment names it applies to</li><li>a set of builds it can do - e.g. update, create, which have a master list of sequences to be called to e.g. update or create those environments</li><li>a set of sequences (which can themselves call other sequences) representing what needs to be done - in top-down order - to perform that build action</li><li>each sequence can have a set of steps which have an &quot;action&quot; as an attribute (shown as the green arrow in the diagram below)</li><li>each action represents a physical command to be ran, whether that's <br /><ul><li>an &quot;infra&quot; command to run ACloud and run an Execution plan to instantiate a VM (there will be an &quot;Execution Plan&quot; shown in the &quot;Generate Plan&quot; output in Jenkins for each infra-action called from the build plan)</li><li>an &quot;osconfig&quot; command to configure a VM, used as the second command after creating a VM <span> </span><span style="color: rgb(0,128,0);"> </span></li><li><span style="color: rgb(0,128,0);"><span style="color: rgb(0,0,0);">a &quot;call&quot; command (not used)</span></span></li><li><span style="color: rgb(0,128,0);"><span style="color: rgb(0,0,0);">a &quot;SSH&quot; command to kick off Puppet or similar (there will be an &quot;command&quot; shown in the &quot;Generate Plan&quot; output in Jenkins for each infra-action called from the build plan)<br /></span></span></li></ul></li></ul><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65491060/65491019.png" data-image-src="attachments/65491060/65491019.png" data-unresolved-comment-count="0" data-linked-resource-id="65491019" data-linked-resource-version="3" data-linked-resource-type="attachment" data-linked-resource-default-alias="EnvironmentBuildSequence-1.0.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65491060" data-linked-resource-container-version="15"></span></p><p>In UML format:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/29039733/29231724.png" data-image-src="attachments/29039733/29231724.png" data-unresolved-comment-count="0" data-linked-resource-id="29231724" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="EnvironmentBuildSequencemodel.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="29039733" data-linked-resource-container-version="6"></span></p><p> </p><h2 id="EBA-BuildPlans-BaseActionsbaseactions">Base Actions <span class="confluence-anchor-link" id="EBA-BuildPlans-baseactions"></span></h2><p>During the crafting of a Build Plan, there are some pre-defined Base Actions and Base Sequences that one might use for the common tasks. They serve as an abstraction to the low-level commands that needs to be executed throughout an environment build process, and they contribute to modularisation of the commonly used tasks.</p><p>Below is a listing of currently available base actions:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong>Action Name<br /></strong></p></td><td class="confluenceTd"><p><strong>Description</strong></p></td><td class="confluenceTd"><p><strong>Parameters</strong></p></td></tr><tr><td class="confluenceTd"><p>run_puppet</p></td><td class="confluenceTd"><p>Sends a request to MCollective which in turn requests a puppet agent run on a server or a set of servers within an environment.</p></td><td class="confluenceTd"><ul><li>puppet_master</li><li>jumphosts</li><li>sshopts (ssh options)</li><li>domain</li><li>params (list of other mco parameters)</li></ul></td></tr><tr><td class="confluenceTd"><p>retrieve_configuration</p></td><td class="confluenceTd">Synchronises the Puppet configuration.</td><td class="confluenceTd"><ul><li>puppet_master</li><li>jumphosts</li><li>sshopts (ssh options)</li></ul></td></tr><tr><td class="confluenceTd"><p>poll_vms</p></td><td class="confluenceTd"><p>Because the aCloud Client API to power on a VM is asynchronous, Jenkins will show a successful run of the Call_ACloud_Client job within a few seconds. This job will continually poll the MCollective daemon on a server until it responds to ping requests.</p></td><td class="confluenceTd"><ul><li>puppet_master</li><li>jumphosts</li><li>sshopts (ssh options)</li><li>environment</li><li>params (a space-separated list of all the additional parameters including the list of servers to poll the MCollective daemon on)</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_vapp</td><td colspan="1" class="confluenceTd">Creates a vApp (vCloud)</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_vapp</td><td colspan="1" class="confluenceTd">Deletes a vApp</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">undeploy_vapp</td><td colspan="1" class="confluenceTd">Undeploy a vApp</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">assign_org_networks</td><td colspan="1" class="confluenceTd">Assign org networks to vApp</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>network-pattern</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_vapp_networks</td><td colspan="1" class="confluenceTd">Create application networks</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_vapp_networks</td><td colspan="1" class="confluenceTd">Delete application networks</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>network-pattern</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_vms</td><td colspan="1" class="confluenceTd">Create VMs</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_vms_filtered</td><td colspan="1" class="confluenceTd">Create a subset of VMs based on the filter. This can be used while building compartmentalised vApps.</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>vms</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_vms_wait</td><td colspan="1" class="confluenceTd"><p>Create the requested VMs and then wait for their state to become 'running' before continuing. Intended for use with AWS.</p></td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>vms</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">start_vms</td><td colspan="1" class="confluenceTd">Starts the VMs. Only needed for VCloud since AWS inherently does that.</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>vms</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">stop_vms</td><td colspan="1" class="confluenceTd">Stops the VMs. Only needed for VCloud since AWS inherently does that.</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>vms</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_vms</td><td colspan="1" class="confluenceTd">Delete the VMs</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li><li>vms</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">start_vapp</td><td colspan="1" class="confluenceTd">Starts all non-started VMs in the vApp. Only needed for VCloud since AWS inherently does that.</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">stop_vapp</td><td colspan="1" class="confluenceTd">Stops all non-started VMs in the vApp. Only needed for VCloud since AWS inherently does that.</td><td colspan="1" class="confluenceTd"><ul><li>vapp_name</li><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_org_networks</td><td colspan="1" class="confluenceTd"><p>Creates any org networks matching the network-pattern that don't yet exist and ignores any that do. Note that changes to existing org networks will also be ignored so this cannot be used to 'patch-up' existing networks.</p></td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li><li>network-pattern</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_new_org_networks</td><td colspan="1" class="confluenceTd">Creates new org networks and fails if any networks matching the network-pattern already exist.</td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li><li>network-pattern</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">confirm_org_networks</td><td colspan="1" class="confluenceTd"><p>Confirms that the org networks exist.</p></td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li><li>network-pattern</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_org_networks</td><td colspan="1" class="confluenceTd">Deletes the matching org networks.</td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li><li>network-pattern</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_edgegateway</td><td colspan="1" class="confluenceTd">Creates an Edge Gateway.</td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li><li>gateway_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_edgegateway</td><td colspan="1" class="confluenceTd">Deletes an Edge Gateway.</td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li><li>gateway_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create_vpc</td><td colspan="1" class="confluenceTd">Creates a VPC.</td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_vpc</td><td colspan="1" class="confluenceTd">Deletes a VPC.</td><td colspan="1" class="confluenceTd"><ul><li>container_name</li><li>env_name</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">internal_hiera</td><td colspan="1" class="confluenceTd">Generate internal hiera</td><td colspan="1" class="confluenceTd"><ul><li>hiera_zones</li><li>hiera_repo_url</li><li>routes_xls (Excel file name)</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">firewall_hiera</td><td colspan="1" class="confluenceTd">Generate firewall hiera</td><td colspan="1" class="confluenceTd"><ul><li>hiera_zones</li><li>hiera_repo_url</li><li>routes_xls (Excel file name)</li></ul></td></tr></tbody></table></div><p> </p><h2 id="EBA-BuildPlans-BaseSequences">Base Sequences</h2><p>Base Sequences are abstractions over the Actions in order to represent most used set of actions in a more practical way.As such, all the parameters that are needed by the included actions, must be provided in order to make use of a Sequence.</p><p>Below is a listing of currently available Base Sequences.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong>Sequence Name<br /></strong></p></td><td class="confluenceTd"><p><strong>Description</strong></p></td><td class="confluenceTd"><p><strong>Included Actions<br /></strong></p></td></tr><tr><td class="confluenceTd"><p>start-wait-run-puppet</p></td><td class="confluenceTd"><p>Start VMs and wait for them to come up</p><p> </p></td><td class="confluenceTd"><ul><li>start_vms</li><li>poll_vms</li><li>run_puppet</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">create-vapp-and-networks</td><td colspan="1" class="confluenceTd">Creates a vApp and its internal networks. Assumes Org networks alreaady exist</td><td colspan="1" class="confluenceTd"><ul><li>create_vapp</li><li>assign_org_networks</li><li>create_vapp_networks</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_vapp</td><td colspan="1" class="confluenceTd">Graceful delete of the vApps</td><td colspan="1" class="confluenceTd"><ul><li>stop_vapp</li><li>undeploy_vapp</li><li>delete_vapp</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">delete_vms</td><td colspan="1" class="confluenceTd">Graceful delete of the VMs</td><td colspan="1" class="confluenceTd"><ul><li>stop_vms</li><li>delete_vms</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">init</td><td colspan="1" class="confluenceTd">Init step that pretty much every build does</td><td colspan="1" class="confluenceTd"><ul><li>retrieve_configuration</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">register-dnsand-do-bau-puppet-run</td><td colspan="1" class="confluenceTd">DNS Registration and BAU puppet ran</td><td colspan="1" class="confluenceTd"><ul><li>run_puppet</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">ext_dns_run_puppet</td><td colspan="1" class="confluenceTd">External DNS run is always performed on the mgt node of the management domain.</td><td colspan="1" class="confluenceTd"><ul><li>run_puppet</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">puppet-dns-run</td><td colspan="1" class="confluenceTd">DNS Registration</td><td colspan="1" class="confluenceTd"><ul><li>run_puppet</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">mw-deploy-patch-config</td><td colspan="1" class="confluenceTd">Runs separate deployment patch and config puppet runs for middleware on the given host.</td><td colspan="1" class="confluenceTd"><ul><li>run_puppet</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">app-deploy-patch-config</td><td colspan="1" class="confluenceTd">Runs separate deployment patch and config puppet runs for applications on the given host.</td><td colspan="1" class="confluenceTd"><ul><li>run_puppet</li></ul></td></tr><tr><td colspan="1" class="confluenceTd">mw-config-app-deploy-patch-config</td><td colspan="1" class="confluenceTd">Full app deploy, patch and config with addition mw config first</td><td colspan="1" class="confluenceTd"><ul><li>run_puppet</li></ul></td></tr></tbody></table></div><h2 id="EBA-BuildPlans-Hiera">Hiera</h2><p>To generate hiera there are two actions in the Environment Build Plan XML:</p><pre><code>&lt;internalhiera zones=&quot; zone1, zone2&quot; routespath=&quot;path/to/xls&quot; routesrepourl=&quot;git://testroutes.git&quot; hierarepourl=&quot;git://testhiera.git&quot; updatebehaviour=&quot;overwrite-all&quot;&gt;
    &lt;scope yamlpath=&quot;somepath/going/here&quot;/&gt;
    &lt;zone zone=&quot;HO_IPT_ZONE1&quot;/&gt;
    &lt;scope yamlpath=&quot;someother/path&quot;/&gt;
    &lt;zone zone=&quot;HO_IPT_ZONE2&quot;/&gt;
&lt;/internalhiera&gt;

&lt;firewallhiera zones=&quot;zoneA , zoneB&quot; firewallpath=&quot;path/to/firewall/xls&quot; firewallrepourl=&quot;git://firewall.git&quot; hierarepourl=&quot;git://hiera.git&quot; updatebehaviour=&quot;add-and-update-only&quot;&gt;
    &lt;scope yamlpath=&quot;somepath/going/here&quot;/&gt;
    &lt;zone zone=&quot;HO_IPT_ZONE1&quot;/&gt;
    &lt;scope yamlpath=&quot;someother/path&quot;/&gt;
    &lt;zone zone=&quot;HO_IPT_ZONE2&quot;/&gt;
&lt;/firewallhiera&gt;
</code></pre><p>Here, the enclosed zone elements are optional. They just let you specify zones in a different way.</p><ul><li>zones: are the zones to generate hiera for. They must be in the environment you are building. The hierarepourl is a git URL to where the hiera goes.</li><li>firewallrepourl and firewallrepourl: are git URLs to where the spreadsheets are and the firewallpath and routespath are the paths from the root of the repos to the excel spreadsheet.</li><li>updatebehaviour: is either &quot;overwrite-all&quot; which will remove all hiera that is not generated or &quot;add-and-update-only&quot; means do not remove existing rules.</li><li>scope: add scope elements to only alter yaml under the given paths. Adding more scope elements is additive. This is particularly useful when using overwrite-all, so that only yaml in scope is removed if it is not generated.</li></ul><h2 id="EBA-BuildPlans-Workedexample">Worked example</h2><p>We'll start at the top by looking at this environment-script link and then progress down to the actions which scripts ultimately call. For simplicity, we'll look at the composure of one zone and a single 'create' plan for HO_IPT_NP_PRP2_COBC in the following sections.</p><h4 id="EBA-BuildPlans-Environments">Environments</h4><p>In order to link PRP2 COBC to a build plan, we add the following snippet:<br /><br /></p><div><div class="syntaxhighlighter nogutter  java"><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">&lt;eb:environment name=</code><code class="java string">&quot;HO_IPT_NP_PRP2_COBC&quot;</code><code class="java plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">    </code><code class="java plain">&lt;eb:buildref id=</code><code class="java string">&quot;cobc-all&quot;</code> <code class="java plain">displayname=</code><code class="java string">&quot;Create&quot;</code> <code class="java plain">buildid=</code><code class="java string">&quot;cobc&quot;</code><code class="java plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="java spaces">        </code><code class="java plain">&lt;eb:parameter name=</code><code class="java string">&quot;vapp_name&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;HO_IPT_NP_PRP2_COBC&quot;</code><code class="java plain">/&gt;</code></div><div class="line number4 index3 alt1"><code class="java spaces">        </code><code class="java plain">&lt;eb:parameter name=</code><code class="java string">&quot;jumphosts&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;${np_puppet_jumphosts}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number5 index4 alt2"><code class="java spaces">        </code><code class="java plain">&lt;eb:parameter name=</code><code class="java string">&quot;environment&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;${vapp_name}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="java spaces">        </code><code class="java plain">&lt;eb:parameter name=</code><code class="java string">&quot;domain&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;np-prp2-cobc.ipt.ho.local&quot;</code><code class="java plain">/&gt;</code></div><div class="line number7 index6 alt2"><code class="java spaces">        </code><code class="java plain">&lt;eb:parameter name=</code><code class="java string">&quot;puppet_master&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;${np_puppet_host}&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number8 index7 alt1"><code class="java spaces">        </code><code class="java plain">&lt;eb:parameter name=</code><code class="java string">&quot;mtzo_env&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;HO_IPT_NP_TLG1_MTZO&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number9 index8 alt2"><code class="java spaces">    </code><code class="java plain">&lt;/eb:buildref&gt;</code></div><div class="line number10 index9 alt1"><code class="java plain">&lt;/eb:environment&gt;</code></div></div></td></tr></tbody></table></div><p> </p></div></div><p>Here, the 'buildref' node has a unique identifier ('cobc-all'), a display name and a buildid, used to identify which plan will be used when a user selects to build this zone. A number of parameters are also set here. These are available for use within the plan itself (as we'll see in the next section). Note that a number of buildref nodes could be added for this environment. This is useful, for example, when creating individual build plans for compartments within the same zone (DABC, DAZO etc)</p><h4 id="EBA-BuildPlans-Builds">Builds</h4><p>The buildref above identifed build 'cobc' as the plan to use. Build cobc looks like this:<br /><br /></p><div><div class="syntaxhighlighter nogutter  java"><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">&lt;eb:build id=</code><code class="java string">&quot;cobc&quot;</code><code class="java plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">    </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;init&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number3 index2 alt2"><code class="java spaces">    </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;cobc&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number4 index3 alt1"><code class="java plain">&lt;/eb:build&gt;</code></div></div></td></tr></tbody></table></div><p> </p></div></div><p>Builds are merely made up of a number of sequences, each of which has an id.</p><h4 id="EBA-BuildPlans-Sequences">Sequences</h4><p>The sequences referenced by a build are defined like this:<br /><br /></p><div><div class="syntaxhighlighter nogutter  java"><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><div class="container" title="Hint: double-click to select code"><div class="line number1 index0 alt2"><code class="java plain">&lt;eb:sequence id=</code><code class="java string">&quot;cobc&quot;</code><code class="java plain">&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;mrt_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;role=mrt&quot;</code><code class="java plain">/&gt;</code></div><div class="line number3 index2 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;afc_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;role=afc&quot;</code><code class="java plain">/&gt;</code></div><div class="line number4 index3 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;afw_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;role=afw&quot;</code><code class="java plain">/&gt;</code></div><div class="line number5 index4 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;mco_mrt_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;-s 2 -f ${mrt_filter}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;mco_afc_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;-s 2 -f ${afc_filter}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number7 index6 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;mco_afw_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;-s 2 -f ${afw_filter}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number8 index7 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:param name=</code><code class="java string">&quot;mco_all_filter&quot;</code> <code class="java plain">value=</code><code class="java string">&quot;-s 11&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number9 index8 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;create-vapp-and-networks&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number10 index9 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:step actionid=</code><code class="java string">&quot;create_vms&quot;</code><code class="java plain">/&gt;</code></div><div class="line number11 index10 alt2"><code class="java spaces">  </code><code class="java plain">&lt;!-- MRTs first--&gt;</code></div><div class="line number12 index11 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;start-wait-run-puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;vms=mrt.*,poll_params=${mco_mrt_filter},ppt_filter=-F ${mrt_filter}&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number13 index12 alt2"><code class="java spaces">  </code><code class="java plain">&lt;!-- Start *all* firewalls (AFC and AFW) then poll </code><code class="java keyword">for</code> <code class="java plain">and puppet run AFC--&gt;</code></div><div class="line number14 index13 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;start-wait-run-puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;vms=afw.*|afc.*,poll_params=${mco_afc_filter},ppt_filter=-F ${afc_filter}&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number15 index14 alt2"><code class="java spaces">  </code><code class="java plain">&lt;!-- Then poll and puppet run on AFW --&gt;</code></div><div class="line number16 index15 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:step actionid=</code><code class="java string">&quot;poll_vms&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;params=${mco_afw_filter}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number17 index16 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:step actionid=</code><code class="java string">&quot;run_puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;params=${afw_filter} ${ppt_tags}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number18 index17 alt1"><code class="java spaces">  </code><code class="java plain">&lt;!-- Then start everything </code><code class="java keyword">else</code> <code class="java plain">--&gt;</code></div><div class="line number19 index18 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;start-wait-run-puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;vms=.*, poll_params=-s 11, ppt_filter=${ppt_base_os_tags}&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number20 index19 alt1"><code class="java spaces">  </code><code class="java plain">&lt;!-- External DNS puppet run --&gt;</code></div><div class="line number21 index20 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:sequenceref sequenceid=</code><code class="java string">&quot;ext_dns_run_puppet&quot;</code><code class="java plain">/&gt;</code></div><div class="line number22 index21 alt1"><code class="java spaces">  </code><code class="java plain">&lt;!-- Deploy middleware --&gt;</code></div><div class="line number23 index22 alt2"><code class="java spaces">  </code><code class="java plain">&lt;eb:step actionid=</code><code class="java string">&quot;run_puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;params=${ppt_mw_install_tag}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number24 index23 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:step actionid=</code><code class="java string">&quot;run_puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;params=${ppt_mw_config_tag}&quot;</code><code class="java plain">/&gt;</code></div><div class="line number25 index24 alt2"><code class="java spaces">  </code><code class="java plain">&lt;!-- BAU puppet run --&gt;</code></div><div class="line number26 index25 alt1"><code class="java spaces">  </code><code class="java plain">&lt;eb:step actionid=</code><code class="java string">&quot;run_puppet&quot;</code> <code class="java plain">context=</code><code class="java string">&quot;params=${ppt_all_bau_param} ${ppt_base_os_tags}&quot;</code> <code class="java plain">/&gt;</code></div><div class="line number27 index26 alt2"><code class="java plain">&lt;/eb:sequence&gt;</code></div></div></td></tr></tbody></table></div><p> </p></div></div><p>Notice the following features:</p><ul><li>A sequence may call other sequences (for example, 'create-vapp-and-network' or steps ('create_vms')</li></ul><ul><li>sequences may define parameters in the same way builds can. In the process of traversing the tree, parameters from the build level will be combined with parameters from the sequence level and passed onwards to subsequences and steps</li><li>Parameter values can contain placeholders (denoted by ${xxx} notation). <ul><li>For example, parameter <span><em>mco_mrt_filter</em> has a value of '-s 2 -f ${mrt_filter}'</span></li><li><span><span>parameters <em>mrt_filter</em> has a value of '<span>role=mrt'</span></span></span></li><li><span><span>so once the placeholder has been resolved, parameter <em>mco_mrt_filter</em> will have a value of '-s 2 -f role=mrt'</span></span></li><li><span><span>Placeholders may reference parameters defined further up the tree from parent sequences or the build</span></span></li></ul></li></ul><h4 id="EBA-BuildPlans-Steps"><span><span>Steps</span></span></h4><p><span><span>Steps are the basic building block that can be executed, and they refer to the <a href="#EBA-BuildPlans-baseactions">Base Actions</a> above<br /></span></span></p>
                    </div>

                                        
                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
