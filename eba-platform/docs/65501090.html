<!DOCTYPE html>
<html>
    <head>
        <title>EBA - Virtual Machine(VM) Templates</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            EBA - Virtual Machine(VM) Templates
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <p>The following is aligned to the IPT Programme Base Operating System Design v0.8 dated 28/09/2014.</p><p class="Bodycopy">This document will provide the detailed design for the base operating systems used within the IPT programme.</p><p class="Bodycopy">This document will only consider two base operating systems - a CentOS 6 64 bit OS and a RHEL 6 64 bit OS; the base operating system design will be elaborated as needed to include additional operating systems and additional versions, as a full set of base operating systems are identified as a result of engagement with the development partners.</p><p class="Bodycopy">The base operating system design does not cover the provisioning of virtual machines or their sizing, other than stating a minimum disk, memory, CPU, and network configuration that will be defaulted within the private catalogue templates.</p><p>The document has been tested with CentOS 6.5 and RedHat 6.5.  The design is likely to apply to other versions of the same family i.e. RedHat 6.6 and CentOS 6.6, but cannot be said with certainty.  When a new version is released testing will confirm the designs appropriateness.</p><h1 id="EBA-VirtualMachine(VM)Templates-DesignPrincipals">Design Principals</h1><p class="Bodycopy">The following design principals have been applied to this design:</p><ul><li>The base virtual machine image held within the hosting providers private catalogue for each OS comprises of only a basic operating system install - i.e. an out of the box basic installation with minimal software packages installed.</li><li>Once virtual machines are instantiated from catalogue templates, the basic operating system foundation will be built upon with layers of configuration, patches and additional software installations using Puppet Enterprise. N.B. The distinction between settings applied to the base operating system image and those settings applied on top of the base operating system using Puppet will be clearly defined within this document.</li><li>All access, tooling and test environment virtual machines will be built using a set of industry recognised recommended policies.  At an operating system level, guidance from the Centre for Internet Security (CIS) will be used to harden the operating system build.  Where relevant, all level 1 standards have been incorporated into the design and configuration for the base operating systems in scope – when there has been non-compliance to the CIS level 1 standards, these are noted within this document.  The relevant CIS benchmark standards for RHEL [<a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a>] and CentOS [<a href="https://benchmarks.cisecurity.org/tools2/CIS_CentOS_Linux_6_Benchmark_v1.0.0.pdf" class="external-link" rel="nofollow">CIS CentOS Linux 6 Benchmark</a>] have been used, to avoid duplication only references to the RHEL benchmark have been provided throughout this document.</li><li>Any base operating system software that is not required is not installed.  This provides operating systems that have smaller footprints, which are inherently easier to manage, require less patching and are more secure.</li><li>A kickstart file will be used as part of the base operating system installation to define the low level operating system attributes that will be configured within that install.</li><li>The base operating system choice is the latest available satisfying CIS requirement 1.7 (Use Latest OS)</li></ul><h1 id="EBA-VirtualMachine(VM)Templates-PackageSelection">Package Selection</h1><h2 id="EBA-VirtualMachine(VM)Templates-BaseOS">Base OS</h2><p>Base CentOS and RHEL operating system images are created using the ‘nobase’ installation option, which installs a minimal set of operating system packages.  In addition to the minimal set, a small number of additional packages are required to be installed to enable some basic trouble shooting functions, enable connectivity to Puppet Enterprise (a Puppet agent) and enable tools to manage the VM (VMWare tools).  The full list of additional packages that are installed, are listed within the table below:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Package</p></th><th class="confluenceTh"><p>Description</p></th></tr><tr><td class="confluenceTd"><p>man</p></td><td class="confluenceTd"><p>Online software documentation</p></td></tr><tr><td class="confluenceTd"><p>openssh-clients</p></td><td class="confluenceTd"><p>Package that includes SSH and SCP to enable connectivity to the virtual machines</p></td></tr><tr><td class="confluenceTd"><p>vim-minimal</p></td><td class="confluenceTd"><p>Text editor, used for problem determination and configuration</p></td></tr><tr><td class="confluenceTd"><p>wget</p></td><td class="confluenceTd"><p>Used to connect to URLs over https, e.g. to copy files from the remote virtual machines to the local machine e.g. from the Yum repository.</p></td></tr><tr><td class="confluenceTd"><p>telnet</p></td><td class="confluenceTd"><p>Client for the telnet communication protocol, to test connectivity</p></td></tr><tr><td class="confluenceTd"><p>pe-puppet</p></td><td class="confluenceTd"><p>Puppet Enterprise agent, used to enable the virtual machine to communicate with the puppet master.</p></td></tr><tr><td class="confluenceTd"><p>pe-mcollective</p></td><td class="confluenceTd"><p>Puppet Enterprise agent, used to orchestrate change on a VM.</p></td></tr><tr><td class="confluenceTd"><p>vmware-tools-esx-nox</p></td><td class="confluenceTd"><p>VMware tools, used to provide connectivity into the virtualisation layer e.g. to set IP addresses</p></td></tr><tr><td class="confluenceTd"><p>vmware-tools-esx-kmods</p></td><td class="confluenceTd"><p>VMware tools, used to provide connectivity into the virtualisation layer e.g. to set IP addresses</p></td></tr></tbody></table></div><p>These software packages are installed from a software repository (Yum) within the Tooling virtual application.  This software is automatically installed at the time that the operating system images are created, as part of the kickstart configuration file (<span style="color: rgb(255,0,0);"><strong><a href="#EBA-VirtualMachine(VM)Templates-BaseImageKickstart">Base Image Kickstart</a></strong></span>).</p><h2 id="EBA-VirtualMachine(VM)Templates-PuppetModifications">Puppet Modifications</h2><p>Once a virtual machine is instantiated with a base operating system, Puppet Enterprise will be used to install a set of additional software packages that are required by EBSA to manage the operating system.  These additional packages are installed using Puppet Enterprise to ensure that they can be controlled by the EBSA configuration management tools.  The packages are described in the table below:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p><strong>Package</strong></p></th><th class="confluenceTh"><p><strong>Description</strong></p></th></tr><tr><td class="confluenceTd"><p>vim-common</p></td><td class="confluenceTd"><p>Text editor, used for problem determination and configuration</p></td></tr><tr><td class="confluenceTd"><p>vim-enhanced</p></td><td class="confluenceTd"><p>Text editor, used for problem determination and configuration</p></td></tr><tr><td class="confluenceTd"><p>nc</p></td><td class="confluenceTd"><p>Netcat - used for testing network communications</p></td></tr><tr><td class="confluenceTd"><p>nmon</p></td><td class="confluenceTd"><p>Nigels Monitor - used for system monitoring</p></td></tr><tr><td class="confluenceTd"><p>ntpd</p></td><td class="confluenceTd"><p>Network Time Protocol Daemon - used for regular time synchronisation with a network time source</p></td></tr><tr><td class="confluenceTd"><p>ntpdate</p></td><td class="confluenceTd"><p>Network Time Protocol - used for instant time synchronisation with a network time source, e.g. used on start up or to query an NTP timestamp</p></td></tr><tr><td class="confluenceTd"><p>openssl</p></td><td class="confluenceTd"><p>Libraries to support open SSL</p></td></tr><tr><td class="confluenceTd"><p>sssd</p></td><td class="confluenceTd"><p>System Security Services Daemon - provides a set of daemons to manage access to remote directories and authentication mechanisms</p></td></tr><tr><td class="confluenceTd"><p>sssd-client</p></td><td class="confluenceTd"><p>The configurable client for sssd</p></td></tr><tr><td class="confluenceTd"><p>sysstat</p></td><td class="confluenceTd"><p>Provides a set of performance monitoring tools, such as sar, IO stat and topas</p></td></tr><tr><td class="confluenceTd"><p>xorg-x11-xauth</p></td><td class="confluenceTd"><p>Enables X11 connections to forwarded to an X11 client, e.g. to support x-windows connections from a desktop machine (with the x-windows client) to headless virtual machine.</p></td></tr><tr><td class="confluenceTd"><p>bind-utils</p></td><td class="confluenceTd"><p>Domain name lookup utilities</p></td></tr><tr><td class="confluenceTd"><p><ins>mlocate</ins></p></td><td class="confluenceTd"><p><ins>Provides the ability to quickly search the file</ins><ins> </ins><ins>system for a given file</ins></p></td></tr><tr><td class="confluenceTd"><p>zip</p></td><td class="confluenceTd"><p>Provides the zip compression program</p></td></tr><tr><td class="confluenceTd"><p>unzip</p></td><td class="confluenceTd"><p>Provides the unzip de-compression program</p></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-SoftwarePackageSelectionCISCompliance">Software Package Selection CIS Compliance</h2><p>Since a minimal set of packages has been selected, the build is in compliance with CIS requirements.  Below are the sections referenced by the RHEL CIS document[<a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a>] which affect package selection;</p><ul><li>2.1.1 to 2.1.18 Remove Legacy Services (e.g. Telnet Server is a legacy service) with the exception of 2.1.2 telnet client.  Telnet client is of no risk in our environment as no VM has a telnet server installed and the VM’s are not capable of creating a telnet connection to any other machine.</li><li>3.2 Remove X-Windows</li><li>3.3 Disable avahi Server</li><li>3.4 Disable Print Server</li><li>3.5 Remove DHCP Server</li><li>3.7 Remove LDAP</li><li>3.8 Disable NFS and RPC</li><li>3.9 Remove DNS server</li><li>3.10 Remove FTP Server</li><li>3.11 Remove HTTP Server</li><li>3.12 Remove Dovecot (IMAP and POP3 services)</li><li>3.14 Remove HTTP Proxy Server</li><li>3.15 Remove SNMP Server</li></ul><h1 id="EBA-VirtualMachine(VM)Templates-DiskLayout">Disk Layout</h1><p>The base operating system image has been designed to have a very basic disk configuration; one which is designed to support the following <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards:</p><ul><li>Create separate partition for /tmp (CIS benchmark - section 1.1.1) - <em>as /tmp is world writable, it is bound to a separate partition to prevent resource starvation</em></li><li>Set nodev, nosuid and noexec option for /tmp partition (CIS benchmark - section 1.1.2, 1.1.3 and 1.1.4) - <em>nodev prevents users creating block or character special devices in /tmp, nosuid prevents users creating set userid files in /tmp and noexec prevents the filesystem containing executable binaries</em></li><li>Create separate partition for /var (CIS benchmark - section 1.1.5) - <em>as /var may contain world writable files and directories, it is bound to a separate partition to prevent resource starvation</em></li><li>Create separate partition for /var/log (CIS benchmark - section 1.1.7) - <em>the /var/log directory will be used to store system log data, this is bound to a separate partition to prevent resource starvation and to protect audit data</em></li><li>Create separate partition for /home (CIS benchmark - section 1.1.9) - <em>the /home directory is bound to a separate directory to protect against resource starvation from local users and to restrict the type of files that can be stored within that directory</em></li><li>Set nodev option to /home partition (CIS benchmark - section 1.1.10) - <em>nodev prevents users creating block or character special devices in /tmp</em></li><li>Non-Compliance;<strong> </strong>CIS Requirement 1.1.6 Bind /var/tmp to /tmp – Given the small size of the disks and their segregated nature this has not been implemented to allow access to more temp storage space.</li></ul><p>If there is to be any data stored on the machine outside of configuration, this will be kept in a datavg.  This will enable separation of data and applications allowing snapshotting of the application, data and operating system separately.</p><p>In accordance with CIS lockdown the file systems will not have the default mount options, but will use CIS recommended mount options.  Disk layout is generally quite difficult to modify after installation so won’t be initially setup by puppet, however it will manage fstab.</p><p>The root volume group (Rootvg) disk size is 50Gb.  This size was chosen to match the amount of storage allocated to a virtual machine by default, by the hosting provider.  The 50Gb is split into three partitions:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p><strong>Mount Point</strong></p></th><th class="confluenceTh"><p><strong>Partition Type</strong></p></th><th class="confluenceTh"><p><strong>Size</strong></p></th></tr><tr><td class="confluenceTd"><p>/boot</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>200Mb</p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Volume group - rootvg</p></td><td class="confluenceTd"><p>20000Mb (grows to maximum space allocated to the virtual machine during the base operating system installation)</p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>Swap</p></td><td class="confluenceTd"><p>1000Mb</p></td></tr></tbody></table></div><p>The layout of the root volume group (rootvg) is further detailed in the table below:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p><strong>Mount Point</strong></p></th><th class="confluenceTh"><p><strong>Filesystem Type</strong></p></th><th class="confluenceTh"><p><strong>Size</strong></p><p>(in MB)</p></th><th class="confluenceTh"><p><strong>Mount Options</strong></p></th><th class="confluenceTh"><p><strong>Volume Name</strong></p></th></tr><tr><td class="confluenceTd"><p>/</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>1000</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>root_vol</p></td></tr><tr><td class="confluenceTd"><p>/usr</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>2000</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>usr_vol</p></td></tr><tr><td class="confluenceTd"><p>/opt</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>2000</p></td><td class="confluenceTd"><p>nosuid nodev</p></td><td class="confluenceTd"><p>opt_vol</p></td></tr><tr><td class="confluenceTd"><p>/tmp</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>4000</p></td><td class="confluenceTd"><p>nosuid nodev noexec</p></td><td class="confluenceTd"><p>tmp_vol</p></td></tr><tr><td class="confluenceTd"><p>/home</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>1000</p></td><td class="confluenceTd"><p>nosuid nodev noexec</p></td><td class="confluenceTd"><p>home_vol</p></td></tr><tr><td class="confluenceTd"><p>/var</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>4000</p></td><td class="confluenceTd"><p>nosuid nodev</p></td><td class="confluenceTd"><p>var_vol</p></td></tr><tr><td class="confluenceTd"><p>/var/log</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>4000</p></td><td class="confluenceTd"><p>nosuid nodev</p></td><td class="confluenceTd"><p>varlog_vol</p></td></tr><tr><td class="confluenceTd"><p>/var/log/audit</p></td><td class="confluenceTd"><p>ext4</p></td><td class="confluenceTd"><p>1000</p></td><td class="confluenceTd"><p>nosuid nodev noexec</p></td><td class="confluenceTd"><p>varlogaudit_vol</p></td></tr><tr><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p>19000</p></td><td class="confluenceTd"><p> </p></td><td class="confluenceTd"><p> </p></td></tr></tbody></table></div><p>N.B. The settings above are enforced by Puppet.</p><p>N.B. There is some unallocated space within rootvg to expand existing mount points, or add new mount points for application installation.</p><h1 id="EBA-VirtualMachine(VM)Templates-NetworkConfigurationandFirewalls">Network Configuration and Firewalls</h1><h2 id="EBA-VirtualMachine(VM)Templates-BaseOS.1">Base OS</h2><p>The following network configuration changes will be made in alignment with the <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards:</p><ul><li>Disable send packet redirects (CIS benchmark - section 4.1.2) - <em>for hosts that do not act as routers there is no need for ICMP redirects</em></li><li>Disable source routed packet acceptance (CIS benchmark - section 4.2.1) <em>- disable the system from accepting source routed packets.</em></li><li>Disable ICMP redirect acceptance (CIS benchmark - section 4.2.2) - <em>disable the system from accept any ICMP redirects, to prevent any updates to the systems routing tables. </em></li><li>Log Suspicious Packets (CIS benchmark - section 4.2.4) - <em>log packets with un-routable source addresses to the kernel log</em></li><li>Enable ignore broadcast requests (CIS benchmark - section 4.2.5) - <em>do not send ICMP redirects on non-router hosts.</em></li><li>Enable bad error message protection (CIS benchmark - section 4.2.6) - <em>prevents the kernel from logging bogus responses (RFC-1122 non-compliant) from broadcast reframes, keeping file systems from filling up with useless log messages. </em></li><li>Enable TCP SYN cookies (CIS benchmark - section 4.2.7)<em> - allows the server to verify it has received a valid response to a SYN cookie and allow the connection, even though there is no corresponding SYN in the queue.</em></li><li>Disable IPv6 (CIS benchmark - section 4.4.2) -<em> as IPv6 is not going to be used it is disabled to reduce the attack surface of the system.</em></li><li>Section 4.3 Wireless Networking, 4.5 Install TCP Wrappers and 4.6 Remove Uncommon Network protocols are not applicable to the configuration.  As there is no wireless network, IPTables is configured to prevent connections from unauthorized hosts and the network protocols aren’t installed</li><li>Section 4.8 Enable ip6tables - This is not required as IP v6 is switched off in the configuration.</li></ul><p>N.B. The explanations in <em>italics</em> above are paraphrased descriptions of the actions taken from the <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards.</p><p>The base operating system image contains the following DNS resolver file:</p><p class="ConfigListing" style="margin-left: 30.0px;">/etc/resolv.conf</p><ul><li style="list-style-type: none;background-image: none;"><ul><li class="StyleConfigListingPatternClearGray-251">nameserver &lt;Internal DNS Server IP&gt;</li><li class="StyleConfigListingPatternClearGray-251">domain &lt;vApp Domain&gt;</li></ul></li></ul><p>When the virtual machine is started for the first time, VMware tools will inject a specific resolv.conf file based on the settings defined for the network that the VMs primary vNIC is attached to.  VMware tools will also create an ifcfg-eth[x] file for each vNIC (where [x] is the number of the vNIC).</p><p>At this point, the operating system will have sufficient connectivity to enable it to communicate with the Puppet Master in order to retrieve its configuration.</p><h2 id="EBA-VirtualMachine(VM)Templates-PuppetModifications.1">Puppet Modifications</h2><p>Puppet will be used to make and manage changes across a number of operating system files to enforce the network changes within the previous section (<a href="#EBA-VirtualMachine(VM)Templates-NetworkConfigurationandFirewalls">Base OS</a>).  N.B. This section covers the base operating system configuration which is enforced by Puppet, different Puppet configuration will be applied to create types of node e.g. routers would have some of the CIS standards relaxed.</p><h3 id="EBA-VirtualMachine(VM)Templates-KernelNetworkChanges">Kernel Network Changes</h3><p>Puppet will use sysctl to make the required changes to the network and system configuration of the running Linux kernel to support the CIS lockdown standards.</p><p>To achieve this Puppet will manage the configuration of the /etc/sysctl.conf file, to support the following changes required by the <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th colspan="1" class="confluenceTh">File</th><th class="confluenceTh">Requirement</th><th class="confluenceTh">Change</th></tr><tr><td rowspan="9" class="confluenceTd">/etc/sysctl.conf</td><td class="confluenceTd">Ensure no IP forwarding CIS Requirement 4.1.1</td><td class="confluenceTd">net.ipv4.ip_forward = 0</td></tr><tr><td class="confluenceTd">Ensure that subsequent connections use the new sysctl values</td><td class="confluenceTd">net.ipv4.route.flush = 1</td></tr><tr><td class="confluenceTd">Disable send packet redirects CIS Req 4.1.2</td><td class="confluenceTd"><p>net.ipv4.conf.all.send_redirects = 0</p><p>net.ipv4.conf.default.send_redirects = 0</p></td></tr><tr><td colspan="1" class="confluenceTd">Disable source routed packet acceptance CIS Req 4.2.1</td><td colspan="1" class="confluenceTd"><p>net.ipv4.conf.all.accept_source_route = 0</p><p>net.ipv4.conf.default.accept_source_route = 0</p></td></tr><tr><td colspan="1" class="confluenceTd">Disable ICMP redirect acceptance CIS Req 4.2.2</td><td colspan="1" class="confluenceTd"><p>net.ipv4.conf.all.accept_redirects = 0</p><p>net.ipv4.conf.default.accept_redirects = 0</p></td></tr><tr><td colspan="1" class="confluenceTd">Log Suspicious Packets CIS Req 4.2.4</td><td colspan="1" class="confluenceTd"><p>net.ipv4.conf.all.log_martians = 1</p><p>net.ipv4.conf.default.log_martians = 1</p></td></tr><tr><td colspan="1" class="confluenceTd">Enable ignoring broadcast requests CIS Req 4.2.5</td><td colspan="1" class="confluenceTd">net.ipv4.icmp_echo_ignore_broadcasts = 1</td></tr><tr><td colspan="1" class="confluenceTd">Enable bad error message protection CIS Req 4.2.6</td><td colspan="1" class="confluenceTd">net.ipv4.icmp_ignore_bogus_error_responses = 1</td></tr><tr><td colspan="1" class="confluenceTd">Enable TCP SYN cookies CIS Req 4.2.8</td><td colspan="1" class="confluenceTd">net.ipv4.tcp_syncookies = 1</td></tr></tbody></table></div><h3 id="EBA-VirtualMachine(VM)Templates-DisableIPv6">Disable IPv6</h3><p>Puppet will manage the following settings to ensure IPv6 is disabled, within the following files on each host to meet <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> Requirement 4.4.2:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Requirement</th><th class="confluenceTh">Change</th></tr><tr><td colspan="1" class="confluenceTd">/etc/sysconfig/network</td><td rowspan="2" class="confluenceTd">Disable IPv6</td><td colspan="1" class="confluenceTd"><p>NETWORKING_IPV6=no</p><p>IPV6INIT=no</p></td></tr><tr><td colspan="1" class="confluenceTd">/etc/modprobe.d/ipv6.conf</td><td colspan="1" class="confluenceTd">options ipv6 disable=1</td></tr></tbody></table></div><h3 id="EBA-VirtualMachine(VM)Templates-StaticIPAddresses">Static IP Addresses</h3><p>Puppet will be used to manage the static ip addressing of the VM.  To achieve this, it will configure and monitor a set of /etc/sysconfig/network-scripts/ifcfg-eth[x] files - where [x] denotes the number of the virtual network interface card (vNIC) for that virtual machine.  A sample configuration for the first vNIC is provided below:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th><th class="confluenceTh">Meaning</th></tr><tr><td class="confluenceTd">/etc/sysconfig/network-scripts/ifcfg-eth0</td><td class="confluenceTd">DEVICE=eth0</td><td class="confluenceTd">The name of the vNIC device being configured.</td></tr><tr><td class="confluenceTd"> </td><td class="confluenceTd">NETMASK=255.255.255.0</td><td class="confluenceTd">The netmask of available hosts within the subnet the host is connected to.</td></tr><tr><td class="confluenceTd"> </td><td class="confluenceTd">IPADDR=10.3.0.2</td><td class="confluenceTd">The IP address of this host.</td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">BOOTPROTO=static</td><td colspan="1" class="confluenceTd">The IP address is assigned statically.</td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">ONBOOT=yes</td><td colspan="1" class="confluenceTd">The device is activated at boot time.</td></tr></tbody></table></div><p>N.B. Most virtual machines will have 2 virtual network interface cards, one to provide a connection onto the application network and one to provide a connection onto the management network, an exception to this rule would be on the firewalls / routers and VMs within the demilitarised zone which will have additional vNICs.  <span style="color: rgb(255,0,0);"> </span></p><h2 id="EBA-VirtualMachine(VM)Templates-FirewallConfiguration">Firewall Configuration</h2><p>Iptables is the chosen firewall implemented on each host, it will require modification depending on the services that the server is providing.  At time of installation it allows connections to ports 22 (ssh), 8140, 61613 (Puppet) &amp; 10050 (Zabbix monitoring).  This satisfies <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 4.7 Enable iptables.  The IP v6 firewall iptables6 is not enabled as IP v6 is not configured.</p><h2 id="EBA-VirtualMachine(VM)Templates-DNSConfiguration">DNS Configuration</h2><p>The operating system will be configured to access a domain name server to resolve domain name lookups using a resolver file (/etc/resolv.conf).  The resolver file will use the following settings managed by puppet;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th><th class="confluenceTh">Meaning</th></tr><tr><td class="confluenceTd">/etc/resolv.conf</td><td class="confluenceTd">namesserver &lt;IP address of the local DNS Server&gt;</td><td class="confluenceTd">The IP address of a name server that the resolver should query.  This can contain a number of name servers, but within IPT this will contain the IP address of the management firewall virtual machine within the virtual application of the requesting virtual machine.</td></tr><tr><td class="confluenceTd"> </td><td class="confluenceTd">domain &lt;domain name of the virtual machine&gt;</td><td class="confluenceTd">Tthe domain that this virtual machine is within.  This enables DNS queries to be issued using host names alone and them to be resolved to hosts relative to the local domain.</td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">option timeout:1</td><td colspan="1" class="confluenceTd">Sets the amount of time in seconds that the resolver will wait for a response from the name server before retrying, up to the number of retry attempts.</td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">option attempts:1</td><td colspan="1" class="confluenceTd">Sets the number of times the resolver will send a query to its name server before giving up and returning an error to the calling application.</td></tr><tr><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">option rotate</td><td colspan="1" class="confluenceTd">Causes a round-robin selection of name servers from those listed, rather than have all clients try the first listed server each time.  As IPT will only list one name server this option has no effect, but is included in case additional name servers are added in the future.</td></tr></tbody></table></div><p>The following aliases will be setup and managed on the DNS name server on the management server within the Tooling virtual application, of the respective organisation security zone (ST, PT and PP):</p><p><strong>ST organisation security zone</strong></p><ul><li>logging.st_tooling1.ipt.local</li><li>repository.st_tooling1.ipt.local</li><li>time.st_tooling1.ipt.local</li><li>puppet.st_tooling1.ipt.local</li></ul><p><strong>PT organisation security zone</strong></p><ul><li>logging.pt_tooling1.ipt.local</li><li>repository.pt_tooling1.ipt.local</li><li>time.pt_tooling1.ipt.local</li><li>puppet.pt_tooling1.ipt.local</li></ul><p><strong>PP organisation security zone</strong></p><ul><li>logging.pp_tooling1.ipt.local</li><li>repository.pp_tooling1.ipt.local</li><li>time.pp_tooling1.ipt.local</li><li>puppet.pp_tooling1.ipt.local</li></ul><h1 id="EBA-VirtualMachine(VM)Templates-VyattaFirewall">Vyatta Firewall</h1><p>IPT is using Vyatta, which is a software based Firewall/Router OS running on Debian Wheezy. Base install is same as stock Vyatta installation as a Skyscape VM image, we then use Puppet to configure Vyatta with routes and ports that we need to be implemented in NP. Only customization been done is the enforcing of strong ciphers and MACs on SSH server which is detailed in the SSH section.</p><h1 id="EBA-VirtualMachine(VM)Templates-Kernel">Kernel</h1><h2 id="EBA-VirtualMachine(VM)Templates-BootLoaderConfiguration">Boot Loader Configuration</h2><p>The base image kernel will be a stock kernel with default options.  However, a boot loader (GRUB) password is configured to prevent an unauthorised user gaining root access by editing the boot loader menu entries.  This is defined in the kickstart file (<a href="#EBA-VirtualMachine(VM)Templates-BaseImageKickstart">Base Image Kickstart</a>)<span style="color: rgb(255,0,0);"> </span> in the following line:</p><div><p class="StyleConfigListingPatternClearGray-251">bootloader --location=mbr --append=&quot; rhgb crashkernel=auto quiet&quot; --password=rootpw</p></div><p>This password should be managed and updated by puppet in business as usual configuration.</p><p>File “/etc/grub.conf” should have permissions “root:root 600” to comply with  <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 1.5.2.</p><h2 id="EBA-VirtualMachine(VM)Templates-Removecontrol-alt-del">Remove control-alt-del</h2><p>In order to secure the console to prevent control-alt-del from rebooting the machine without authorization the /etc/init/control-alt-delete.conf file is removed from the base operating system.</p><h2 id="EBA-VirtualMachine(VM)Templates-Defaultrunlevel">Default run level</h2><p>Within linux, the run level is a software configuration of the system that allows only a selected group of processes to exist.  Init can run the system in one of five runlevels. These runlevels are 1-5 and S or s.  The system runs in only one of these runlevels at a time.</p><p>The default runlevel will be set to level 3.  This will boot the system into a multi-user mode with a text based console login capability, i.e. no x-windows capability.</p><p>The following configuration changes will be made in alignment with the <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards:</p><ul><li>Remove x-windows (CIS benchmark - section 3.2) - <em>as no graphical login access via X windows is required to the host, x-windows will be removed to reduce the potential attack surface.</em></li></ul><p>To achieve this Puppet will manage the configuration of the inittab file, to support the following changes:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/inittab</td><td class="confluenceTd">id:3:initdefault:</td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-SELinuxPolicy">SELinux Policy</h2><p>CIS level 1 does not require selinux to be enforcing.  So Puppet is configured to change it to permissive mode.  This logs exceptions to syslog which will enable an easier transition to enforcing should it be decided in future that enforcing is required.  To achieve this the following file must be made;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/selinux/config</td><td class="confluenceTd">SELINUX=permissive</td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-Secureinit">Secure init</h2><p>The entry beginning SINGLE below, requires authentication in single user mode.  This prevents an unauthorized user from rebooting the system into single user to gain root privileges without credentials. This satisfies <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 1.5.4.</p><p>Turn off the PROMPT option on the console to prevent console users from potentially overriding established security settings.   This satisfies <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 1.5.5</p><p>Setting the umask to 027 will make sure that files created by daemons will not be readable, writable or executable by any other than the group and owner of the daemon process and will not be writable by the group of the daemon process. The daemon process can manually override these settings if these files need additional permission.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/sysconfig/init</td><td class="confluenceTd"><p>SINGLE=/sbin/sulogin</p><p>PROMPT=no</p><p>umask 027</p></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-PreventCoreDumps">Prevent Core Dumps</h2><p>A core dump is the memory of an executable program. It is generally used to determine why a program aborted. It can also be used to glean confidential information from a core file. The system provides the ability to set a soft limit for core dumps, but this can be overridden by the user.</p><p>Setting a hard limit on core dumps prevents users from overriding the soft variable. In addition, setting the fs.suid_dumpable variable to 0 will prevent setuid programs from dumping cores.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/sysctl.conf</td><td class="confluenceTd">fs.suid_dumpable = 0</td></tr><tr><td class="confluenceTd">/etc/security/limits.conf</td><td class="confluenceTd">* Hard core</td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-ExecShield">ExecShield</h2><p>Execshield is made up of a number of kernel features to provide protection against buffer overflow attacks. These features include prevention of execution in memory data space, and special handling of text buffers.</p><p>Enabling any feature that can protect against buffer overflow attacks enhances the security of the system. This satisfies <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> recommendation 1.6.2.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/sysctl.conf</td><td class="confluenceTd">kernel.exec-shield = 1</td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-EnablingRandomizedVirtualMemoryPlacement">Enabling Randomized Virtual Memory Placement</h2><p>Set the system flag to force randomized virtual memory region placement.</p><p>Randomly placing virtual memory regions will make it difficult for to write memory page exploits as the memory placement will be consistently shifting.  This satisfies <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 1.6.3</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/sysctl.conf</td><td class="confluenceTd">kernel.randomize_va_space = 2</td></tr></tbody></table></div><h1 id="EBA-VirtualMachine(VM)Templates-ConfiguredServices">Configured Services</h1><h2 id="EBA-VirtualMachine(VM)Templates-BaseOS.2">Base OS</h2><p class="Bodycopy">The base operating system image will intentionally have very few configured running services to increase security and reduce the requirement for patching.  This will also help maintain a lean system with minimal running overhead.</p><p>The following services will be running within the base build:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p> </p></th><th colspan="5" class="confluenceTh"><p align="center"><strong>Run Level</strong></p></th></tr><tr><th class="confluenceTh"><p><strong>Daemon</strong></p></th><th class="confluenceTh"><p align="center"><strong>1</strong></p></th><th class="confluenceTh"><p align="center"><strong>2</strong></p></th><th class="confluenceTh"><p align="center"><strong>3</strong></p></th><th class="confluenceTh"><p align="center"><strong>4</strong></p></th><th class="confluenceTh"><p align="center"><strong>5</strong></p></th></tr><tr><td class="confluenceTd"><p>auditd</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>blk-availability</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>crond</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>ip6tables</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>iptables</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>lvm2-monitor</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>netconsole</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>netfs</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>network</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>pe-puppet</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>postfix</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>rdisc</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>restorecond</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>rsyslog</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>saslauthd</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>sshd</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr><tr><td class="confluenceTd"><p>sssd</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td><td class="confluenceTd"><p align="center">off</p></td></tr><tr><td class="confluenceTd"><p>udev-post</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td><td class="confluenceTd"><p align="center">on</p></td></tr></tbody></table></div><p>The set of services configured to start during boot are in compliance with <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 6.1.2 (Enable Cron Daemon).</p><h2 id="EBA-VirtualMachine(VM)Templates-PuppetModifications.2">Puppet Modifications</h2><p>Puppet will make the following changes to running services to adjust the default settings. </p><h4 id="EBA-VirtualMachine(VM)Templates-Puppetwillswitchoff:">Puppet will switch off:</h4><p class="ConfigListing">lvm2-monitor – monitors physical disk health</p><p class="ConfigListing">blk-availability – monitors the availability of a block on physical disk</p><h4 id="EBA-VirtualMachine(VM)Templates-Puppetwillswitchon:">Puppet will switch on:</h4><p class="ConfigListing">sssd</p><p class="ConfigListing">ntpd</p><p class="ConfigListing">ntpdate</p><p>Puppet will monitor and control what daemons are started at boot.</p><h1 id="EBA-VirtualMachine(VM)Templates-NTP">NTP</h1><p class="Bodycopy">A Network Time Protocol (NTP) service is not configured as part of the base operating system images, rather this configuration is added and managed by Puppet Enterprise after the virtual machine is instantiated.</p><p class="Bodycopy">A management server within the Tooling virtual application of each organisation security zone is configured to connect to the hosting providers NTP servers.  All other virtual machines within an organisation security zone will connect to that management server for time, making the management server the master time source for that organisation security zone.  Instead of specifying the respective management server by name, a DNS alias is used.  For example, within the ST organisation security zone the following DNS alias would be used by all hosts within that zone to refer to the management server:</p><ul><li>time.st_tooling1.ipt.local</li></ul><p class="Bodycopy">NTP is configured on start up to synchronize clocks with the NTP master to avoid long periods of the clocks being out of sync as NTP can take many hours to sync clocks.</p><p class="Bodycopy">NTP daemon is run as the ntp user not as the root user.  This is defined in the ntpd file, as shown below:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">value</th></tr><tr><td class="confluenceTd">/etc/sysconfig/ntpd</td><td class="confluenceTd"><p>OPTIONS=”-u ntp:ntp –p /var/run/ntpd.pid -g -x&quot;</p><p>N.B. The –x setting will gradually change the clock to keep the client in synch with the server when the clock is up to 10 minutes out of synchronisation.</p></td></tr></tbody></table></div><h1 id="EBA-VirtualMachine(VM)Templates-AccessControl">Access Control</h1><p class="Bodycopy">The only access configured within the base operating system image is for the root user.    Which uses a shadow file and is encrypted using sha512 algorithm.  This is specified by the authconfig statement in the attached kickstart file (<a href="#EBA-VirtualMachine(VM)Templates-BaseImageKickstart">Base Image Kickstart</a>).<span style="color: rgb(255,0,0);"> </span></p><p class="Bodycopy">Puppet should configure and monitor access mechanisms.  This will be LDAP however the design of that system is yet to be implemented.</p><h2 id="EBA-VirtualMachine(VM)Templates-PAMHardening">PAM Hardening</h2><p>PAM (Pluggable Authentication Modules) are loaded and executed when a program needs to authenticate a user.  PAM files within the /etc/pam.d directory will be configured in line with the <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards below:</p><ul><li>Upgrade password hashing algorithm to sha-512 (CIS benchmark - section 6.3.1) - <em>changes password encryption from the md5 algorithm to the stronger sha512 algorithm</em></li><li>6.3.2 Set Password Creation Requirement – The CIS Standard is ignored in favour of the project standard</li><li>Set lockout for failed password attempts (CIS benchmark - section 6.3.4) - <em>lock out user ids after n unsuccessful consecutive login attempts to prevent brute force password attacks</em></li><li>6.3.6 Limit Password Re-Use – Forcing users not to reuse their past 5 passwords make it less likely that an attacker will be able to guess the password.</li><li>Non-Compliant - 6.4 Restrict root Login to System Console - Virtualization removes the need for securing a physical console.</li><li>Restrict access to the su command (CIS benchmark - section 6.5) - <em>su has been superceded by sudo,  Access to su is restricted as it has limited logging and access compared to sudo.</em></li><li>Local user CIS compliance sections 7.1.1 to 7.1.3 are not applicable as all users will be managed via LDAP policies.  Only application users will be local which will not have a password expiry and must changed in a controlled fashion.</li><li>CIS sections 9.2.1 to 9.2.20 Existing User Checks.  These checks are for existing users compliance and removing legacy entries.  Since this is a new install those checks are not required.</li></ul><p>These changes are highlighted within the following file - specific sections of PAM hardening aligned to CIS benchmark standards have been represented in comments in italics.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/pam.d/password-auth<ins>-ac</ins></td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">#%PAM-1.0</p><p class="StyleConfigListingPatternClearGray-251"># This file is auto-generated.</p><p class="StyleConfigListingPatternClearGray-251"># User changes will be destroyed the next time authconfig is run.</p><p class="StyleConfigListingPatternClearGray-251">auth required pam_env.so</p><p class="StyleConfigListingPatternClearGray-251"><em># Set lockout for failed password attempts</em></p><p class="StyleConfigListingPatternClearGray-251">auth required pam_faillock.so preauth audit silent deny=5 unlock_time=900</p><p class="StyleConfigListingPatternClearGray-251">auth [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900</p><p class="StyleConfigListingPatternClearGray-251">auth sufficient pam_faillock.so authsucc audit deny=5 unlock_time=900</p><p class="StyleConfigListingPatternClearGray-251">auth [success=1 default=bad] pam_unix.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">auth sufficient pam_fprintd.so</p><p class="StyleConfigListingPatternClearGray-251">auth sufficient pam_unix.so nullok try_first_pass</p><p class="StyleConfigListingPatternClearGray-251">auth requisite pam_succeed_if.so uid &gt;= 500 quiet</p><p class="StyleConfigListingPatternClearGray-251">auth required pam_deny.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">account required pam_unix.so</p><p class="StyleConfigListingPatternClearGray-251">account sufficient pam_localuser.so</p><p class="StyleConfigListingPatternClearGray-251">account sufficient pam_succeed_if.so uid &lt; 500 quiet</p><p class="StyleConfigListingPatternClearGray-251">account required pam_permit.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">password requisite pam_cracklib.so try_first_pass retry=3 type=</p><p class="StyleConfigListingPatternClearGray-251">password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok</p><p class="StyleConfigListingPatternClearGray-251">password required pam_deny.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">session optional pam_keyinit.so revoke</p><p class="StyleConfigListingPatternClearGray-251">session  required pam_limits.so</p><p class="StyleConfigListingPatternClearGray-251">session [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid</p><p class="StyleConfigListingPatternClearGray-251">session required pam_unix.so</p></div></td></tr><tr><td colspan="1" class="confluenceTd">/etc/pam.d/system-auth-ac</td><td colspan="1" class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">#%PAM-1.0</p><p class="StyleConfigListingPatternClearGray-251"># This file is auto-generated.</p><p class="StyleConfigListingPatternClearGray-251"># User changes will be destroyed the next time authconfig is run.</p><p class="StyleConfigListingPatternClearGray-251">auth        required      pam_env.so</p><p class="StyleConfigListingPatternClearGray-251">auth        required      pam_faillock.so preauth audit silent deny=5 unlock_time=900</p><p class="StyleConfigListingPatternClearGray-251">auth  [success=1 default=bad] pam_unix.so</p><p class="StyleConfigListingPatternClearGray-251">auth  [default=die]       pam_faillock.so authfail audit deny=5 <del>un</del>lock_time=900</p><p class="StyleConfigListingPatternClearGray-251">auth        sufficient    pam_faillock.so authsucc audit deny=5 <del>un</del>lock_time=900</p><p class="StyleConfigListingPatternClearGray-251">auth        sufficient    pam_fprintd.so</p><p class="StyleConfigListingPatternClearGray-251">auth        sufficient    pam_unix.so nullok try_first_pass</p><p class="StyleConfigListingPatternClearGray-251">auth        requisite     pam_succeed_if.so uid &gt;= 500 quiet</p><p class="StyleConfigListingPatternClearGray-251">auth        required      pam_deny.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">account     required      pam_unix.so</p><p class="StyleConfigListingPatternClearGray-251">account     sufficient    pam_localuser.so</p><p class="StyleConfigListingPatternClearGray-251">account     sufficient    pam_succeed_if.so uid &lt; 500 quiet</p><p class="StyleConfigListingPatternClearGray-251">account     required      pam_permit.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">password    required     pam_cracklib.so \</p><p class="StyleConfigListingPatternClearGray-251">try_first_pass retry=5 type= minlen=9 minclass=3 difok=3 difignore=14</p><p class="StyleConfigListingPatternClearGray-251">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=5 #sets OS to log last 5 used passwords</p><p class="StyleConfigListingPatternClearGray-251">password    required      pam_deny.so</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">session     optional      pam_keyinit.so revoke</p><p class="StyleConfigListingPatternClearGray-251">session     required      pam_limits.so</p><p class="StyleConfigListingPatternClearGray-251">session     [success=1 default=ignore] pam_succeed_if.so service in crond quiet use_uid</p><p class="StyleConfigListingPatternClearGray-251">session     required      pam_unix.so</p></div></td></tr></tbody></table></div><p>Access to the su command is limited so as remove access to all accounts even if the user knows the password of the user.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/pam.d/su</td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251"># Uncomment the following line to implicitly trust users in the &quot;wheel&quot; group.</p><p class="StyleConfigListingPatternClearGray-251">#auth           sufficient      pam_wheel.so trust use_uid</p><p class="StyleConfigListingPatternClearGray-251"># Uncomment the following line to require a user to be in the &quot;wheel&quot; group.</p><p class="StyleConfigListingPatternClearGray-251"><strong>auth            required        pam_wheel.so use_uid</strong></p><p class="StyleConfigListingPatternClearGray-251">auth            include         system-auth</p><p class="StyleConfigListingPatternClearGray-251">account         sufficient      pam_succeed_if.so uid = 0 use_uid quiet</p><p class="StyleConfigListingPatternClearGray-251">account         include         system-auth</p><p class="StyleConfigListingPatternClearGray-251">password        include         system-auth</p><p class="StyleConfigListingPatternClearGray-251">session         include         system-auth</p><p class="StyleConfigListingPatternClearGray-251">session         optional        pam_xauth.so</p></div></td></tr></tbody></table></div><p>This prevents users not in the wheel group getting access to su.  The wheel group is a Linux provided group intended for super users only.  Real users will not be put into the wheel group.</p><h2 id="EBA-VirtualMachine(VM)Templates-UserUMASK">User UMASK</h2><p>The default umask determines the permissions of files created by users. The user creating the file has the discretion of making their files and directories readable by others via the chmod command. Users who wish to allow their files and directories to be readable by others by default may choose a different default umask by inserting the umask command into the standard shell configuration files.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/bashrc</td><td class="confluenceTd">umask 077</td></tr><tr><td class="confluenceTd">/etc/profile</td><td class="confluenceTd">umask 077</td></tr></tbody></table></div><p><a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> Compliance section 7.4 (Set Default umask for users).</p><h2 id="EBA-VirtualMachine(VM)Templates-LDAPConfiguration">LDAP Configuration</h2><p><span style="color: rgb(0,0,0);">Please refer to the Environment Access Control Physical Design.</span></p><h2 id="EBA-VirtualMachine(VM)Templates-SUDOERS">SUDOERS</h2><p>Access to root is governed by group membership.  Users have to belong a group to be able to sudo to root.  All activity is logged via syslog.</p><p>Group membership to sudoers allows root access.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/sudoers</td><td class="confluenceTd"><p>Runas_Alias APP_USERS = &lt;APPSUSER1&gt;, &lt;APPUSER2&gt; #repeat as necessary</p><p class="StyleConfigListingPatternClearGray-251">%app_sudo ALL=(APP_USERS) NOPASSWD: ALL</p><p class="StyleConfigListingPatternClearGray-251">%sudoers  ALL=(ALL) ALL</p></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-SudoUsage">Sudo Usage</h2><p>The command alias chuser will be provided via /etc/profile. </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/profile</td><td class="confluenceTd">alias chuser=’sudo –i –u’</td></tr></tbody></table></div><p>This will change user to the specified user via using sudo.  Alternately the user may use sudo independently to complete the work required.</p><h2 id="EBA-VirtualMachine(VM)Templates-LegalWarning">Legal Warning</h2><p>In accordance with <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> section 8.1 &amp; 8.2 (Warning Banners). The following text should appear in the following files;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/motd</td><td rowspan="3" class="confluenceTd"><p>“Disconnect NOW if you have not been expressly authorised to use this system. Unauthorised use is a criminal offence under the Computer Misuse Act 1990. Authorized users only.</p><p>All activity is monitored and reported.”</p></td></tr><tr><td colspan="1" class="confluenceTd">/etc/issue</td></tr><tr><td colspan="1" class="confluenceTd">/etc/<a href="http://issue.net" class="external-link" rel="nofollow">issue.net</a></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-EnsurePermissions">Ensure Permissions</h2><p><a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a>  sections 9.1.2 to 9.1.9 Verify permissions on user access files.  It is critical to ensure that these files are protected from unauthorized write access. Although it is protected by default, the file permissions could be changed either inadvertently or through malicious actions.  So puppet will keep these files in check;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p><strong>File</strong></p></th><th class="confluenceTh"><p><strong>Owner</strong></p></th><th class="confluenceTh"><p><strong>Permissions</strong></p></th></tr><tr><td class="confluenceTd"><p>/etc/passwd</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>644</p></td></tr><tr><td class="confluenceTd"><p>/etc/shadow</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>000</p></td></tr><tr><td class="confluenceTd"><p>/etc/gshadow</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>000</p></td></tr><tr><td class="confluenceTd"><p>/etc/group</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>644</p></td></tr></tbody></table></div><h1 id="EBA-VirtualMachine(VM)Templates-SSH">SSH</h1><p class="Bodycopy">SSH is the primary command and control channel and therefore needs to be carefully configured to ensure a robust interface which is secure.</p><p class="Bodycopy">To comply with <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> some configuration changes are required.  The following directives are to be included in the file /etc/ssh/sshd_config;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/ssh/sshd_config</td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">LogLevel INFO #The highest level of logging without invading user privacy.</p><p class="StyleConfigListingPatternClearGray-251">X11Forwarding yes #Forward X11 connections, this allows encrypted X11 (gui) connections over ssh instead of having to open a port on the firewall</p><p class="StyleConfigListingPatternClearGray-251">MaxAuthTries 4  #Restricts the number of attempts at entering a password before closing the connection</p><p class="StyleConfigListingPatternClearGray-251">IgnoreRhosts yes #Prevents a rhosts file allowing access without a password</p><p class="StyleConfigListingPatternClearGray-251">HostbasedAuthentication no #Further lock down of rhosts</p><p class="StyleConfigListingPatternClearGray-251">PermitRootLogin without-password #Allows root log on with a key only</p><p class="StyleConfigListingPatternClearGray-251">PermitEmptyPasswords no #Prevents empty password</p><p class="StyleConfigListingPatternClearGray-251">Permit<u><ins>UserEnvironment</ins></u> no #Prevents users specifying custom ssh environment</p><p class="StyleConfigListingPatternClearGray-251">ClientAliveInterval 3600 #Logs an inactive user out after an hour</p><p class="StyleConfigListingPatternClearGray-251">ClientAliveCountMax 0 #Allows zero client alive messages to have no response</p><p class="StyleConfigListingPatternClearGray-251">AllowGroups sshusers root wheel &lt;vAPP NAME&gt; #Prevents users not in the named groups from logging on via ssh</p><p class="StyleConfigListingPatternClearGray-251">Banner /etc/<ins><a href="http://issue.net" class="external-link" rel="nofollow">issue.net</a></ins> #A file containing legal logon warning</p><p class="StyleConfigListingPatternClearGray-251">Ciphers aes128-ctr,aes192-ctr,aes256-ctr #Ciphers allowed for SSH</p><p class="StyleConfigListingPatternClearGray-251">MACs hmac-sha1,<a href="mailto:umac-64@openssh.com" class="external-link" rel="nofollow">umac-64@openssh.com</a>,hmac-ripemd160,hmac-sha2-256,hmac-sha2-512 #Allowed MACs for SSH.</p></div></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-FilePermissionsandownership">File Permissions and ownership</h2><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong>File</strong></p></td><td class="confluenceTd"><p><strong>Owner</strong></p></td><td class="confluenceTd"><p><strong>Permissions</strong></p></td></tr><tr><td class="confluenceTd"><p>/etc/ssh/sshd_config</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr></tbody></table></div><p> SSH is shown to be compliant with <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> as follows:</p><ul><li>6.2.1 Set SSH Protocol to 2 this is the default and does not require change</li><li>6.2.2 Set LogLevel to INFO</li><li>Non-compliant 6.2.4 Disable SSH X11 Forwarding.  This is required for remote GUI.  This is allowed in specification if required.</li><li>6.2.5 Set SSH Max Auth Tries to 4<br /> This prevents, a brute force attack by preventing login attempts to 4</li><li>6.2.6 Set SHH Ignore Hosts to YES</li><li>6.2.7 Set SSH HostBASEDAuthtentication to NO</li><li>Non-compliant 6.2.8 Disable SSH Root Login – This has been allowed with a key only using the “without-password”option.  This is to allow mass administration beyond the capabilities of puppet.</li><li>6.2.9 Set SSH PermitEmptyPasswords to NO</li><li>6.2.10 Do allow Users to Set Environment Options – this is the default in CentOS/RedHat</li><li>6.2.11 Use Only Approved Cipher in Counter Mode – Restricted to use only strong ciphers</li><li>Non-compliant 6.2.12  Set Idle Timeout Interval for user – This is not set as the system becomes un-usable for developers and system admins</li><li>6.2.13 Limit Access via SSH.  Usersmust belong to the sshuser group to be allowed access to the machine via ssh</li><li>6.2.14 Banner – Legal warning wording will be displayed before log on warn users not log on unless authorized</li><li>6.2.15 Enforce SSH rate limiting on Jump Servers. This limits the number of connection attempts per set time limit to defer brute force attacks.</li><li>6.2.16 Use only approved MAC algorithms. Disable weak MACs on firewalls.</li><li>6.2.17 Disable weak Ciphers. Disable use of RC4 ciphers.</li></ul><h1 id="EBA-VirtualMachine(VM)Templates-SecuringCron,anacron&amp;at">Securing Cron, anacron &amp; at</h1><h2 id="EBA-VirtualMachine(VM)Templates-Filepermissionsandownership">File permissions and ownership</h2><p>This file contains information on what system jobs are run by crond and anacron. Write access to these files could provide unprivileged users with the ability to elevate their privileges. Read access to these files could provide users with the ability to gain insight on system jobs that run on the system and could provide them a way to gain unauthorized privileged access.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p><strong>File</strong></p></th><th class="confluenceTh"><p><strong>Owner</strong></p></th><th class="confluenceTh"><p><strong>Permissions</strong></p></th></tr><tr><td class="confluenceTd"><p>/etc/anacrontab</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr><tr><td class="confluenceTd"><p>/etc/crontab</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr><tr><td class="confluenceTd"><p>/etc/cron.hourly</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr><tr><td class="confluenceTd"><p>/etc/cron.daily</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr><tr><td class="confluenceTd"><p>/etc/cron.weekly</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr><tr><td class="confluenceTd"><p>/etc/cron.monthly</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr><tr><td class="confluenceTd"><p>/etc/cron.d</p></td><td class="confluenceTd"><p>root:root</p></td><td class="confluenceTd"><p>600</p></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-AccessControl.1">Access Control</h2><p>In accordance with <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 6.1.10 and 6.1.11 (Restrict at/cron to Authorized Users), instead black listing users a white list should be created so only configured users are allowed to create con jobs.</p><h4 id="EBA-VirtualMachine(VM)Templates-Removetheblacklistfiles;">Remove the black list files;</h4><p class="ConfigListing">/etc/at.deny</p><p class="ConfigListing">/etc/cron.devy</p><h4 id="EBA-VirtualMachine(VM)Templates-Createemptywhitelistfiles;">Create empty white list files;</h4><p class="ConfigListing">/etc/at.allow Ownership: root:root Permissions: 600</p><p class="ConfigListing">/etc/cron.allow Ownership: root:root Permissions: 600</p><h1 id="EBA-VirtualMachine(VM)Templates-Logging">Logging</h1><p>The base operating system image has been designed with the following <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> standards for logging:</p><ul><li>Install the rsyslog package (CIS benchmark - section 5.1.1) - <em>rsyslog is recommended over the default syslogd daemon as it provides improvements such as the encryption of log data en route to a central logging server, multi-threading and message filtering</em></li><li>Configure rsyslog to send logs to a remote log host (CIS benchmark - section 5.1.5) and Activate the rsyslogd (CIS Benchmark – section 5.1.2) - <em>storing logs data on a remote host protects log integrity from local attacks (an attacker who gains root access on the local system could tamper with or remove log data that is stored on the local system)</em></li><li>Accept Remote rsyslog Messages from authorized hosts (CIS Benchmark – 5.1.6).  This is not applicable to the configuration as the hosts will not accept incoming messages</li></ul><p class="Bodycopy">All hosts will be configured to send system logs back to the management host (within the tooling virtual application of the same organisation security zone).  For example, within the ST organisation security zone the following alias would be used by the rsyslogd daemon on hosts within that zone to their logs to the management syslog host: logging.st_tooling1.ipt.local</p><h2 id="EBA-VirtualMachine(VM)Templates-rsyslogdaemon">rsyslog daemon</h2><p>The rsyslog daemon will be configured with the following parameters:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/rsyslog.conf</td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">$ModLoad imuxsock # provides support for local system logging (e.g. via logger command)</p><p class="StyleConfigListingPatternClearGray-251">$ModLoad imklog   # provides kernel logging support (previously done by rklogd)</p><p class="StyleConfigListingPatternClearGray-251"># Use default timestamp format</p><p class="StyleConfigListingPatternClearGray-251">$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat</p><p class="StyleConfigListingPatternClearGray-251"># Include all config files in /etc/rsyslog.d/</p><p class="StyleConfigListingPatternClearGray-251">$IncludeConfig /etc/rsyslog.d/*.conf</p><p class="StyleConfigListingPatternClearGray-251"># Log anything (except mail) of level info or higher.</p><p class="StyleConfigListingPatternClearGray-251"># Don't log private authentication messages!</p><p class="StyleConfigListingPatternClearGray-251">*.info;mail.none;authpriv.none;cron.none<ins>   </ins><del>                /</del><ins>/</ins>var/log/messages</p><p class="StyleConfigListingPatternClearGray-251"># The authpriv file has restricted access.</p><p class="StyleConfigListingPatternClearGray-251">authpriv.*<ins>    </ins><del>                                              </del>/var/log/secure</p><p class="StyleConfigListingPatternClearGray-251"># Log all the mail messages in one place.</p><p class="StyleConfigListingPatternClearGray-251">mail.*<ins>        </ins><del>                                                  -</del>/var/log/maillog</p><p class="StyleConfigListingPatternClearGray-251"># Log cron stuff</p><p class="StyleConfigListingPatternClearGray-251">cron.*<del>                                                  </del><ins>       </ins>/var/log/cron</p><p class="StyleConfigListingPatternClearGray-251"># Everybody gets emergency messages</p><p class="StyleConfigListingPatternClearGray-251">*.emerg<del>                                                 </del><ins>      </ins>*</p><p class="StyleConfigListingPatternClearGray-251"># Save news errors of level crit and higher in a special file.</p><p class="StyleConfigListingPatternClearGray-251">uucp,news.crit<del>                                 </del><del>         </del><ins>  </ins>/var/log/spooler</p><p class="StyleConfigListingPatternClearGray-251"># Save boot messages also to boot.log</p><p class="StyleConfigListingPatternClearGray-251">local7.*<del>                                                </del><ins>       </ins>/var/log/boot.log</p><p class="StyleConfigListingPatternClearGray-251">$WorkDirectory /var/spool/rsyslog # where to place spool files</p><p class="StyleConfigListingPatternClearGray-251">$ActionQueueFileName to_logging # unique name prefix for spool files</p><p class="StyleConfigListingPatternClearGray-251">$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)</p><p class="StyleConfigListingPatternClearGray-251">$ActionQueueSaveOnShutdown on # save messages to disk on shutdown</p><p class="StyleConfigListingPatternClearGray-251">$ActionQueueType LinkedList   # run asynchronously</p><p class="StyleConfigListingPatternClearGray-251">$ActionResumeRetryCount -1    # infinite retries if host is down</p><p class="StyleConfigListingPatternClearGray-251">*.* @@logging:514</p></div></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-Logrotate">Logrotate</h2><p>Logs should be rotated on a weekly basis and kept for 4 weeks.  This satisfies <a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> requirement 5.2 (Configure Log Rotate).</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/logrotate.conf</td><td class="confluenceTd"><div><p class="ConfigListing"># rotate log files weekly</p><p class="ConfigListing">weekly</p><p class="ConfigListing"># keep 4 weeks worth of backlogs</p><p class="ConfigListing">rotate 4</p><p class="ConfigListing"># create new (empty) log files after rotating old ones</p><p class="ConfigListing">create</p><p class="ConfigListing"># use date as a suffix of the rotated file</p><p class="ConfigListing">dateext</p><p class="ConfigListing"># RPM packages drop log rotation information into this directory</p><p class="ConfigListing">include /etc/logrotate.d</p><p class="ConfigListing"># no packages own wtmp and btmp -- we'll rotate them here</p><p class="ConfigListing">/var/log/wtmp {</p><p class="ConfigListing">    monthly</p><p class="ConfigListing">    create 0664 root utmp</p><p class="ConfigListing">        minsize 1M</p><p class="ConfigListing">    rotate 1</p><p class="ConfigListing">}</p><p class="ConfigListing">/var/log/btmp {</p><p class="ConfigListing">    missingok</p><p class="ConfigListing">    monthly</p><p class="ConfigListing">    create 0600 root utmp</p><p class="ConfigListing">    rotate 1</p><p class="ConfigListing">}</p></div></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-LoggingPermissions">Logging Permissions</h2><p>It is important to ensure that log files exist and have the correct permissions to ensure that sensitive rsyslog data is archived and protected.  A log file must already exist for rsyslog to be able to write to it.  In accordance with CIS 5.1.4 Create and set permissions on log fles.  The group has been set to sudoers to allow priviledged users to access the logs.</p><p>The following file owner/permissions should be set;</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Owner</th><th class="confluenceTh">Permission</th></tr><tr><td class="confluenceTd">/var/log/messages</td><td rowspan="6" class="confluenceTd">root:sudoers</td><td rowspan="6" class="confluenceTd">640</td></tr><tr><td class="confluenceTd">/var/log/secure</td></tr><tr><td class="confluenceTd">/var/log/maillog</td></tr><tr><td colspan="1" class="confluenceTd">/var/log/cron</td></tr><tr><td colspan="1" class="confluenceTd">/var/log/spooler</td></tr><tr><td colspan="1" class="confluenceTd">/var/log/boot.log</td></tr></tbody></table></div><p>In addition to the files specified in the CIS benchmark, the following files/directories and permissions will be maintained by Puppet in order to protect the information contained in them:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Permission</th></tr><tr><td class="confluenceTd">/var/log/hist</td><td class="confluenceTd">1777 (this needs to be world writeable as all user’s must be able to write their audit history under that directory)</td></tr><tr><td class="confluenceTd">/var/log/nmon/*.log</td><td class="confluenceTd">0640 (nmon sets permissions of 0644 by default)</td></tr></tbody></table></div><h1 id="EBA-VirtualMachine(VM)Templates-SoftwareRepository">Software Repository</h1><h2 id="EBA-VirtualMachine(VM)Templates-RepositoryConfiguration">Repository Configuration</h2><p class="Bodycopy">A software artefact repository (Yum) will be present within the tooling virtual application of each organisation security zone to enable hosts to install packages from it via http.</p><p class="Bodycopy">A DNS alias will be used to enable hosts to refer to the software artefact repository within each organisation security zone, enabling the repositories to be moved in the future with minimal change.  For example, the DNS alias within the ST organisation security zone will be as follows:</p><p class="Bodycopy">repository.st_tooling1.ipt.local</p><p class="Bodycopy">This is an example CentOS 6.5 64 bit repository configuration:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/yum.repos.d/CentOS6.5_64.repo</td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">[centos6.5_64]</p><p class="StyleConfigListingPatternClearGray-251">name=CentOS 6.5 64bit</p><p class="StyleConfigListingPatternClearGray-251">baseurl=<a href="http://repository/CentOS6.5_64" class="external-link" rel="nofollow">http://repository/CentOS6.5_64</a></p><p class="StyleConfigListingPatternClearGray-251">gpgkey=<a rel="nofollow">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</a></p><p class="StyleConfigListingPatternClearGray-251">enabled=1</p><p class="StyleConfigListingPatternClearGray-251">gpgcheck=1</p></div></td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-GPGfileandCheck">GPG file and Check</h2><p>Puppet should check that the gpg file which enables the OS to verify that the software being installed has not been tampered with or is corrupt.  Should be checked against the original stored on the puppet server.</p><p>The following should exist in the file specified, to enable gpg check to be made globally.  It can be turned off per repository.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">File</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/yum.conf</td><td class="confluenceTd">gpgcheck=1</td></tr></tbody></table></div><h2 id="EBA-VirtualMachine(VM)Templates-CISCompliance">CIS Compliance</h2><p><a href="https://benchmarks.cisecurity.org/tools2/linux/CIS_Red_Hat_Enterprise_Linux_6_Benchmark_v1.2.0.pdf" class="external-link" rel="nofollow">CIS Red Hat Enterprise Linux 6 Benchmark</a> compliance states that the VM’s should be regularly updated to maintain security.  The GPG file ensures that software installed is certified from Red Hat / CentOS.</p><ul><li>Non-compliance<strong> - </strong>CIS Requirement 1.2.1 Configure Connection to RHN - The servers will not connect to RedHat repositories as this is a secure environment.</li><li>CIS Requirement 1.2.2 Verify GPG Key Installation - It is important to ensure that updates are obtained from a valid source to protect against spoofing that could lead to the inadvertent installation of malware on the system.</li><li>CIS Requirement 1.2.3 Verify GPG check is globally activated.  Global check turned on for checking against the GPG key.</li></ul><h1 id="EBA-VirtualMachine(VM)Templates-Licensing">Licensing</h1><h2 id="EBA-VirtualMachine(VM)Templates-RedHatLicensing">Red Hat Licensing</h2><p>RedHat software can be licensed direct on a per hour basis from SkyScape by choosing a Red Hat VM.  No licensing action is required by EBSA.</p><p>Subscription Asset Manager (SAM) is included as part of a subscription to Red Hat Enterprise Linux. Subscription Asset Manager allows local administration of subscriptions and allows a stronger organization structure to be created to define machines, groups, and content streams.  Red Hat VM’s should be configured to talk to the project SAM which should sit in the bastion vApp as it requires internet connection to RedHat.</p><h2 id="EBA-VirtualMachine(VM)Templates-CentOSLicensing">CentOS Licensing</h2><p>CentOS is license free and we are not required to maintain a database of it’s usage.</p><h1 id="EBA-VirtualMachine(VM)Templates-Monitoring">Monitoring</h1><p align="left">The Zabbix monitoring agent will be installed on all targets that require monitoring, to actively monitor the virtual machines resources and applications.  The agent will use native system calls to gather operational system information and report back to the Zabbix server for processing, reporting and alerting.</p><p align="left">The Zabbix agent is installed by Puppet onto all hosts that are being monitored.</p><p align="left">The Zabbix agent should be configured to send alerts back to their local Zabbix server located within the local security compartment tooling vApp;</p><ul><li class="ConfigListing">montzm01.&lt;sec_comp&gt;-tooling1.ipt.local</li></ul><p align="left">Where &lt;sec_comp) is one of st, pt and pp.</p><p>Zabbix will be used to monitor server availability, health and performance.  The ‘fiddyspence/zabbix’ module will be used to configure the Zabbix server and the agents that reside on each of the hosts in the EBSA-managed environments.  The zabbix module uses the Zabbix API to automatically add hosts and hostgroups exported from other servers to the Zabbix server.  The base profile class will therefore include an exported zabbix_host resource so that every server exports its host details, which can then be collected by the Zabbix server.  As duplicate resources cannot be declared (doing so results in a catalog compilation error), the zabbix_hostgroup for each environment can only be declared once.  As such, the management firewall profile will be the only one that exports the environment’s zabbix_hostgroup resource for collection by the Zabbix server.</p><h1 id="EBA-VirtualMachine(VM)Templates-Backup">Backup</h1><p>Skyscape cloud provider provides backup solution at a VM level when VM’s are placed in standard service level and above.  DevTest service level VM’s are not backed up.</p><p>For available backup SLA’s from SkyScape please see <a href="http://www.skyscapecloud.com/infrastructure-as-a-service/backup-in-the-cloud" class="external-link" rel="nofollow">http://www.skyscapecloud.com/infrastructure-as-a-service/backup-in-the-cloud</a>.</p><p>At this time, the design for the strategic back up service is not available. This section will be elaborated with the impacts to the operating system (if any) once this is available.</p><h1 id="EBA-VirtualMachine(VM)Templates-ZoneFirewallRoles">Zone Firewall Roles</h1><h2 id="EBA-VirtualMachine(VM)Templates-Purpose">Purpose</h2><p>Each vApp will have a set of firewalls composed of up to 3 Firewalls and routers to allow access to the VM’s contained within.</p><p>Each Firewall acts as a security barrier between different levels of trust.  There are 3 zones in all;</p><ul><li>Trusted Zone – TZF role – This firewall is the security barrier between the trusted network and the DMZ(De-Militarized Zone) proxies.</li><li>De-Militarized Zone – DZF – This firewall sit between the Application Zone and the vApp DMZ.  It acts as the gateway for all external application traffic.</li><li>Managemnet Zone – MZF role – This firewall is between the Management Network and the vApp internal Management network.  It acts as a gateway for all external management based traffic.  Management traffic would consist of traffic such as SSH access, LDA and monitoring.</li></ul><h1 id="EBA-VirtualMachine(VM)Templates-YUMRepositories">YUM Repositories</h1><p>Yum repositories are located as follows:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Repo definition file</th><th class="confluenceTh">Purpose</th><th class="confluenceTh">Value</th></tr><tr><td class="confluenceTd">/etc/yum.repos.d/CentOS6.5_64.repo</td><td class="confluenceTd"><div>CentOS 6.5 64 bit repository configuration</div></td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">[centos6.5_64]</p><p class="StyleConfigListingPatternClearGray-251">name=CentOS 6.5 64bit</p><p class="StyleConfigListingPatternClearGray-251">baseurl=<a href="http://repository/CentOS6.5_64" class="external-link" rel="nofollow">http://repository/CentOS6.5_64</a></p><p class="StyleConfigListingPatternClearGray-251">gpgkey=<a rel="nofollow">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</a></p><p class="StyleConfigListingPatternClearGray-251">enabled=1</p><p class="StyleConfigListingPatternClearGray-251">gpgcheck=1</p></div></td></tr><tr><td class="confluenceTd">/etc/yum.repos.d/RHEL6.5_64.repo</td><td class="confluenceTd">RHEL 6.5 64 bit repository configuration</td><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">[rhel6.5_64]</p><p class="StyleConfigListingPatternClearGray-251">name=RHEL 6.5 64bit</p><p class="StyleConfigListingPatternClearGray-251">baseurl=<a href="http://repository/RHEL6.5_64" class="external-link" rel="nofollow">http://repository/RHEL6.5_64</a></p><p class="StyleConfigListingPatternClearGray-251">gpgkey=<a href="file:///etc/pki/rpm-gpg/RPM-GPG-KEY-RHEL-6" class="external-link" rel="nofollow">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-RHEL-6</a></p><p class="StyleConfigListingPatternClearGray-251">enabled=1</p><p class="StyleConfigListingPatternClearGray-251">gpgcheck=1</p></div></td></tr><tr><td colspan="1" class="confluenceTd">/etc/yum.repos.d/IPT_repo</td><td colspan="1" class="confluenceTd">IPT software catalog repository (for deployed application software)</td><td colspan="1" class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">[ipt_repo]</p><p class="StyleConfigListingPatternClearGray-251">Name=IPT Software catalog</p><p class="StyleConfigListingPatternClearGray-251">baseurl=<a href="http://repository/IPT_repo" class="external-link" rel="nofollow">http://repository/IPT_repo</a></p><p class="StyleConfigListingPatternClearGray-251">enabled=1</p><p class="StyleConfigListingPatternClearGray-251">gpgcheck=0</p></div></td></tr><tr><td colspan="1" class="confluenceTd">/etc/yum.repos.d/CentOS_update.repo</td><td colspan="1" class="confluenceTd">CentOS 6.5 64Bit Update Repository</td><td colspan="1" class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">[centos_update]</p><p class="StyleConfigListingPatternClearGray-251">name=CentOS 6.5 64bit Updates</p><p class="StyleConfigListingPatternClearGray-251">baseurl=<a href="http://repository/CentOS_updates" class="external-link" rel="nofollow">http://repository/CentOS_updates</a></p><p class="StyleConfigListingPatternClearGray-251">gpgkey=<a href="file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6" class="external-link" rel="nofollow">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6</a></p><p class="StyleConfigListingPatternClearGray-251">enabled=1</p><p class="StyleConfigListingPatternClearGray-251">gpgcheck=1</p></div></td></tr><tr><td colspan="1" class="confluenceTd">/etc/yum.repos.d/RHEL_update.repo</td><td colspan="1" class="confluenceTd">RHEL 6.5 64Bit Update Repository</td><td colspan="1" class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251">[rhel_update]</p><p class="StyleConfigListingPatternClearGray-251">name=RHEL 6.5 64bit Updates</p><p class="StyleConfigListingPatternClearGray-251">baseurl=<a href="http://repository/RHEL_updates" class="external-link" rel="nofollow">http://repository/RHEL_updates</a></p><p class="StyleConfigListingPatternClearGray-251">gpgkey=<a rel="nofollow">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-RHEL-6</a></p><p class="StyleConfigListingPatternClearGray-251">enabled=1</p><p class="StyleConfigListingPatternClearGray-251">gpgcheck=1</p></div></td></tr></tbody></table></div><h1 id="EBA-VirtualMachine(VM)Templates-BaseImageKickstart">Base Image Kickstart</h1><p>The following kickstart file is used as part of the base operating system installation.  It defines the low level operating system attributes that will be configured within the base installation:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Kickstart file</th></tr><tr><td class="confluenceTd"><div><p class="StyleConfigListingPatternClearGray-251"># Kickstart file automatically generated by anaconda.</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#version=DEVEL</p><p class="StyleConfigListingPatternClearGray-251">install</p><p class="StyleConfigListingPatternClearGray-251">cdrom</p><p class="StyleConfigListingPatternClearGray-251">lang en_GB.UTF-8</p><p class="StyleConfigListingPatternClearGray-251">keyboard uk</p><p class="StyleConfigListingPatternClearGray-251">network --hostname=gldtzm01 --onboot yes --device eth0 --bootproto=static --ip=&lt;redacted&gt; --netmask=255.255.255.0</p><p class="StyleConfigListingPatternClearGray-251">rootpw  rootpw --plaintext</p><p class="StyleConfigListingPatternClearGray-251"># Shutdown rather than reboot - if this template VM reboots, it will create an /etc/udev/rules.d/70-persistent-net.rules</p><p class="StyleConfigListingPatternClearGray-251"># file with the MAC addresses of this VM.  When this template is used to instantiate a VM, the MAC addresses will</p><p class="StyleConfigListingPatternClearGray-251"># obviously be different, and therefore be assigned to incorrect device names (e.g. what should be eth0 will be called</p><p class="StyleConfigListingPatternClearGray-251"># eth1 on the new VM).</p><p class="StyleConfigListingPatternClearGray-251">shutdown</p><p class="StyleConfigListingPatternClearGray-251">skipx</p><p class="StyleConfigListingPatternClearGray-251">text</p><p class="StyleConfigListingPatternClearGray-251">firewall --service=ssh --port=8140:tcp,61613:tcp</p><p class="StyleConfigListingPatternClearGray-251">authconfig --useshadow --enablemd5 --passalgo=sha512</p><p class="StyleConfigListingPatternClearGray-251">repo --name=IPT_repo --baseurl=<a href="http://<repourl>/IPT_repo" class="external-link" rel="nofollow">http://&lt;redacted&gt;/IPT_repo</a></p><p class="StyleConfigListingPatternClearGray-251">selinux --enforcing</p><p class="StyleConfigListingPatternClearGray-251">timezone --utc Europe/London</p><p class="StyleConfigListingPatternClearGray-251">bootloader --location=mbr --append=&quot; rhgb crashkernel=auto quiet&quot; --password=rootpw</p><p class="StyleConfigListingPatternClearGray-251">services --disabled=ip6tables,netfs,pe-puppet --enabled=iptables,ntpd,ntpdate,pe-mcollective</p><p class="StyleConfigListingPatternClearGray-251">zerombr yes</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251"># The following is the partition information you requested</p><p class="StyleConfigListingPatternClearGray-251"># Note that any partitions you deleted are not expressed</p><p class="StyleConfigListingPatternClearGray-251"># here so unless you clear all partitions first, this is</p><p class="StyleConfigListingPatternClearGray-251"># not guaranteed to work</p><p class="StyleConfigListingPatternClearGray-251">clearpart --all --initlabel</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">part /boot --fstype=ext4 --size=200 --ondisk=sda</p><p class="StyleConfigListingPatternClearGray-251">part pv.01 --size=20000 --grow --ondisk=sda</p><p class="StyleConfigListingPatternClearGray-251">part swap --size=1000 --fstype=swap  --ondisk=sda</p><p class="StyleConfigListingPatternClearGray-251">volgroup rootvg pv.01</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">logvol /        --vgname=rootvg --size=1000 --name=root_vol</p><p class="StyleConfigListingPatternClearGray-251">logvol /usr     --vgname=rootvg --size=2000 --name=usr_vol</p><p class="StyleConfigListingPatternClearGray-251">logvol /opt     --vgname=rootvg --size=2000 --name=opt_vol --fsoptions=defaults,nosuid,nodev</p><p class="StyleConfigListingPatternClearGray-251">logvol /tmp     --vgname=rootvg --size=4000 --name=tmp_vol --fsoptions=defaults,nosuid,nodev,noexec</p><p class="StyleConfigListingPatternClearGray-251">logvol /home    --vgname=rootvg --size=1000 --name=home_vol --fsoptions=defaults,nosuid,nodev,noexec</p><p class="StyleConfigListingPatternClearGray-251">logvol /var     --vgname=rootvg --size=4000 --name=var_vol --fsoptions=defaults,nosuid,nodev</p><p class="StyleConfigListingPatternClearGray-251">logvol /var/log/audit --vgname=rootvg --size=1000 --name=varlogaudit_vol --fsoptions=defaults,nosuid,nodev,noexec</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">%packages --nobase</p><p class="StyleConfigListingPatternClearGray-251">vim-minimal</p><p class="StyleConfigListingPatternClearGray-251">openssh-clients</p><p class="StyleConfigListingPatternClearGray-251">wget</p><p class="StyleConfigListingPatternClearGray-251">man</p><p class="StyleConfigListingPatternClearGray-251">telnet</p><p class="StyleConfigListingPatternClearGray-251">bind-utils</p><p class="StyleConfigListingPatternClearGray-251">pe-puppet</p><p class="StyleConfigListingPatternClearGray-251">pe-mcollective</p><p class="StyleConfigListingPatternClearGray-251">vmware-tools-esx-nox</p><p class="StyleConfigListingPatternClearGray-251">vmware-tools-esx-kmods</p><p class="StyleConfigListingPatternClearGray-251">%end</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">%post --log=/root/post_install.log</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#########               DVD Drive</p><p class="StyleConfigListingPatternClearGray-251">echo -e &quot;/dev/dvd\t/media/dvd\tauto\tro,nodev,nosuid,noauto,user,noexec\t0 0&quot; &gt;&gt; /etc/fstab</p><p class="StyleConfigListingPatternClearGray-251">mkdir /media/dvd</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#########               Network Bonding</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">sed -i.preLock &quot;s|BOOTPROTO=.*|BOOTPROTO=none|;</p><p class="StyleConfigListingPatternClearGray-251">s|IPV6INIT=.*|IPV6INIT=no|;</p><p class="StyleConfigListingPatternClearGray-251">s|DNS1=.*||;</p><p class="StyleConfigListingPatternClearGray-251">s|GATEWAY=.*||;&quot; /etc/sysconfig/network-scripts/ifcfg-eth0</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">cat &lt;&lt; EOF &gt; /etc/resolv.conf</p><p class="StyleConfigListingPatternClearGray-251">nameserver &lt;redacted&gt;</p><p class="StyleConfigListingPatternClearGray-251">domain st-tooling.ipt.local</p><p class="StyleConfigListingPatternClearGray-251">EOF</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#########      Secure the filesystems</p><p class="StyleConfigListingPatternClearGray-251">sed -i.preLock &quot;s|/dev/shm.*tmpfs.*defaults|/dev/shm\t\ttmpfs\tdefaults,nosuid,noexec,nodev|&quot; /etc/fstab</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#########      Secure the boot</p><p class="StyleConfigListingPatternClearGray-251">#sed -i.preLock &quot;/SINGLE/s/sushell/sulogin/&quot; /etc/sysconfig/init</p><p class="StyleConfigListingPatternClearGray-251">#sed -i.preLock &quot;/PROMPT/s/yes/no/&quot; /etc/sysconfig/init</p><p class="StyleConfigListingPatternClearGray-251">#sed -i.preLock  &quot;s|^id:5|id:3|&quot; /etc/inittab</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#Disable IPv6</p><p class="StyleConfigListingPatternClearGray-251">cat &lt;&lt; EOF &gt;&gt; /etc/sysconfig/network</p><p class="StyleConfigListingPatternClearGray-251">NETWORKING_IPV6=no</p><p class="StyleConfigListingPatternClearGray-251">IPV6INIT=no</p><p class="StyleConfigListingPatternClearGray-251">EOF</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">cat &lt;&lt; EOF &gt;&gt; /etc/modprobe.d/ipv6.conf</p><p class="StyleConfigListingPatternClearGray-251">options ipv6 disable=1</p><p class="StyleConfigListingPatternClearGray-251">EOF</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#Puppet Agent install</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#cat &gt;answerfile&lt;&lt;END</p><p class="StyleConfigListingPatternClearGray-251">#q_install=y</p><p class="StyleConfigListingPatternClearGray-251">#q_puppet_cloud_install=n</p><p class="StyleConfigListingPatternClearGray-251">#q_puppet_enterpriseconsole_install=n</p><p class="StyleConfigListingPatternClearGray-251">#q_puppet_symlinks_install=y</p><p class="StyleConfigListingPatternClearGray-251">#q_puppetagent_certname=$(hostname -s)</p><p class="StyleConfigListingPatternClearGray-251">#q_puppetagent_install=y</p><p class="StyleConfigListingPatternClearGray-251">#q_puppetagent_server=puppet</p><p class="StyleConfigListingPatternClearGray-251">#q_puppetmaster_install=n</p><p class="StyleConfigListingPatternClearGray-251">#q_vendor_packages_install=n</p><p class="StyleConfigListingPatternClearGray-251">#q_install=y</p><p class="StyleConfigListingPatternClearGray-251">#END</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">#[ -e answerfile ] &amp;&amp; ./puppet-enterprise-installer -a answerfile  2&gt;&amp;1 | tee  /tmp/install_${PKG}.log</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251"># Clean up Udev's persistent net rules so that when the template is</p><p class="StyleConfigListingPatternClearGray-251"># instantiated, on first boot the network devices are created correctly</p><p class="StyleConfigListingPatternClearGray-251">rm /etc/udev/rules.d/70-persistent-net.rules</p><p class="StyleConfigListingPatternClearGray-251">rm /etc/sysconfig/network-scripts/ifcfg-eth*</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251"># Turn reverse DNS off in SSH temporarily to aid debugging new servers</p><p class="StyleConfigListingPatternClearGray-251"># puppet will turn this back on</p><p class="StyleConfigListingPatternClearGray-251"># sed -i -e 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config</p><p class="StyleConfigListingPatternClearGray-251"> </p><p class="StyleConfigListingPatternClearGray-251">%end</p></div></td></tr></tbody></table></div><p> </p><p> </p><p> </p>
                    </div>

                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
