<!DOCTYPE html>
<html>
    <head>
        <title>EBA - Component Design</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            EBA - Component Design
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <p>This section contains the detailed design or references to the designs for each component within the component model (see diagram below). For definitions of terms, please see <a href="EBA---Glossary_65483650.html">EBA - Glossary</a>.</p><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1455124437056 {padding: 0px;}
div.rbtoc1455124437056 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1455124437056 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1455124437056'>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-1.EnvironmentDesign'>1. Environment Design</a></li>
<li><a href='#EBA-ComponentDesign-2.EnvironmentActionRepository'>2. Environment Action Repository</a></li>
<li><a href='#EBA-ComponentDesign-3.EnvironmentActionOrchestrator'>3. Environment Action Orchestrator</a>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-3.1KeyInterfaces'>3.1 Key Interfaces</a></li>
</ul>
</li>
<li><a href='#EBA-ComponentDesign-4.ACloudClient'>4. ACloud Client</a>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-4.1EBSAspecificnotes;'>4.1 EBSA specific notes;</a></li>
<li><a href='#EBA-ComponentDesign-4.2EBSAspecific-CustomisationScripts'>4.2 EBSA specific - Customisation Scripts</a></li>
<li><a href='#EBA-ComponentDesign-4.3EBSAspecificvCloudclient'>4.3 EBSA specific vCloud client</a></li>
<li><a href='#EBA-ComponentDesign-4.4ACloudImplementation'>4.4 ACloud Implementation</a></li>
</ul>
</li>
<li><a href='#EBA-ComponentDesign-5.EnvironmentBuildRepository'>5. Environment Build Repository </a>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-5.1EBSAspecificdetails;'>5.1 EBSA specific details;</a></li>
</ul>
</li>
<li><a href='#EBA-ComponentDesign-6.EnvironmentBuild'>6. Environment Build</a>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-6.1EBSAspecificdetails;'>6.1 EBSA specific details;</a></li>
<li><a href='#EBA-ComponentDesign-6.2OrganisationNetworksinSkyscape'>6.2 Organisation Networks in Skyscape </a></li>
<li><a href='#EBA-ComponentDesign-6.3ImportProgram'>6.3 Import Program</a>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-6.3.1Terminology'>6.3.1 Terminology</a></li>
<li><a href='#EBA-ComponentDesign-6.3.2Jenkinsconfiguration'>6.3.2 Jenkins configuration</a></li>
<li><a href='#EBA-ComponentDesign-6.3.3Jenkinsflow'>6.3.3 Jenkins flow</a></li>
<li><a href='#EBA-ComponentDesign-6.3.4Javaflow'>6.3.4 Java flow</a></li>
<li><a href='#EBA-ComponentDesign-6.3.5HardwareProfile'>6.3.5 Hardware Profile</a></li>
</ul>
</li>
<li><a href='#EBA-ComponentDesign-6.4Exportprogram'>6.4 Export program</a></li>
</ul>
</li>
<li><a href='#EBA-ComponentDesign-7.EnvironmentConfigurationOrchestration'>7. Environment Configuration Orchestration</a></li>
<li><a href='#EBA-ComponentDesign-8.EnvironmentConfigurationController'>8. Environment Configuration Controller</a></li>
<li><a href='#EBA-ComponentDesign-9.DynamicEnvironmentDataRepository'>9. Dynamic Environment Data Repository</a></li>
<li><a href='#EBA-ComponentDesign-10.SelfService'>10. Self Service</a>
<ul class='toc-indentation'>
<li><a href='#EBA-ComponentDesign-10.1Origin,transmissionanddeploymentofartefacts.'>10.1 Origin, transmission and deployment of artefacts.</a></li>
<li><a href='#EBA-ComponentDesign-10.2SelfServiceLevels'>10.2 Self Service Levels</a></li>
</ul>
</li>
<li><a href='#EBA-ComponentDesign-11.ReleaseManagementRepository'>11. Release Management Repository</a></li>
<li><a href='#EBA-ComponentDesign-12.VMTemplates'>12. VM Templates</a></li>
<li><a href='#EBA-ComponentDesign-13.DeploymentRepository'>13. Deployment Repository</a></li>
<li><a href='#EBA-ComponentDesign-14.Monitoring'>14. Monitoring</a></li>
</ul>
</div></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/65486679/65493490.png" data-image-src="attachments/65486679/65493490.png" data-unresolved-comment-count="0" data-linked-resource-id="65493490" data-linked-resource-version="3" data-linked-resource-type="attachment" data-linked-resource-default-alias="EnvironmentBuildAndManagement.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65486679" data-linked-resource-container-version="87"></span></p><h1 id="EBA-ComponentDesign-1.EnvironmentDesign">1. Environment Design</h1><p>Environment Design is carried out in Visio by using a custom stencil and shape data. Once the design is finished in Visio, there is a Visio Export Tool written in Visual Basic that has 2 buttons;</p><ul><li>Export the Virtual Machine Configuration - this exports all the VM, application networks, NIC's, compartments, VMC details etc into an XML &quot;configuration&quot; file (also known as an &quot;Environment Definition&quot; file). It specifically does not export the Organisation Networks</li><li>Export the Organisation Networks - this exports all the Organisation Networks into an XML file, known as an &quot;Organisational Network&quot; file or &quot;Environment Container&quot; file. The idea is that the Organisation Networks are common across many VMC's, and should change rarely, whereas the configuration XML will probably change with every release.</li></ul><p>These XML files are then committed to the Environment Action Repository as detailed <a href="#EBA-ComponentDesign-ear">here</a>. See <a href="EBA---Visio-Physical-Design_57512650.html">EBA - Visio Physical Design</a> for more details.</p><h1 id="EBA-ComponentDesign-2.EnvironmentActionRepository">2. Environment Action Repository</h1><p>The Environment Action Repository component is a Git repository. Any Jenkins job that needs to be aware of such commits (e.g. the <a href="#EBA-ComponentDesign-6.3ImportProgram">import process</a> below) will poll the repo for any new files committed/modified in the last 5 minutes.</p><p>The repository is called ‘environmentconfiguration’ and will be structured such that there is one directory per environment (see <a href="EBA---Glossary_65483650.html#EBA-Glossary-Environments">EBA - Glossary</a> for a list of environments).  For example, if the Git repository is checked out under /home/jenkins/ the following directory structure will be created in  /home/jenkins/environmentconfiguration/&lt;environmentname&gt;</p><p>The repository will contain the following types of files under each environment’s directory:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong>File Type</strong></p></td><td class="confluenceTd"><p><strong>Description</strong></p></td></tr><tr><td class="confluenceTd"><p>Environment Definition / Container Definition</p></td><td class="confluenceTd"><p>Contains a description, in XML format, of the composition of the environment.  It will detail what virtual machine containers, VMs, and networks should exist, and their exact configurations.  For more information see <a href="EBA---Visio-Physical-Design_57512650.html">EBA - Visio Physical Design</a>.</p></td></tr><tr><td class="confluenceTd"><p>Environment Execution Plan</p></td><td class="confluenceTd"><p>Contains a description, in XML format, of what commands the ACloud Client component needs to perform.  For example, ‘create an additional VM, and reconfigure an existing network’.  For more information see <a href="EBA---Sample-Execution-Plans_63242319.html">EBA - Sample Execution Plans</a> .</p></td></tr><tr><td class="confluenceTd"><p>Dynamic Environment Data</p></td><td class="confluenceTd"><p>Contains Hiera data (see <a href="EBA---Puppet-and-Hiera_65488099.html">EBA - Puppet and Hiera</a>) describing the configuration of the VMs within the environment.  For example, this will describe what versions of which applications need to be deployed.</p></td></tr><tr><td class="confluenceTd"><p>Logging Configuration</p></td><td class="confluenceTd"><p>Describes how detailed the logs from the ACloud Client will be, and where the logs will be stored</p></td></tr></tbody></table></div><h1 id="EBA-ComponentDesign-3.EnvironmentActionOrchestrator">3. Environment Action Orchestrator</h1><p>Responsible for running a number of jobs in order to fulfil the required environment action to be performed. Each job will call out to other components within the architecture to make changes to change resources within the hosting environment or software on individual virtual machines in order to fulfil the request.</p><h2 id="EBA-ComponentDesign-3.1KeyInterfaces">3.1 Key Interfaces</h2><p>Jobs within this component are manually triggered by an EBSA administrator to fulfil the required environment action.This component will call the aCloud Client component and the Environment Configuration Orchestration component in order to fulfil environment action events changes. An EBSA admin will view the dashboard of this component to receive a status on jobs that running.</p><p>Jenkins is used to orchestrate the overall deployment pipeline. The mechanics of how this orchestration task is performed based on the user inputs is detailed <a href="EBA---Detailed-Jenkins-Environment-Build-flow_65490998.html">here</a>.</p><p>Environment Build Plans define the types of actions that can be triggered by the Orchestrator. The user may choose to create or destroy environments if the build plan for that environment contains such action definitions. The details of the build plans can be found <a href="EBA---Build-Plans_65491060.html">here</a>.</p><h1 id="EBA-ComponentDesign-4.ACloudClient">4. ACloud Client</h1><p>The ACloud Client is a stateless component which is called from the Environment Action Orchestrator to build and manage virtual resources within the IPT cloud hosted environments based upon a set of instructions it is passed each time it is invoked.  Different instructions are passed into this component in order to perform different actions on different environments.</p><p>This component is implemented as a bespoke Java application on top of a vCloud Director v5.5 software development kit (SDK) for Java provided by VMware (<a href="https://www.vmware.com/support/pubs/vcd_pubs.html" class="external-link" rel="nofollow">https://www.vmware.com/support/pubs/vcd_pubs.html</a>) and the AWS SDK for Java v1.10 .  The bespoke code, along with the SDK provided jars files are compiled into a single executable jar file, which is deployed onto the Environment Action Orchestrator host and called directly from jobs within the Environment Action Orchestrator to perform specific changes to the hosted resources (e.g. just increase the number of virtual CPUs on a virtual machine), or as part of a larger orchestrated activity (e.g. build environment).</p><p>The ACloud jar used here is nearly identical to the one described in <a href="EBA---ACloud_61115560.html">EBA - ACloud</a>. One difference is that this called from within a Jenkins plug in not the command line, and the other difference is the password management functionality which was removed for open source users for security reasons.</p><p>Please see the <a href="EBA---ACloud_61115560.html">EBA - ACloud</a> page for more details on this component, and <a href="EBA---Visio-Physical-Design_57512650.html">EBA - Visio Physical Design</a> for more details on the Environment Definition files that this takes in. Details of the Execution Plan can be found at <a href="EBA---Sample-Execution-Plans_63242319.html">EBA - Sample Execution Plans</a>. Essentially, the Execution plan contains a set of instructions such as create, delete, update etc, which are applied to the environments in the Environment Definition xml file.</p><p>Note an Execution Plan is different to a Build Plan; a Build Plan includes instructions to generate multiple Execution Plans and SSH commands (for e.g. Puppet) and the order these steps should be executed in (see <a href="EBA---Build-Plans_65491060.html">EBA - Build Plans</a> for more detail).</p><h3 id="EBA-ComponentDesign-4.1EBSAspecificnotes;">4.1 EBSA specific notes;</h3><p><span style="color: rgb(0,0,0);">The source code for this component is in the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/acloud/aCloudClient" rel="nofollow">aCloudClient</a> project.</span> Built by the EBSA_ACLOUD_FLOW job on Dev Jenkins. Packaged as a standalone CLI by the EBSA_ACLOUD_RELEASE_rpm job on Dev Jenkins although it is a dependency jar of the Environment Build Tool engine which invokes it directly using AgnosticClientBridge.java rather than via the CLI.</p><p>Note the Home Office EBSA version of ACloud uses Password Manager Pro to to acquire passwords securely.</p><h3 id="EBA-ComponentDesign-4.2EBSAspecific-CustomisationScripts">4.2 EBSA specific - Customisation Scripts</h3><p>In the Environment Definition there is a <code><span class="tag"><span class="title">GuestCustomisationScript</span></span></code> element. This script is executed by Amazon or Skyscape on powering on of the VM. The script itself lives in Stash in the EBSA tooling environmentconfiguration\customisationscripts\ repo and is copied across to the VM during creation (see e.g. com.ipt.ebsa.agnostic.client.skyscape.module.VMModule.<span style="color: rgb(0,0,0);">updateGuestCustomisations</span>()). See <a href="EBA---Key-Functional-Interactions_65482098.html#EBA-KeyFunctionalInteractions-customisationscript">EBA - Key Functional Interactions</a> for more details.</p><h3 id="EBA-ComponentDesign-4.3EBSAspecificvCloudclient"><span style="color: rgb(0,0,0);">4.3 EBSA specific vCloud client <br /></span></h3><p><span style="color: rgb(0,0,0);">For legacy applications without a Visio diagram, EBSA used to use the VCloud Java code (a precursor to ACloud) to deploy to the cloud. This converted command XML (<a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/vcloud/vCloudConfiguration/src/main/resources/vCloudCommand-2.0.xsd" rel="nofollow"><span style="color: rgb(0,0,0);">vCloudCommand-2.0.xsd</span></a>) to Skyscape API instructions using the data from the configuration XML (<a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/vcloud/vCloudConfiguration/src/main/resources/vCloudConfig-2.0.xsd" rel="nofollow"><span style="color: rgb(0,0,0);">vCloudConfig-2.0.xsd</span></a>). This has been removed from the codebase (except for the XSD file and JAXB bindings) as all code now goes through ACloud, although you may still see references in the code comments.<br /></span></p><h3 id="EBA-ComponentDesign-4.4ACloudImplementation">4.4 ACloud Implementation</h3><p> </p><p>The ACloud Client component executes the following high level steps:</p><ul><li>Read in the two XML files (Environment Definition and Container Definition), properties file and single execution plan file - parses them and ensures that they are valid.</li><li>Login to the Cloud API system (Skyscape or AWS using credentials provided) and cache the login credentials for the duration of the jar invocation to be used in subsequent API calls.</li><li>Retrieve the details of the virtual machine container and the virtual environment container that the environment belongs to.</li><li>Iterate over the virtual machine container instructions within the Hosting Environment Execution plan and executes each instruction on each virtual machine container within the Hosting Environment Definition file.</li><li>Iterate over the organisation network instructions within the Hosting Environment Execution plan and executes each instruction on each organisation network within the Hosting Environment Definition file.</li><li>Iterate over the virtual application network instructions within the Hosting Environment Execution plan and executes each instruction on each virtual application network within the Hosting Environment Definition file.</li><li>Iterates over the virtual machine instructions within the Hosting Environment Execution plan and executes each instruction on each virtual machine within the Hosting Environment Definition file.</li></ul><p>In order to execute each instruction this component will orchestrate calls into the cloud provider SDK to perform the action.  A single instruction will involve making a number of SDK calls, which provides a Java method call for each cloud API RESTful service.  The methods provided by the SDK are split into two different design patterns:</p><ul><li>Synchronous calls - provides the caller with an instant response, and are typically used to provide “get” methods, which return information about existing resources within the cloud e.g. to get the details of a named virtual application.  There are a few exceptions to the “get” rule which also require instant responses, for example the login method returns a confirmation that the user is authenticated.</li><li>Asynchronous calls - provides the caller with a task id in response to the request.  The caller then invokes a waitForTask method passing in the task id, the SDK will then hold the thread of execution while it polls the API waiting for the task to be completed.  This pattern is used for API calls that can take some time and are generally used for the services that create,  update and manage resources within the cloud e.g. the create virtual machine and power on virtual machine methods follow this pattern.</li></ul><p>For more details please see <a href="EBA---ACloud_61115560.html">EBA - ACloud</a></p><h1 id="EBA-ComponentDesign-5.EnvironmentBuildRepository">5. Environment Build Repository </h1><p class="confluence-link">This is a PostgreSQL database modelled closely on the agnostic configuration schema (see  <a href="https://<confluenceurl>/pages/viewpage.action?pageId=42830123">Environment Build Database ERD</a> for the layout, and <a href="EBA---Agnostic-Cloud-Schema_64881745.html">EBA - Agnostic Cloud Schema</a> for the principles behind it).</p><p>The Environment Build Repository takes data from <span class="confluence-link">Import Program</span> and outputs environment&amp;organisational network data to the Export Program. It also provides information regarding the available versions of a given environment to the Environment Action Orchestrator (Jenkins) (see <a href="EBA---Detailed-Jenkins-Environment-Build-flow_65490998.html">EBA - Detailed Jenkins Environment Build flow</a>). Note that the data in the imported XML files, the Environment Build Repository, and the Export XML files are identical hence this is why the fully-open sourced version can bypass this stage. The purpose of the Environment Build Repository is to help manage thousands of environments, by storing history about what was built when. There are many extra potential customisations that could be planned on top of this database. The DNat (Dynamic Network Address Translation), Customisation Script Mapping and Template Version Mapping tables are empty and not currently implemented. </p><p class="confluence-link">Note there is also a H2 (<a href="http://www.h2database.com/html/main.html" class="external-link" rel="nofollow">http://www.h2database.com/html/main.html</a>) in-memory database version of this to run the unit tests on.</p><p class="confluence-link">This database includes;</p><ul><li class="confluence-link">1 table per XML element for the Environment Definition and Environment Container files (&quot;Environment Container&quot; is the file generated by the Visio Export Tool's &quot;Export Organisation Network&quot; button and &quot;Environment Definition&quot; is the file created by the &quot;Export Virtual Machine Container&quot; button)</li><li class="confluence-link">reference data for the <a href="#EBA-ComponentDesign-hardwareprofile">hardware profile</a> (as set by the Import Program, which maps the 2-CPU 8GM RAM VM's to actual Amazon &quot;m3.large&quot; instances). Note the CustomisationScriptMapping and TemplateVersionMapping tables are not yet implemented</li><li class="confluence-link">a logging table (envbuild.EnvironmentContainerBuild) for the environment container (i.e. organisation network) builds - when it started, finished, did it succeed etc</li><li class="confluence-link">a logging table (envbuild.EnvironmentBuild) for the environment definition builds - when it started, finished, did it succeed etc.</li></ul><h3 id="EBA-ComponentDesign-5.1EBSAspecificdetails;">5.1 EBSA specific details;</h3><p><span style="color: rgb(0,0,0);">The database is named ENVIRONMENT_BUILD and is hosted on <span style="color: rgb(0,0,0);">dbstzm03.st</span>-tooling1.ipt.local. You can access it using phpPgAdmin online at localhost:NNNN/environmentmanagementdb/ after configuring <a href="https://<confluenceurl>/display/EN/Proxy+Access+to+Service+Jenkins" rel="nofollow"><span style="color: rgb(0,0,0);">Proxy Access to Service Jenkins</span></a>. See /opt/environment-build-database-config-rpm/dbstzm03/setEnv.sh on dbstzm03 for credentials.</span></p><p><span style="color: rgb(0,0,0);">It is managed with Liquibase changelog files which are packaged into the: <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/ServiceDescription/environment-build-database-rpm" rel="nofollow"><span style="color: rgb(0,0,0);">environment-build-database-rpm</span></a>. This is built by the EBSA_ENVIRONMENT_BUILD_DATABASE_RPM_FLOW job and deployed using the EBSA_ENVIRONMENT_BUILD_DATABASE_RPM_PUPPET_DEPLOY job on Dev Jenkins (djmtzm01.st-tooling1.ipt.local). See \ServiceDescription\environment-build-database-rpm\src\main\sql\liquibase-databasechangelog.xml in Stash for how it builds the database - essentially, it runs liquibase-schema.sql, then liquibase-tables.sql, then liquibase-constraints.sql, then all the change files (liquibase-changes-EBSAD-12536.sql etc) in order.<br /></span></p><p><span style="color: rgb(0,0,0);">The environment-build-database-rpm references the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/ServiceDescription/environment-build-database-config-rpm" rel="nofollow"><span style="color: rgb(0,0,0);">environment-build-database-config-rpm</span></a> which defines the database connection details and invokes Liquibase<a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/ServiceDescription/environment-build-database-config-rpm" rel="nofollow"><span style="color: rgb(0,0,0);">.</span></a> The config rpm is built by the EBSA_ENVIRONMENT_BUILD_DATABASE_CONFIG_RPM_FLOW job on Dev Jenkins. There is currently no deploy job for this rpm.</span></p><p><span style="color: rgb(0,0,0);">Typically the config rpm will not need to change whereas the rpm containing the Liquibase changelog files will need to be built and redeployed whenever the database changes (e.g. new reference data added).</span></p><p><span style="color: rgb(0,0,0);">The Java interface to this database is implemented in the <strong><a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-database" rel="nofollow"><span style="color: rgb(0,0,0);">environment-build-database</span></a></strong> project. JPA/Hibernate is used but calling components are hidden from this implementation and simply call either the ReadManager or UpdateManager to perform persistence. This Java project is built by the EBSA_ENVIRONMENT_BUILD_DATABASE_LIB_FLOW job on Dev Jenkins. It is not deployed standalone but is a dependency jar of the Import and Export programs and the Environment Build tool.</span></p><p><span style="color: rgb(0,0,0);">An <a class="external-link" href="http://www.h2database.com/html/main.html" rel="nofollow"><span style="color: rgb(0,0,0);">H2</span></a> version of the database is used for unit testing. Online access is available through the <a class="external-link" href="http://www.h2database.com/html/quickstart.html#h2_console" rel="nofollow"><span style="color: rgb(0,0,0);">H2 console</span></a>. The database url is:</span><br /><span style="color: rgb(0,0,0);">jdbc:h2:&lt;path to local clone of ebsa-ci-components&gt;\Function\environment-build-database\src\test\resources\h2db\h2db.</span><br /><span style="color: rgb(0,0,0);"> Credentials are in: /environment-build-database/src/test/java/com/ipt/ebsa/environment/build/DBTest.java.</span><br /><span style="color: rgb(0,0,0);">Use liquibase to apply changes by running ebsa-ci-components\ServiceDescription\environment-build-database-rpm\liquibase-h2.sh</span></p><h1 id="EBA-ComponentDesign-6.EnvironmentBuild">6. Environment Build</h1><p><span style="color: rgb(0,0,0);"> </span>The Environment Build is a set of Java code that is called from Jenkins, iterates over the build plans and calls ACloud/SSH as required to instantiate and configure the specified VMs and networks.</p><p>The Java source code is in the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build" rel="nofollow">environment-build</a> project, and built by the EBSA_ENVIRONMENT_BUILD_FLOW job on Dev Jenkins. It's implemented as a CLI which is invoked by the UI. Basic operations are:<span style="color: rgb(0,0,0);"> <br /></span></p><ul><li>checkout the build plans (when the user selects a cloud provider in the UI)</li><li>prepare the sequence of actions to be executed to build the environment e.g. populate the parameter placeholders in the Build Plan (when the user clicks &quot;Generate plan&quot;)</li><li>execute the actions (when the user clicks &quot;Build&quot;). This includes:<ul><li>calling the appropriate Export program (agnostic or vCloud) to retrieve the configuration XML defining the entities to be built (e.g. VMs, networks, etc)</li><li>checking out the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/environmentconfiguration/browse" rel="nofollow">VM customisation scripts repo</a> used to customise VMs when they are created.</li><li>invoking the aCloud client (AWS) or vCloud client (Skyscape) to execute each command specified in an infra action</li><li>invoking the ssh command specified in each ssh action (using the JschManager developed for Self-Service)</li></ul></li></ul><p>The Build Plans are documented here <a href="EBA---Build-Plans_65491060.html">EBA - Build Plans</a>.</p><h3 id="EBA-ComponentDesign-6.1EBSAspecificdetails;">6.1 EBSA specific details;</h3><p>The Environment Build is packaged as a standalone Java CLI in the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/ServiceDescription/environment-build-rpm" rel="nofollow">environment-build-rpm</a> which is built by the EBSA_ENVIRONMENT_BUILD_RPM_BUILD job on Dev Jenkins. Deployed to Environment Management Jenkins using the EBSA_ENVIRONMENT_BUILD_PUPPET_DEPLOY job on Dev Jenkins. The properties file <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/puppet/browse/modules/ebsa/files/environment_build/djmtzm04/config.properties?at=st-tooling1" rel="nofollow">config.properties</a> deployed to djmtzm04:/opt/environment-build/config/ is managed by puppet. This defines the location of the git repos, database connection details, ssh configuration, and the cloud provider specific properties</p><p><span style="color: rgb(0,0,0);"> </span>To deploy a new version of the environment build tool carry out the following steps:</p><ol><li>Push all of the changes to the repository (ebsa-ci-components).<ol><li>If the changes were made to aCloud, run the ebsa-platformcomponents-acloud-rpmflow-flow in the Dev Jenkins (using default build parameters).</li><li>Retrieve artefact ID from the logs (e.g. 1.0.84).</li><li>Update ebsa-ci-components/Function/environment-build/pom.xml, replace the old aCloud RPM version with the new one (there are 2 XML tags that need changing).</li></ol></li><li>Execute EBSA_ENVIRONMENT_BUILD_FLOW in the Dev Jenkins (using default build parameters).</li><li>Retrieve artefact ID from the logs (e.g. 1.0.237).</li><li>Deploy the tool by executing EBSA_ENVIRONMENT_BUILD_PUPPET_DEPLOY in the Dev Jenkins.<ol><li>Specify the artefact ID from Point 3. in the version field (e.g. 1.0.237)</li><li>Select the target box (02 = CI Jenkins, 04 = Env Man Jenkins)<span style="color: rgb(0,0,0);"> <br /></span></li></ol></li></ol><p>The Build plans are kept at the <a class="external-link" href="https://<stashurl>/projects/EN/repos/management/browse/plans" rel="nofollow">build plans repo</a> and also see the <a class="external-link" href="https://<stashurl>/projects/EN/repos/management/browse/plans/global/BaseActions.xml" rel="nofollow">base set of actions</a>. The java code that unmarshalls the build plan to JAXB objects is in the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-schema" rel="nofollow">environment-build-schema</a> project. Note that <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-schema/src/main/resources/EnvironmentBuildSchema-1.0.xsd" rel="nofollow">EnvironmentBuildSchema-1.0.xsd</a> references the cloud provider commands in  <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/acloud/aCloudConfiguration/src/main/resources/aCloudCommand-1.0.xsd" rel="nofollow">aCloudCommand-1.0.xsd</a> and <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/vcloud/vCloudConfiguration/src/main/resources/vCloudCommand-2.0.xsd" rel="nofollow">vCloudCommand-2.0.xsd</a> but the JAXB objects for those schemas are built by the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/acloud/aCloudConfiguration" rel="nofollow">aCloudConfiguration</a> and <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/vcloud/vCloudConfiguration" rel="nofollow">vCloudConfiguration</a> projects respectively and excluded from the build of <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-schema" rel="nofollow">environment-build-schema</a> by its pom.xml. Built by the EBSA_ENVIRONMENT_BUILD_SCHEMA_FLOW job on Dev Jenkins. Not deployed standalone but is a dependency jar of the Environment Build Tool Engine.</p><h3 id="EBA-ComponentDesign-6.2OrganisationNetworksinSkyscape"><span style="color: rgb(0,0,0);"> 6.2 Organisation Networks in Skyscape</span><span style="color: rgb(0,0,0);"> </span><strong><span style="color: rgb(0,0,0);"><br /></span></strong></h3><p><span style="color: rgb(0,0,0);">For Amazon, we expect 2 XML files to contain the full definition of both the Environment and its associated EnvironmentContainerDefinition.These will be built, confirmed to exist, or deleted according to the Build Plan. <br /></span></p><p><span style="color: rgb(0,0,0);">For Skyscape, the XML is expected to contain the full definition of the Environment but only the names of the Organisation Networks, <span style="color: rgb(0,0,0);">Gateways and Data Centers in the EnvironmentContainerDefinition which are matched to the existing EnvironmentContainerDefinition in the database. This is because EnvironmentContainerDefinitions have never needed to be created in Skyscape since they already existed before the tool was written. The ability to create EnvironmentContainerDefinitions in Skyscape has been implemented but is untested. <br /></span></span></p><h3 id="EBA-ComponentDesign-6.3ImportProgram">6.3 Import Program</h3><p><span style="color: rgb(0,0,0);">The Import Program is a Jenkins job that monitors the Environment Action Repository (i.e. GIT) for new or modified XML files (environment XML or organisation network XML as exported by the Visio Export Tool) and uploads them into the</span> <a href="#EBA-ComponentDesign-environmentbuildrepo">Environment Build Repository</a><span style="color: rgb(0,0,0);"> (a PostgreSQL database). The purpose behind this is to keep track of new infrastructure designs as they come in and ensure they are available for selection in the Environment Action Orchestrator tool.</span></p><h4 id="EBA-ComponentDesign-6.3.1Terminology"><span style="color: rgb(0,0,0);">6.3.1 Terminology</span></h4><p><span style="color: rgb(0,0,0);">For historical reasons, the Import Program talks about &quot;environment containers&quot; (or just &quot;containers&quot;) which are the Organisation Networks, and &quot;environment definition&quot; (or just &quot;environment&quot;) files which are the XML files representing the actual VM and application networks to be built.</span><span style="color: rgb(0,0,0);"> An Organisation Network is common across many environments and rarely changes, whereas each individual environment definition may change every release. <br /></span></p><h4 id="EBA-ComponentDesign-6.3.2Jenkinsconfiguration">6.3.2 Jenkins configuration</h4><p>Environment Management Jenkins can be accessed by following the instructions from the page named <a href="https://<confluenceurl>/display/EN/Proxy+Access+to+Service+Jenkins" rel="nofollow">Proxy Access to Service Jenkins</a>. This looks at the Environment Management Repository (i.e. Git or Stash), in the &quot;/repos/management/browse/exports&quot; directory which is where Infrastructure Architects commit the configuration/organisation XML files when they are finished with the design.</p><p>Jenkins uses the <a class="external-link" href="https://wiki.jenkins-ci.org/display/JENKINS/Build+Flow+Plugin" rel="nofollow">Jenkins Build Flow plugin</a> to poll the Environment Management Repository for new or modified committed XML files.</p><p>The import program is built by the EBSA_ENVIRONMENT_BUILD_METADATA_IMPORT_FLOW job on Dev Jenkins. It is packaged as a standalone Java CLI in the environment-build-metadata-import-rpm which is built by the EBSA_ENVIRONMENT_BUILD_METADATA_IMPORT_RPM_BUILD job on Dev Jenkins. It is deployed to Environment Management Jenkins (djmtzm04.st-tooling1.ipt.local) using the EBSA_ENVIRONMENT_BUILD_METADATA_IMPORT_PUPPET_DEPLOY job on Dev Jenkins. It uses the Maven Codehaus Appassembler plugin in &quot;environment-build-metatdata-import\pom.xml&quot; to generate a script version of the Java file &quot;com.ipt.ebsa.environment.metadata.generation.EnvironmentBuildMetadataImportCLI&quot; into  &quot;/opt/environment-build-metadata-import/bin/app.sh&quot;.</p><h4 id="EBA-ComponentDesign-6.3.3Jenkinsflow">6.3.3 Jenkins flow</h4><ol><li>the  IMPORT_VISIO_EXTRACT_FLOW job polls the <a href="#EBA-ComponentDesign-2.EnvironmentActionRepository">Environment Action Repository</a> (git) for new or modified file,</li><li>the IMPORT_VISIO_EXTRACT_FLOW job forks a new IMPORT_VISIO_EXTRACT job for each modified/new file, passing in the filename</li><li>the IMPORT_VISIO_EXTRACT calls &quot;/opt/environment-build-metadata-import/bin/app.sh&quot; which calls &quot;com.ipt.ebsa.environment.metadata.generation.EnvironmentBuildMetadataImportCLI&quot; with the new/modified XML file and the database configuration file. </li></ol><p>The Jenkins output for this is;</p><p>  <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/65486679/65495179.jpg" data-image-src="attachments/65486679/65495179.jpg" data-unresolved-comment-count="0" data-linked-resource-id="65495179" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="jenkins_import.jpg" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="65486679" data-linked-resource-container-version="87"></span></p><h4 id="EBA-ComponentDesign-6.3.4Javaflow">6.3.4 Java flow</h4><p>Java source code is in the environment-build-metadata-import project. Basic operations are:</p><ol><li>Unmarshall the XML from Visio to a JAXB object graph;<ul><li>the entry point is the importEnvironmentMetadata() method of the &quot;com.ipt.ebsa.environment.metadata.generation.EnvironmentBuildMetadataImport&quot; class, as called by the Jenkins flow above, which<ul><li><p>loops over the specified XML files, unmarshalling the XML into a set of JAXB objects</p><ul><li>the &quot;environment container&quot; which corresponds to the Organisation Network file from Visio</li><li>the &quot;environment definition&quot; which corresponds to the &quot;Export Virtual Machine Container&quot; XML file from Visio.</li></ul></li></ul></li></ul></li><li>Navigate the JAXB object graph instantiating the equivalent database Entity objects and copying across the attributes<ul><li><p>It uses JPA to persist these in the <a href="#EBA-ComponentDesign-5.EnvironmentBuildRepository">Environment Build Repository</a>, which is a Postgres database as configured in &quot;com.ipt.ebsa.environment.metadata.generation.Configuration&quot;</p><ul><li><p>persists the Environment Container (the &quot;Export Organisation Network&quot; XML file from Visio)</p></li><li>persists the Environment Definition (the the &quot;Export Virtual Machine Container&quot; XML file from Visio)<span style="color: rgb(0,0,0);"> </span><span style="color: rgb(0,0,0);"><br /></span></li></ul></li></ul></li><li>Persist the database Entity objects using the UpdateManager from the environment-build-database project</li></ol><p>This configuration and Organisation Network data is now saved in the database, and available to the Export program to convert to Skyscape/AWS XML as required.</p><h4 id="EBA-ComponentDesign-6.3.5HardwareProfile">6.3.5 Hardware Profile<strong> <br /></strong></h4><p>Note that the import program sets the hardware profile by looking up the number of CPU's, interfaces, amount of memory in the Postgres &quot;envbuild.hardwareprofile&quot; table, and sets that in the envbuild.virtualmachine table. The envbuild.hardwareprofile table looks like the below, so a Virtual Machine with 2 CPU's, 4GB RAM and 3 interfaces would be assigned a AWS profile of &quot;c3.large&quot;. The VMRole is not widely used; the idea was that a Database system (VMRole=&quot;DBS&quot;) might need faster storage or more memory than a default system. In practice, most VMs have a VMRole=Default.</p><p>Note that the open source version of ACloud had this functionality extracted out into a VB lookup in VisioExportConfig.xls to enable it to run without the Build Environment Repository; this full restricted source version has the original lookup in the postgres database.</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col /> <col /> <col /> <col /> <col /> </colgroup><tbody><tr><td colspan="1" class="confluenceTd">CPU count</td><td colspan="1" class="confluenceTd">Memory</td><td colspan="1" class="confluenceTd">Interfaces</td><td colspan="1" class="confluenceTd">VMRole</td><td colspan="1" class="confluenceTd">AWS Profile</td></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd">2</td><td class="confluenceTd">3</td><td class="confluenceTd">Default</td><td class="confluenceTd">t2.medium</td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">4</td><td class="confluenceTd">3</td><td class="confluenceTd">Default</td><td class="confluenceTd">c3.large</td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">4</td><td class="confluenceTd">8</td><td class="confluenceTd">Default</td><td class="confluenceTd">c3.4xlarge</td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">8</td><td class="confluenceTd">3</td><td class="confluenceTd">Default</td><td class="confluenceTd">m3.large</td></tr><tr><td class="confluenceTd">2</td><td class="confluenceTd">4</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">c3.xlarge</td></tr><tr><td class="confluenceTd">4</td><td class="confluenceTd">8</td><td class="confluenceTd">4</td><td class="confluenceTd">DBS</td><td class="confluenceTd">c3.xlarge</td></tr><tr><td class="confluenceTd">4</td><td class="confluenceTd">8</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">c3.xlarge</td></tr><tr><td class="confluenceTd">1</td><td class="confluenceTd">2</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">c3.xlarge</td></tr><tr><td class="confluenceTd">4</td><td class="confluenceTd">16</td><td class="confluenceTd">4</td><td class="confluenceTd">DBS</td><td class="confluenceTd">m3.xlarge</td></tr><tr><td class="confluenceTd">4</td><td class="confluenceTd">16</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">m3.xlarge</td></tr><tr><td class="confluenceTd">4</td><td class="confluenceTd">32</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">r3.xlarge</td></tr><tr><td class="confluenceTd">8</td><td class="confluenceTd">32</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">m3.2xlarge</td></tr><tr><td class="confluenceTd">8</td><td class="confluenceTd">16</td><td class="confluenceTd">4</td><td class="confluenceTd">Default</td><td class="confluenceTd">c3.2xlarge</td></tr></tbody></table></div><h3 id="EBA-ComponentDesign-6.4Exportprogram">6.4 Export program</h3><p><span style="color: rgb(0,0,0);">The Export Program takes the XML data for Environment and Container Definitions out of the Environment Build Repository and sends it to the ACloud parser. At this stage the XML is provider agnostic, the only difference is the &lt;provider&gt; element that will have a value of &quot;SKYSCAPE&quot; or &quot;AWS&quot;. The ACloud parser switches on that &lt;provider&gt; parameter and executes commands against the relevant API. </span></p><p>The Export Program is called by the Environment Build code upon a user pressing &quot;Build&quot; in the Environment Action Orchestrator (see <a href="EBA---Detailed-Jenkins-Environment-Build-flow_65490998.html">EBA - Detailed Jenkins Environment Build flow</a>). This iterates over the Build Plan to generate potentially many Execution Plans for potentially many Environment Definitions and Container Definitions (for Container Definitions the build plan probably wouldn't modify them but might e.g. confirm the organisational network exists). For each Environment Definition/Environment Container file the Environment Build code finds, it calls<span style="color: rgb(0,0,0);"> EnvironmentBuildMetadataAgnosticExport (package com.ipt.ebsa.environment.metadata.export.agnostic).</span></p><p><span style="color: rgb(0,0,0);">Note the code in <span style="color: rgb(0,0,0);">EnvironmentBuildMetadataVCloudExport is legacy and was used to generate old ST (system test) environments for which there was only <span style="color: rgb(0,0,0);"><span class="external-link"><span style="color: rgb(0,0,0);">vCloudConfig-2.0.xsd</span></span> </span>XML; this has been fixed forward to use the Agnostic format <span style="color: rgb(0,0,0);"> (<a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-platform-components/browse/Function/acloud/aCloudConfiguration/src/main/resources/AgnosticCloudConfig-1.0.xsd" rel="nofollow"><span style="color: rgb(0,0,0);">AgnosticCloudConfig-1.0.xsd</span></a>)</span>.<br /></span></span></p><p>The Java source code is in the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-metadata-export" rel="nofollow">environment-build-metadata-export</a> project. Basic operations are:<span style="color: rgb(0,0,0);"> <br /></span></p><ol><li>Load the database Entity object graph for the given environment using the ReadManager from the <a class="external-link" href="https://<stashurl>/projects/EBSAT/repos/ebsa-ci-components/browse/Function/environment-build-database" rel="nofollow">environment-build-database</a> project</li><li>Navigate the database Entity graph instantiating the equivalent JAXB objects from the relevant schema and copying across the attributes</li><li>Return the root JAXB object</li><li>Write it to XML</li></ol><p><span style="color: rgb(0,0,0);"> </span>Built by the EBSA_ENVIRONMENT_BUILD_METADATA_EXPORT_FLOW job on Dev Jenkins. Not deployed standalone but is a dependency jar of the Environment Build Tool Engine</p><h1 id="EBA-ComponentDesign-7.EnvironmentConfigurationOrchestration">7. Environment Configuration Orchestration</h1><p>MCollective is used to orchestrate the Environment Configuration (Puppet) agent.  MCollective is a message-queue based orchestration utility; messages for specific servers to act on are pushed to the queue, and an agent on each server within the EBSA-managed estate listens for messages that it needs to act on.</p><p><span style="color: rgb(0,0,0);">Puppet &amp; MCollective are already integrated in base OS image. When VMs come online in cloud, they are ready to accept commands from MCollective admin workstation. Till the last bit of provisioning process (application deployment), the puppet agent runs are orchestrated by MCO, which again run as job by Jenkins.</span></p><p><span style="color: rgb(0,0,0);">The amount of supported configuration possible within a Puppet Enterprise environment is limited, so a default out-of-the-box installation will be used, that is using activemq as middleware component for MCo.</span></p><h1 id="EBA-ComponentDesign-8.EnvironmentConfigurationController">8. Environment Configuration Controller</h1><p>Once a virtual machine is in operation, Puppet Enterprise is used to manage key parts of its environment configuration.  The configuration items that Puppet Enterprise will manage are listed below:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><td class="confluenceTd"><p><strong>Category</strong></p></td><td class="confluenceTd"><p><strong>Scope of Puppet Management</strong></p></td></tr><tr><td class="confluenceTd"><p>Operating system configuration</p></td><td class="confluenceTd"><p><span style="color: rgb(0,0,0);">Once a virtual machine is instantiated with a base operating system, Puppet Enterprise will be used to install a set of additional software packages that are required by EBSA to manage the operating system. For the CentOS and RHEL images this includes packages such as ntpd and openssl.</span></p><p><span style="color: rgb(0,0,0);">Puppet Enterprise will also make changes to the various system packages as required, such as network (e.g. disable ipv6 and apply ipv4 static IP addresses) and system configuration of the Linux Kernal to support CIS lockdown standards.</span></p></td></tr><tr><td class="confluenceTd"><p>Operating system patching</p></td><td class="confluenceTd"><p>Puppet will ensure that specific named versions of operating system patches are installed on target virtual machines.</p></td></tr><tr><td class="confluenceTd"><p>Middleware installation</p></td><td class="confluenceTd"><p>Puppet will ensure that specific named versions of middleware are installed on target virtual machines.</p></td></tr><tr><td class="confluenceTd"><p>Middleware configuration</p></td><td class="confluenceTd"><p>Puppet will ensure that specific named versions of middleware configuration are installed on target virtual machines.</p></td></tr><tr><td class="confluenceTd"><p>Middleware patching</p></td><td class="confluenceTd"><p>Puppet will ensure that specific named versions of middleware patches are installed on target virtual machines.</p></td></tr><tr><td class="confluenceTd"><p>Application code installation (onto Middleware) Repository</p></td><td class="confluenceTd"><p>Puppet will ensure that specific named versions of application code are installed on target virtual machines.</p></td></tr></tbody></table></div><h1 id="EBA-ComponentDesign-9.DynamicEnvironmentDataRepository">9. Dynamic Environment Data Repository</h1><p>Puppet and hiera hold environment configuration details. Together with MCollective, it gives us control over the environment (when to configure and what part of the environment configuration). More details about how modules are written &amp; version controlled, how the environment classification and definition is populated by the build process and how mco commands are issued are explained here <a href="EBA---Puppet-and-Hiera_65488099.html">EBA - Puppet and Hiera</a>.</p><h1 id="EBA-ComponentDesign-10.SelfService">10. Self Service</h1><p>Self Service, the component, is a set of Java code that is called from Jenkins, to deploy a component, application or release to an environment. The component, application and release definitions are held in the <a href="#EBA-ComponentDesign-11.ReleaseManagementRepository">Release Management Repository</a> - this defines the artefacts to be deployed. The <a href="EBA---Deployment-Self-Service-User-guides_57514068.html">Self Service User Guide</a> describes the process for defining these.</p><p>The actual deployable artefacts are held in the Continuous Test and Integration subsystem in a Nexus database.  <span style="color: rgb(255,0,0);"> </span></p><p>The Self Service component also requires a deployment descriptor to defines how the component, application or release is to be deployed. The deployment descriptors are held in the <a href="#EBA-ComponentDesign-2.EnvironmentActionRepository">Environment Action Repository</a>.</p><h2 id="EBA-ComponentDesign-10.1Origin,transmissionanddeploymentofartefacts.">10.1 Origin, transmission and deployment of artefacts.</h2><p>The diagram below shows the progression of artefacts through the system through creation, configuration management, transmission to target and deployment.</p><p>

<map id="gliffy-map-26250083-334" name="gliffy-map-26250083-334"></map>
<table width="100%" class="gliffy-macro-table">
    <tr>
        <td >
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
 </caption>

                <tr>
                    <td>
                        <img style="border: none; width: 900px;" usemap="#gliffy-map-26250083-334" src="attachments/26151248/26250084.png" alt="" class="gliffy-macro-image"/>
                    </td>
                </tr>
            </table>
 
        </td>
    </tr>
</table>


</p><h2 id="EBA-ComponentDesign-10.2SelfServiceLevels">10.2 Self Service Levels</h2><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/65486679/65498500.png" data-image-src="attachments/65486679/65498500.png" data-unresolved-comment-count="0" data-linked-resource-id="65498500" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="OS - ssoverview.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="65486679" data-linked-resource-container-version="87"></span></p><p>The Self Service component has evolved from just deploying components, to deploying applications (collections of versioned components) to deploying releases (collections of applications). These are referred to by levels (see diagram above) in the following design pages:.</p><ul><li><a href="https://<confluenceurl>/pages/viewpage.action?pageId=22356256">Design note - contributing Release Metadata from the Build/CI System</a></li><li><a href="25186459.html">Design note - Environment &amp; Release Management V1.x</a></li><li><a href="24390972.html">Design note - Environment &amp; Release Management V2.x</a></li><li><a href="26163260.html">Design note - Environment &amp; Release Management V3.x</a></li></ul><h1 id="EBA-ComponentDesign-11.ReleaseManagementRepository">11. Release Management Repository</h1><p>This repository holds information about which components, applications and releases, and their respective versions, are available for deployment via Self Service. The Entity Relationship Diagram for the Release Management Repository, which is currently implemented as a MySQL DB, is shown below.</p><p>

<map id="gliffy-map-27230541-7406" name="gliffy-map-27230541-7406"></map>
<table width="100%" class="gliffy-macro-table">
    <tr>
        <td >
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
 </caption>

                <tr>
                    <td>
                        <img style="border: none; width: 1152px;" usemap="#gliffy-map-27230541-7406" src="attachments/26968994/27230542.png" alt="" class="gliffy-macro-image"/>
                    </td>
                </tr>
            </table>
 
        </td>
    </tr>
</table>


</p><p>This link, <a href="EBA---Deployment-Self-Service-User-guides_57514068.html">Self Service User Guide</a> explains how the Self Service and Release Management Repository components work from a user perspective.</p><h1 id="EBA-ComponentDesign-12.VMTemplates">12. VM Templates</h1><p>The VM Templates component is a collection of Operating System images that have been prepared to a suitable security accredited specification for the environment in which they are to be used. Two images have been composed for IPT, a CentOS 6 64 bit OS image and a RHEL 6 64 bit OS image. The image definition and conformance to standards are defined here <a href="65501090.html">EBA - Virtual Machine(VM) Templates</a>.</p><h1 id="EBA-ComponentDesign-13.DeploymentRepository">13. Deployment Repository</h1><p>The deployment repository provides a  central package manager that installs, updates and removes packages onto single target, or groups of target base operating systems. For the RHEL and CentOS VM's this will be realised as an instance of Yum (<a href="http://yum.baseurl.org/" rel="nofollow" class="external-link">http://yum.baseurl.org/</a>) a package manager used by RHEL and CentOS to manage packages in RedHat Package Manager (RPM) format.</p><p>A separate deployment repository will be provided within each distinct organisation security zone to manage the packages deployed to virtual machines within that organisation security zone.</p><p>The Yum repositories, sizing and purpose, across the IPT estate can be found here - <a href="Logical-Design---Yum-Repositories_65478748.html">Logical Design - Yum Repositories</a>.</p><p>Notes on configuring Yum for IPT can be found here - <a href="https://<confluenceurl>/display/EN/Yum+Repository+Configuration">Yum Repository Configuration</a>.</p><h1 id="EBA-ComponentDesign-14.Monitoring">14. Monitoring</h1><p>The monitoring component is responsible for gathering monitoring and performance indicators (CPU, memory, network, disk space and processes) from virtual machines using an agent on each monitored host and aggregating the results on a monitoring dashboard. Zabbix is used to implement this component. Details about how Zabbix is configured and used to fulfil the requirements of this component can be found here - <a href="Monitoring_25187155.html">Monitoring</a>.</p><p> </p><p> </p><p> </p><p> </p><p> </p><p> </p>
                    </div>

                                        
                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
