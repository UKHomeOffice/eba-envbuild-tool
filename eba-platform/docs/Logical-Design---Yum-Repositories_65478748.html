<!DOCTYPE html>
<html>
    <head>
        <title>Logical Design - Yum Repositories</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Logical Design - Yum Repositories
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <p>The following Yum repositories exist:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"> </th><th class="confluenceTh">NP</th><th colspan="1" class="confluenceTh">PR</th><th colspan="1" class="confluenceTh">NPA</th><th colspan="1" class="confluenceTh">Contents</th><th colspan="1" class="confluenceTh">Size in NP at 07/01</th><th colspan="1" class="confluenceTh"> </th></tr><tr><td class="confluenceTd"><span>CentOS6.5_64</span></td><td class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd">CentOS Packages (Bulk import of 3rd party repo)</td><td colspan="1" class="confluenceTd">5.2G</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td class="confluenceTd"><span>centos-6-server</span></td><td class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-cross" src="images/icons/emoticons/error.png" data-emoticon-name="cross" alt="(error)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-cross" src="images/icons/emoticons/error.png" data-emoticon-name="cross" alt="(error)"/></td><td colspan="1" class="confluenceTd">CentOS Packages <span>(Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">5.2G</td><td colspan="1" class="confluenceTd">Recommend to remove <span>from yum.repo.d configuration</span></td></tr><tr><td class="confluenceTd"><span>centos-6-updates</span></td><td class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-cross" src="images/icons/emoticons/error.png" data-emoticon-name="cross" alt="(error)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-cross" src="images/icons/emoticons/error.png" data-emoticon-name="cross" alt="(error)"/></td><td colspan="1" class="confluenceTd">CentOS Packages<span> (Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">4.5G</td><td colspan="1" class="confluenceTd">Recommend to remove from yum.repo.d configuration</td></tr><tr><td colspan="1" class="confluenceTd"><span>CentOS6_updates</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd">CentOS Packages<span> (Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">277M</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>curl_repo</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd">2 x Curl Packages, an Amanda Server Package and a few other misc 3rd party</td><td colspan="1" class="confluenceTd">3.3M</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>glusterfs</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd">glusterfs packages</td><td colspan="1" class="confluenceTd">9.9M</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>Hadoop</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-cross" src="images/icons/emoticons/error.png" data-emoticon-name="cross" alt="(error)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-cross" src="images/icons/emoticons/error.png" data-emoticon-name="cross" alt="(error)"/></td><td colspan="1" class="confluenceTd">Hadoop Packages - I would assume we (will) need these in NPA and PR?!</td><td colspan="1" class="confluenceTd">3.2G</td><td colspan="1" class="confluenceTd">
    <span class="jira-issue resolved" >
        <a href="https://<jiraurl>/browse/EBSAD-25323?src=confmacro" class="jira-issue-key"><img class="icon" src="https://<jiraurl>/images/icons/ico_story.png" />EBSAD-25323</a>
                    -
            <span class="summary">In order to allow the upgrade of Hadoop to HDP 2.3 please can the required packages be added to nexus and yum</span>
                <!-- The new status lozengens support for JIRA 6.2 or later. Otherwise we use the icon.-->
                                            <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success jira-macro-single-issue-export-pdf">Amazing</span>
            </span>
</td></tr><tr><td colspan="1" class="confluenceTd"><span>IPT_repo</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><p>IPT Application (self service deployed)</p><p>Middleware RPMs (self service deployed and manually deployed)</p><p>Some 3rd party packages (self service deployed and manually deployed)</p></td><td colspan="1" class="confluenceTd">653G</td><td colspan="1" class="confluenceTd">Housekeeping rules = if not in Hiera or Playbook then remove</td></tr><tr><td colspan="1" class="confluenceTd"><span>RHEL6.5_64</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd">RedHat Packages<span> (Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">3.4G</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>rhel-6-server-optional-rpms</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><span>RedHat Packages</span><span> (Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">11G</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>rhel-6-server-rpms</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><span>RedHat Packages</span><span> (Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">22G</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>RHEL6_updates</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><span>RedHat Packages</span><span> (Bulk import of 3rd party repo)</span></td><td colspan="1" class="confluenceTd">248M</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd"><span>rsyslog_v8</span></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd"><img class="emoticon emoticon-tick" src="images/icons/emoticons/check.png" data-emoticon-name="tick" alt="(tick)"/></td><td colspan="1" class="confluenceTd">Logging Packages - rsyslog, liblogging etc</td><td colspan="1" class="confluenceTd">5.7M</td><td colspan="1" class="confluenceTd"> </td></tr><tr><td colspan="1" class="confluenceTd">IPT_deploy_mwapp_repo</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">RPMs that have been installed in Yum as a result of an IPT self service deployment</td><td colspan="1" class="confluenceTd">NEW</td><td colspan="1" class="confluenceTd">Housekeeping rules = if not in Hiera or Playbook then remove</td></tr><tr><td colspan="1" class="confluenceTd">IPT_deploy_osenhance_repo</td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd"> </td><td colspan="1" class="confluenceTd">RPMs that have been added as software enhancements to the OS base build</td><td colspan="1" class="confluenceTd">NEW</td><td colspan="1" class="confluenceTd">To be implemented in the future</td></tr></tbody></table></div><h1 id="LogicalDesign-YumRepositories-Housekeeping">Housekeeping</h1><p>We should apply the following housekeeping logic to the IPT_repo and <span>IPT_deploy_mwapp_repo.</span></p><p><span>To house-keep a repository:</span></p><ol><li><span>Clone all the relevant Hiera repositories for the organisation. Parse all the Hieradata at the head of the relevant branch looking for packages defined in a system::package stanza. Write all package definitions (RPM name RPM version) to a file, or store in memory. This will be the list of installed package versions.</span></li><li><span>Iterate through the package versions in the repository and check if the package is in the list of installed package versions or if the package name is in the whitelist. </span><br /><pre>IF (!INSTALLED) &amp;&amp; (!WHITELIST) THEN</pre><pre>   Move package to archive dir</pre><p>END</p></li></ol><p><span>For the first week or so of operation we should move the package to an archive directory, in the same logical volume as the repository, so no extra space is needed. This will give us immediate increases in speed of repository metadata-regeneration. Once we are confident with the code, instead of moving the package to an archive directory this step should just remove the package.</span></p><p><span><br /></span></p><p><span>Constraints:</span></p><p><span>There are some packages which are installed but not declared in the hieradata. e.g the package resource is declared in a pp file in a module. If there are any packages of this type in the repository then the package name needs to be added to a whitelist which the archiving code will inspect.</span></p><p><span><br /></span></p><p><span><br /></span></p>
                    </div>

                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
