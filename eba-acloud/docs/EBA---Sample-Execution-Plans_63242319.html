<!DOCTYPE html>
<html>
    <head>
        <title>EBA - Sample Execution Plans</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            EBA - Sample Execution Plans
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <h2 id="EBA-SampleExecutionPlans-Example"> Example</h2><p class="confluence-link">The execution plan below is a good starting point for a new project, in that it will build all environments, VMs, ApplicationNetworks, OrganisationNetworks in the configuration XML file<span> as produced by the Visio stencil export tool (see </span><a href="EBA---Visio-Physical-Design_57512650.html">EBA - Visio Physical Design</a>). Essentially, the execution plan below makes the ACloud parser loop round the configuration XML and run the relevant create (found via reflection) method in the ACloud client on every element in the Visio configuration file in order.</p><pre class="code"><code><span class="pi">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br /><span class="tag">&lt;<span class="title">ac:execute</span> <span class="attribute">xmlns:ac</span>=<span class="value">&quot;http://ebsa.ipt.com/aCloudCommand-1.1&quot;</span> <span class="attribute">xsi:schemaLocation</span>=<span class="value">&quot;http://ebsa.ipt.com/aCloudCommand-1.1 aCloudCommand-1.1.xsd&quot;</span> <span class="attribute">xmlns:xsi</span>=<span class="value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span><br />	<span class="tag">&lt;<span class="title">ac:EnvironmentContainer</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>&gt;</span><br />		<span class="tag">&lt;<span class="title">ac:OrganisationNetwork</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span><br />                 &lt;!-- <code><span class="tag">&lt;<span class="title">ac:EdgeGateway</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span></code> --&gt;<br />		<span class="tag">&lt;<span class="title">ac:Environment</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>&gt;</span><br />			<span class="tag">&lt;<span class="title">ac:options</span>&gt;</span><br />				<span class="tag">&lt;<span class="title">ac:option</span> <span class="attribute">name</span>=<span class="value">&quot;overwriteEmptyTemplateMachines&quot;</span> <span class="attribute">value</span>=<span class="value">&quot;true&quot;</span>/&gt;</span><br />			<span class="tag">&lt;/<span class="title">ac:options</span>&gt;</span><br />			<span class="tag">&lt;<span class="title">ac:VirtualMachineContainer</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>&gt;</span><br />				<span class="tag">&lt;<span class="title">ac:ApplicationNetwork</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span><br />				<span class="tag">&lt;<span class="title">ac:VirtualMachine</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span><br />			<span class="tag">&lt;/<span class="title">ac:VirtualMachineContainer</span>&gt;</span><br />		<span class="tag">&lt;/<span class="title">ac:Environment</span>&gt;</span><br />	<span class="tag">&lt;/<span class="title">ac:EnvironmentContainer</span>&gt;</span><br /><span class="tag">&lt;/<span class="title">ac:execute</span>&gt;</span></code></pre><p><span>This creates a root &quot;execute&quot; element that wraps up all the potential VM's that may need building. The &lt;ac:EnvironmentContainer&gt; component is mandatory and maps to the &lt;EnvironmentContainer&gt; tag in the Visio configuration XML file. We have commented out the &lt;ac:EdgeGateway&gt; tag as this would not normally be built every time - only on first instantiation of the environment or on changes to that layer.</span></p><p><span>The &lt;ac:Environment&gt; tag corresponds to the &lt;Environment&gt; tag from the Visio configuration file. The vc:options element of &quot;overwriteEmptyTemplateMachines&quot; is a Skyscape workaround; in Skyscape a customisation can fail and you end up with a dead box that you can't do anything to- turn this setting on to overwrite these dead boxes. This is not required for AWS. <br /></span></p><p><span>The execution plan must conform to the <span>aCloudCommand-1.1.xsd schema, i.e. it must have a root &lt;ac:Execute&gt; element, an &lt;ac:EnvironmentContainer&gt; element etc.</span></span></p><p> </p><p><span><span>The errorStrategy tells the parser what to do if it encounters an error - it can either exit, continue etc. More details are listed below. </span></span></p><h2 id="EBA-SampleExecutionPlans-Sampleunittest">Sample unit test</h2><p>The aCloudClient/src/test/java/com/ipt/ebsa/agnostic/client/CliMultiFileImportTest.java is a good unit test to look into first. It runs in 4 stages, and takes in 2 main parameters - testEnvironmentDefinition.xml as created from the Visio stencil using the Visio export VB macro, and the execution plan to apply to that testEnvironmentDefinition.xml configuration file.</p><ol><li>check that the environments in the testEnvironmentDefinition.xml file don't exist</li><li>create all the environments in the testEnvironmentDefinition.xml</li><li>check all the environments in the testEnvironmentDefinition.xml exist</li><li>clean up - i.e. delete - all environments in the testEnvironmentDefinition.xml</li></ol><p>The JUnit test looks like this;</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Confluence" style="font-size:12px;">        String[] confirmDoesNotExistArgs = new String[] { &quot;-command&quot;, &quot;execute&quot;, &quot;-config&quot;, &quot;src/test/resources/aws/aws-test-config.properties&quot;, &quot;-networkLayout&quot;,
                &quot;src/test/resources/aws/testNetworkLayout.xml&quot;,&quot;-environments&quot;,
                &quot;src/test/resources/aws/testEnvironmentDefinition.xml&quot;, &quot;-executionplan&quot;, &quot;src/test/resources/aws/confirmAllNotExistVapp.xml&quot; };
        AgnosticClientCLI.main(confirmDoesNotExistArgs);
        
        String[] createArgs = new String[] { &quot;-command&quot;, &quot;execute&quot;, &quot;-config&quot;, &quot;src/test/resources/aws/aws-test-config.properties&quot;, &quot;-networkLayout&quot;,
                &quot;src/test/resources/aws/testNetworkLayout.xml&quot;,&quot;-environments&quot;,
                &quot;src/test/resources/aws/testEnvironmentDefinition.xml&quot;, &quot;-executionplan&quot;, &quot;src/test/resources/aws/createAll.xml&quot; };
        AgnosticClientCLI.main(createArgs);
        
        String[] confirmExistsArgs = new String[] { &quot;-command&quot;, &quot;execute&quot;, &quot;-config&quot;, &quot;src/test/resources/aws/aws-test-config.properties&quot;, &quot;-networkLayout&quot;,
                &quot;src/test/resources/aws/testNetworkLayout.xml&quot;,&quot;-environments&quot;,
                &quot;src/test/resources/aws/testEnvironmentDefinition.xml&quot;, &quot;-executionplan&quot;, &quot;src/test/resources/aws/confirmAllVapp.xml&quot; };
        AgnosticClientCLI.main(confirmExistsArgs);
        
        String[] deleteArgs = new String[] { &quot;-command&quot;, &quot;execute&quot;, &quot;-config&quot;, &quot;src/test/resources/aws/aws-test-config.properties&quot;, &quot;-networkLayout&quot;,
                &quot;src/test/resources/aws/testNetworkLayout.xml&quot;,&quot;-environments&quot;,
                &quot;src/test/resources/aws/testEnvironmentDefinition.xml&quot;, &quot;-executionplan&quot;, &quot;src/test/resources/aws/deleteEnvironment.xml&quot; };
        AgnosticClientCLI.main(deleteArgs);</pre>
</div></div><p>The execution plans are the last string parameter, e.g.</p><pre>1) src/test/resources/aws/confirmAllNotExistVapp.xml which looks like;</pre><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Confluence" style="font-size:12px;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ac:execute xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://ebsa.ipt.com/aCloudCommand-1.1 aCloudCommand-1.1.xsd&quot; xmlns:ac=&quot;http://ebsa.ipt.com/aCloudCommand-1.1&quot;&gt;
  &lt;ac:EnvironmentContainer command=&quot;confirm&quot; strategy=&quot;doesnotexist&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt;
     &lt;ac:Environment command=&quot;confirm&quot; strategy=&quot;doesnotexist&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt;
        &lt;ac:VirtualMachineContainer command=&quot;confirm&quot; strategy=&quot;doesnotexist&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt; &lt;/ac:VirtualMachineContainer&gt; 
      &lt;/ac:Environment&gt; 
   &lt;/ac:EnvironmentContainer&gt; 
 &lt;/ac:execute&gt;</pre>
</div></div><p><span>This uses the &quot;doesnotexist&quot; strategy to confirm every component in src/test/resources/aws/testEnvironmentDefinition.xml are not present- see resolveConfirmStrategy() in com.ipt.ebsa.agnostic.client.strategy.StrategyHandler for the Java code. <br /></span></p><p>2) src/test/resources/aws/createAll.xml (which is identical to the one at the top of the page)</p><pre class="code"><code><span class="pi">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br /><span class="tag">&lt;<span class="title">ac:execute</span> <span class="attribute">xmlns:ac</span>=<span class="value">&quot;http://ebsa.ipt.com/aCloudCommand-1.1&quot;</span> <span class="attribute">xsi:schemaLocation</span>=<span class="value">&quot;http://ebsa.ipt.com/aCloudCommand-1.1 aCloudCommand-1.1.xsd&quot;</span> <span class="attribute">xmlns:xsi</span>=<span class="value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span><br />	<span class="tag">&lt;<span class="title">ac:EnvironmentContainer</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>&gt;</span><br />		<span class="tag">&lt;<span class="title">ac:OrganisationNetwork</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span><br />                 &lt;!-- <code><span class="tag">&lt;<span class="title">ac:EdgeGateway</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span></code> --&gt;<br />		<span class="tag">&lt;<span class="title">ac:Environment</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>&gt;</span><br />			<span class="tag">&lt;<span class="title">ac:options</span>&gt;</span><br />				<span class="tag">&lt;<span class="title">ac:option</span> <span class="attribute">name</span>=<span class="value">&quot;overwriteEmptyTemplateMachines&quot;</span> <span class="attribute">value</span>=<span class="value">&quot;true&quot;</span>/&gt;</span><br />			<span class="tag">&lt;/<span class="title">ac:options</span>&gt;</span><br />			<span class="tag">&lt;<span class="title">ac:VirtualMachineContainer</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>&gt;</span><br />				<span class="tag">&lt;<span class="title">ac:ApplicationNetwork</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span><br />				<span class="tag">&lt;<span class="title">ac:VirtualMachine</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span>/&gt;</span><br />			<span class="tag">&lt;/<span class="title">ac:VirtualMachineContainer</span>&gt;</span><br />		<span class="tag">&lt;/<span class="title">ac:Environment</span>&gt;</span><br />	<span class="tag">&lt;/<span class="title">ac:EnvironmentContainer</span>&gt;</span><br /><span class="tag">&lt;/<span class="title">ac:execute</span>&gt;</span></code></pre><p><span> </span><br /><span>This walks over every node in the configuration file (&quot;src/test/resources/aws/testEnvironmentDefinition.xml&quot; ) and attempts to create each component in order.</span></p><pre>3) src/test/resources/aws/confirmAllVapp.xml which looks like </pre><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Confluence" style="font-size:12px;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ac:execute xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://ebsa.ipt.com/aCloudCommand-1.1 aCloudCommand-1.1.xsd&quot; xmlns:ac=&quot;http://ebsa.ipt.com/aCloudCommand-1.1&quot;&gt;
  &lt;ac:EnvironmentContainer command=&quot;confirm&quot; strategy=&quot;exists&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt;
    &lt;ac:Environment command=&quot;confirm&quot; strategy=&quot;exists&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt;
      &lt;ac:VirtualMachineContainer command=&quot;confirm&quot; strategy=&quot;exists&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt;			 
      &lt;/ac:VirtualMachineContainer&gt;
    &lt;/ac:Environment&gt;
  &lt;/ac:EnvironmentContainer&gt;
&lt;/ac:execute&gt;</pre>
</div></div><p>This uses the &quot;exists&quot; strategy (again see resolveConfirmStrategy() <span> in com.ipt.ebsa.agnostic.client.strategy.StrategyHandler</span>), which checks that every component in src/test/resources/aws/testEnvironmentDefinition.xml already exists; if a single machine is missing, the test will fail.</p><p> </p><p>4) Finally, there's \src\test\resources\aws\deleteEnvironment.xml</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="brush: java; gutter: false; theme: Confluence" style="font-size:12px;">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;ac:execute xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://ebsa.ipt.com/aCloudCommand-1.1 aCloudCommand-1.1.xsd&quot; xmlns:ac=&quot;http://ebsa.ipt.com/aCloudCommand-1.1&quot;&gt;
  &lt;ac:EnvironmentContainer command=&quot;create&quot; strategy=&quot;merge&quot; errorStrategy=&quot;exit&quot; includes=&quot;.*&quot;&gt;
    &lt;ac:Environment command=&quot;delete&quot; strategy=&quot;merge&quot; errorStrategy=&quot;exit&quot; includes=&quot;UNITTESTAmazonTestEnv1&quot;/&gt;
    &lt;/ac:EnvironmentContainer&gt;
&lt;/ac:execute&gt;</pre>
</div></div><p>This uses the &quot;delete&quot; strategy, which deletes every item in the src/test/resources/aws/testEnvironmentDefinition.xml file to clean up after the test case.</p><h2 id="EBA-SampleExecutionPlans-aCloudCommandSchemaelementsandattributes"><span>aCloudCommand Schema elements and attributes<br /></span></h2><p><span>The XML Execution plans must conform to <span>aCloudCommand-1.1.xsd</span>. The root element is &lt;ac:execute&gt;  which packages up a set of instructions to execute. Under that there is an EnvironmentContainer which can have OrganisationNetwork(s), EdgeGateway(s), and Environment(s). Environments have VirtualMachineContainers, which have VirtualMachine(s) and ApplicationNetwork(s). As a very rough analogy, an Environment Container is an entire Datacentre of VM's with its own company-level network, an Environment might be a programme of many applications, and each actual application would be in its own VirtualMachineContainer with the actual databases/webservers in a VirtualMachine element. </span></p><p><span><br /></span></p><p><span><br /></span></p><p><span><span><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/63242319/65472613.png" data-image-src="attachments/63242319/65472613.png" data-unresolved-comment-count="0" data-linked-resource-id="65472613" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="aCloudCommand-1.1.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="63242319" data-linked-resource-container-version="23"></span></span></span></p><p><span><span><span>All elements from EnvironmentContainer downwards are based on the &quot;detail&quot; element in the xsd, which means they can have valid</span> attributes of;</span></span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Attribute</p><p> </p></th><th class="confluenceTh">Description</th></tr><tr><td colspan="1" class="confluenceTd">command</td><td colspan="1" class="confluenceTd"><p>A command which can be applied to the entity. See the &quot;Command&quot; table below for more details.</p></td></tr><tr><td class="confluenceTd">includes</td><td class="confluenceTd"><p>Regular expression to match the name(s) of the entities being referred to.</p></td></tr><tr><td class="confluenceTd">excludes</td><td class="confluenceTd"><p>Regular expression to exclude the name(s) of the entities not being referred to.</p></td></tr><tr><td class="confluenceTd">strategy</td><td class="confluenceTd">Some commands require further details, in these cases a strategy can be provided to give the engine some processing choices. See the &quot;Strategy&quot; table below for more details;</td></tr><tr><td class="confluenceTd">errorStrategy</td><td class="confluenceTd">One of a distinct set of supported strategies to execute on error. See the errorStrategy table below for values;</td></tr></tbody></table></div><h3 id="EBA-SampleExecutionPlans-CommandAttibute"><span><span>Command Attibute<br /></span></span></h3><p><span><span>Each element under &quot;EnvironmentContainer&quot; can take a &quot;command&quot; attribute, which tells the ACloud client to do the following actions;<br /></span></span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Command</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd"><p>create </p></td><td class="confluenceTd">This will cause the given entity to be created</td></tr><tr><td class="confluenceTd">confirm</td><td class="confluenceTd">This will succeed if the given entity already exists</td></tr><tr><td class="confluenceTd">confirmHdd</td><td class="confluenceTd">This confirms the Hard Drive space allocated matches the value in the configuration file</td></tr><tr><td class="confluenceTd">delete</td><td class="confluenceTd">This will delete the given entity</td></tr><tr><td class="confluenceTd">start</td><td class="confluenceTd">This will start the given entity</td></tr><tr><td colspan="1" class="confluenceTd">stop</td><td colspan="1" class="confluenceTd">This will stop the given entity</td></tr><tr><td colspan="1" class="confluenceTd"><p>suspend</p></td><td colspan="1" class="confluenceTd">This will suspend the given entity</td></tr><tr><td colspan="1" class="confluenceTd"><p>resume</p></td><td colspan="1" class="confluenceTd">This will resume the given entity</td></tr><tr><td colspan="1" class="confluenceTd">reboot</td><td colspan="1" class="confluenceTd">This will reboot the given entity</td></tr><tr><td colspan="1" class="confluenceTd">shutdown</td><td colspan="1" class="confluenceTd">This will shutdown the given entity</td></tr><tr><td colspan="1" class="confluenceTd"><p>deploy</p></td><td colspan="1" class="confluenceTd">This will deploy the given entity</td></tr><tr><td colspan="1" class="confluenceTd">undeploy</td><td colspan="1" class="confluenceTd">This will undeploy the given entity</td></tr><tr><td colspan="1" class="confluenceTd">updateStartSection</td><td colspan="1" class="confluenceTd"> </td></tr></tbody></table></div><h3 id="EBA-SampleExecutionPlans-The&quot;Includes&quot;attribute"><span>The &quot;Includes&quot; attribute</span></h3><p><span>The includes attribute is a regular expression that tells the parser to only include elements that match the regular expression given - in the case of &quot;.*&quot; this means everything. You could <span>create all &lt;ac:VirtualMachine&gt;'s starting with the regular expression /[a-z/]{3}e (&quot;3 lowercase letters followed by an 'e'&quot;) </span>by using this; </span></p><pre class="code"><code><span class="tag">&lt;<span class="title">ac:VirtualMachine</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span> <span class="attribute">includes</span>=<span class="value">&quot;[a-z]{3}e.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span>/&gt;</span></code></pre><p><span><span>Look at selectPatternMatchedComponents in <span>com.ipt.ebsa.agnostic.client.controller.Controller to see how the regexp's in statements like includes=&quot;.*&quot; are executed.</span></span></span></p><h3 id="EBA-SampleExecutionPlans-The&quot;Excludes&quot;attribute"><span>The &quot;Excludes&quot; attribute</span></h3><p><span>The excludes attribute is a regular expression that tells the parser to exclude elements that match the regular expression given - in the case of &quot;.*&quot; this means everything. You could <span>create all &lt;ac:VirtualMachine&gt;'s except those starting with the regular expression /[a-z/]{3}e (&quot;3 lowercase letters followed by an 'e'&quot;) </span>by using this; </span></p><pre class="code"><code><span class="tag">&lt;<span class="title">ac:VirtualMachine</span> <span class="attribute">command</span>=<span class="value">&quot;create&quot;</span> <span class="attribute">excludes</span>=<span class="value">&quot;[a-z]{3}e.*&quot;</span> <span class="attribute">strategy</span>=<span class="value">&quot;merge&quot;</span> <span class="attribute">errorStrategy</span>=<span class="value">&quot;exit&quot;</span>/&gt;</span></code></pre><h3 id="EBA-SampleExecutionPlans-StrategyAttribute">Strategy Attribute</h3><p>Each element under &quot;EnvironmentContainer&quot; can take a &quot;strategy&quot; attribute, which tells the ACloud client how to go about performing the given command.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh"><p>Strategy</p></th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">createOnly</td><td class="confluenceTd">This strategy will expect that it will be creating all entities.  It will fail if an entity already exists.</td></tr><tr><td class="confluenceTd">merge</td><td class="confluenceTd">This strategy will expect that some entities might already exist.  It will only create those entities that do not already exist.</td></tr><tr><td class="confluenceTd">createOnlyWait</td><td class="confluenceTd">This strategy will expect that it will be creating all entities.  It will fail if an entity already exists. It will then block until the instance is started.</td></tr><tr><td class="confluenceTd">mergeWait</td><td class="confluenceTd">This strategy will expect that some entities might already exist.  It will only create those entities that do not already exist. It will then block until the instance is started.</td></tr><tr><td class="confluenceTd"> overwrite</td><td class="confluenceTd"> This strategy will overwrite previously existing entities.</td></tr><tr><td colspan="1" class="confluenceTd">exists</td><td colspan="1" class="confluenceTd">This strategy will succeed if an element is confirmed to exist.</td></tr><tr><td colspan="1" class="confluenceTd">doesnotexist</td><td colspan="1" class="confluenceTd">This strategy will succeed if an element is confirmed not to exist.</td></tr></tbody></table></div><p>The logic for the above strategies lives largely in the createXYZ methods in com.ipt.ebsa.agnostic.client.aws.manager.AwsCloudManager (for AWS) or com.ipt.ebsa.agnostic.client.skyscape.manager.SkyscapeCloudManager (for Skyscape). See also resolveCreateStrategy in com.ipt.ebsa.agnostic.client.strategy.StrategyHandler</p><h3 id="EBA-SampleExecutionPlans-ErrorStrategyAttribute">ErrorStrategy Attribute</h3><p>Each element under &quot;EnvironmentContainer&quot; can take an &quot;ErrorStrategy&quot; attribute, which tells the ACloud client what to do in case an error occurs. <span>The logic for these errorStrategy's lives in <span>com.ipt.ebsa.agnostic.client.controller under manageError(). </span></span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">ErrorStrategy</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">exit</td><td class="confluenceTd">This strategy will stop processing immediately and leave the system in whatever state it is in at the moment of error.</td></tr><tr><td class="confluenceTd">cleanAndExit</td><td class="confluenceTd">This strategy will attempt to leave the system in a state which is clean, ideally it will return the system to the state it was in prior to execution of the job. <span><span>Note that cleanAndExit falls through to the &quot;exit&quot; strategy in <span><span>com.ipt.ebsa.agnostic.client.controller under manageError()</span></span> - you would need to add in your own clean-up logic.</span></span></td></tr><tr><td class="confluenceTd">continue</td><td class="confluenceTd">This strategy will report the error and continue as if nothing had happened</td></tr><tr><td class="confluenceTd">optimistic</td><td class="confluenceTd">Optimistic error handling (not currently implemented)</td></tr></tbody></table></div><h2 id="EBA-SampleExecutionPlans-Javaentrypoints"><span>Java entry points<br /></span></h2><p><span>The entry point to the ACloud parser is in AgnosticClientCLI.java's main() method as described <a href="EBA---ACloud_61115560.html#EBA-ACloud-CommandlineAcloudexample">here</a>. Most of the logic is in controller.execute() method in com.ipt.ebsa.agnostic.client.controller, which walks the XML definition file as created by the Visio stencil, creating a set of objects in the same order as they appear in the XML. This is then passed into <span>AwsCloudManager</span> (or SkyscapeCloudManager for Skyscape deployments), which uses reflection to determine what the createXYZ method required is and passes the request on to something like <span><span>AwsCloudManager.</span>createVirtualMachine()</span> to create a VM instance, <span><span>AwsCloudManager.</span>createApplicationNetwork()</span> to create an ApplicationNetwork etc. These createApplicationNetwork() methods load data from execution plans like above to control their behaviour using a case statement; e.g. in the case that the createOnlyWait strategy was in the execution plan for the ApplicationNetwork, the above method would call createApplicationNetwork() followed by waitForInstanceStatus() and waitForConsoleOutput() before carrying on. </span></p><p> </p><p> </p>
                    </div>

                                        
                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
