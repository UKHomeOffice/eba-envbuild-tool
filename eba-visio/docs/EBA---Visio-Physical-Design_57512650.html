<!DOCTYPE html>
<html>
    <head>
        <title>EBA - Visio Physical Design</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            EBA - Visio Physical Design
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    
                    <div id="main-content" class="wiki-content group">
                    <p>We have developed an environment build capability to make environment builds easy, efficient and repeatable. The infrastructure designs are the first step to the build automation which are designed in Visio to model / visualise the physical operation model. These models represent a specific instance of a physical environment. The following sections outline the process followed and how to efficiently construct a design to support the Environment Build Automation (EBA) process.</p><p><style type='text/css'>/*<![CDATA[*/
div.rbtoc1455122398233 {padding: 0px;}
div.rbtoc1455122398233 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1455122398233 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1455122398233'>
<ul class='toc-indentation'>
<li><a href='#EBA-VisioPhysicalDesign-Workflow'>Workflow</a></li>
<li><a href='#EBA-VisioPhysicalDesign-Provideragnosticschemas'>Provider agnostic schemas</a>
<ul class='toc-indentation'>
<li><a href='#EBA-VisioPhysicalDesign-Configurationschema'>Configuration schema</a></li>
<li><a href='#EBA-VisioPhysicalDesign-Commandschema'>Command schema</a></li>
</ul>
</li>
<li><a href='#EBA-VisioPhysicalDesign-VisioCustomisation'>Visio Customisation</a></li>
<li><a href='#EBA-VisioPhysicalDesign-DesignProcess'>Design Process</a></li>
<li><a href='#EBA-VisioPhysicalDesign-VisioStencilelements'>Visio Stencil elements</a></li>
<li><a href='#EBA-VisioPhysicalDesign-VisioShapedata'>Visio Shape data</a></li>
<li><a href='#EBA-VisioPhysicalDesign-VisioExportConfigurationdata'>Visio Export Configuration data</a></li>
<li><a href='#EBA-VisioPhysicalDesign-MandatoryRules'>Mandatory Rules</a>
<ul class='toc-indentation'>
<li><a href='#EBA-VisioPhysicalDesign-HeartbeatandReplicationvLANs'>Heartbeat and Replication vLANs</a></li>
<li><a href='#EBA-VisioPhysicalDesign-Build-ornottobuild'>Build - or not to build</a></li>
</ul>
</li>
<li><a href='#EBA-VisioPhysicalDesign-MetaDataRequirements'>Meta Data Requirements</a></li>
<li><a href='#EBA-VisioPhysicalDesign-OrganisationNetworksandApplicationNetworks'>Organisation Networks and Application Networks</a></li>
<li><a href='#EBA-VisioPhysicalDesign-SecurityCompartments'>Security Compartments</a></li>
<li><a href='#EBA-VisioPhysicalDesign-UsefulPages'>Useful Pages</a></li>
</ul>
</div></p><h2 id="EBA-VisioPhysicalDesign-Workflow">Workflow</h2><p>This diagram shows the suggested workflow for producing the physical designs for automated build purposes.</p><p>

<map id="gliffy-map-57512710-4803" name="gliffy-map-57512710-4803"></map>
<table width="100%" class="gliffy-macro-table">
    <tr>
        <td >
            <table class="gliffy-macro-inner-table">
                <caption align="bottom">
 </caption>

                <tr>
                    <td>
                        <img style="border: none; width: 720px;" usemap="#gliffy-map-57512710-4803" src="attachments/57512650/57512711.png" alt="" class="gliffy-macro-image"/>
                    </td>
                </tr>
            </table>
 
        </td>
    </tr>
</table>


</p><h2 id="EBA-VisioPhysicalDesign-Provideragnosticschemas">Provider agnostic schemas</h2><p>These are a pair of XML schemas that define the physical environments (the configuration schema) and the actions that can be performed upon them (the command schema) in general, cloud provider neutral terms. The EBA Visio Physical Design to will export environment designs in accordance with the configuration schema. The EBA ACloud tool takes that design, in XML, together with a build plan (an XML file conforming to the agnostic command schema) to provision the design with the chosen cloud provider.</p><h3 id="EBA-VisioPhysicalDesign-Configurationschema">Configuration schema</h3><p class="external-link">The XML schema (AgnosticCloudConfig-1.0.xsd) can be found in the UKHomeOffice/EnvironmentBuildAutomation-VisioStencil GitHub repository.</p><p>Defines the entities of a physical environment e.g. the VMs and networks. Used throughout the end to end solution starting with the Visio XML export right through to the ACloud client. Follow this link for the rationale in creating the <a href="EBA---Agnostic-Cloud-Schema_64881745.html">agnostic cloud environment configuration schema</a>.</p><h3 id="EBA-VisioPhysicalDesign-Commandschema">Command schema</h3><p><span class="external-link">The command XML schema (aCloudCommand-1.0.xsd) can be found in the </span>UKHomeOffice/EnvironmentBuildAutomation-ACloud GitHub repository.</p><p>Defines commands that can be performed on entities within the physical environment e.g. create VM, stop VM, etc. Used when creating Build Plans to describe the steps needed to build the entities of a physical environment.</p><h2 id="EBA-VisioPhysicalDesign-VisioCustomisation">Visio Customisation</h2><p>All physical designs are drawn within Microsoft Visio (version should be no earlier than 2010) using a custom stencil; this process speeds up design time and forces data integrity as each shape within the stencil contains shape data adhering to the EBA environment agnostic schema - the data that defines the environments.</p><p>There are two separate designs to cater for different requirements:</p><ul><li>Geographic - conta<span style="color: rgb(0,0,0);">ins organisational networks an</span>d datacentres;</li><li>Environment - contains virtual machine containers, along with its appropriate VMs and application networks.</li></ul><p>The stencil contains appropriate shape data to cater for these designs. The stencil (EBA Stencil - Environment.vss ) can be found in the UKHomeOffice/EnvironmentBuildAutomation-VisioStencil GitHub repository.  In the longer term, other tools may be used, however the only requirement for the automated build is that the data can be extracted into the <u>provider agnostic data model</u>. </p><p>The tools currently cater for Skyscape (VMware) and AWS (Amazon Web Services). The following table shows how Amazon Virtual Private Clouds (VPC) and VmWare virtual applications (vApps) fit into the agnostic data model.</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Agnostic</th><th class="confluenceTh">VMware (Skyscape)</th><th class="confluenceTh">Amazon Web Services (AWS)</th></tr><tr><td class="confluenceTd">Environment Container</td><td class="confluenceTd"> </td><td class="confluenceTd">Virtual Private Cloud (VPC)</td></tr><tr><td class="confluenceTd">Virtual Machine Container</td><td class="confluenceTd">vApp</td><td class="confluenceTd"> </td></tr><tr><td class="confluenceTd">Account</td><td class="confluenceTd">Organisation</td><td class="confluenceTd">Account</td></tr></tbody></table></div><h2 id="EBA-VisioPhysicalDesign-DesignProcess">Design Process</h2><p>Before beginning a design, the logical design must be reviewed to understand the environments requirements and VM specification; this can speed up the overall process as less review time may be required.  <u>The design should not be started without being aware of the full requirements.</u></p><p>An 'Export from Visio' function has been written using VBA (the language compatible with Visio), which is triggered via a button (Fig 1) located within a Visio document (Visio Export.vsd) that can be found in the UKHomeOffice/EnvironmentBuildAutomation-VisioExport GitHub repository.</p><p>           <strong>  Fig 1. </strong>   <strong> </strong><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/57512650/65481544.png" data-image-src="attachments/57512650/65481544.png" data-unresolved-comment-count="0" data-linked-resource-id="65481544" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="tmp.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></p><p>Once a design has been drawn using the stencil, the model can be exported into XML format conforming to the provider agnostic data model. The process is &quot;natural&quot; and easy to use; it is as simple as dragging and dropping the shapes, from the stencil onto a new sheet. When the 'Export' button is triggered, the user is able to choose their desired design to export - it will then force version history to be maintained and automatically updates the version number of the design (Fig 2).</p><p style="margin-left: 60.0px;"><strong>Fig 2.</strong>    <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114346.png" data-image-src="attachments/57512650/61114346.png" data-unresolved-comment-count="0" data-linked-resource-id="61114346" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig2.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></p><p>The user is required to provide a detailed description of the changes made and also a name (Figs 3, 4) - the date will be populated automatically. The exported XML and Visio design can then be reviewed and committed into the desired Version Control System. The exported XML will be used later on during the automated creation of the environments.</p><p><strong>Note:</strong> The exported XML outputs into the same folder as the design. It should be moved to a location compatible with your workflow. Also note that the Export Virtual Machine Container button will create a file called &lt;Name of Worksheet&gt;.xml and the Export Organisational Network button will create a file called &lt;Name of Design File&gt;.xml.  If using the same name for worksheet and file remember that both buttons will write to the same file in that circumstance so manage your workflow accordingly.</p><p style="margin-left: 60.0px;"><strong> Fig 3. </strong>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114348.png" data-image-src="attachments/57512650/61114348.png" data-unresolved-comment-count="0" data-linked-resource-id="61114348" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig3.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></p><p style="margin-left: 60.0px;"><strong><strong>Fig 4. </strong>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114349.png" data-image-src="attachments/57512650/61114349.png" data-unresolved-comment-count="0" data-linked-resource-id="61114349" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig4.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span>     </strong></p><p style="margin-left: 60.0px;"><strong>                 </strong></p><p><strong>Note:</strong> The Export tool requires MSXML 4.0 or higher, if you get a &quot;Run-time error '429' ActiveX component can't create object&quot; then open the VB editor, click tools - references and enable &quot;Microsoft XML v4.0&quot;. Alternatively, the code will work perfectly fine if you change it to use MSXML6 with Set docObject = CreateObject(&quot;Msxml2.DOMDocument.6.0&quot;) and Set schemaObject = CreateObject(&quot;Msxml2.XMLSchemaCache.6.0&quot;) instead of Set docObject = New DOMDocument40 and Set schemaObject = New XMLSchemaCache40.</p><h2 id="EBA-VisioPhysicalDesign-VisioStencilelements">Visio Stencil elements</h2><p>The stencil has the following shape elements that can be used in designing the infrastructure;</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/66420902.png" data-image-src="attachments/57512650/66420902.png" data-unresolved-comment-count="0" data-linked-resource-id="66420902" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Visio stencil.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Stencil Element</th><th class="confluenceTh">Description</th></tr><tr><td class="confluenceTd">VirtualMachineContainer</td><td class="confluenceTd">This is the vApp in Skyscape/VM Ware terms, which is a set of virtual machines and networks that are grouped together to perform a given function.</td></tr><tr><td class="confluenceTd">Compartment</td><td class="confluenceTd">This is the Security Compartment; more details below</td></tr><tr><td class="confluenceTd">EnvironmentContainer</td><td class="confluenceTd">This lists a set of attributes describing the entire diagram, e.g. whether it's production (&quot;PR&quot;) or non-production (&quot;NP&quot;, or &quot;NPA&quot; for non-production Amazon), the provider, the region, the environment name etc.</td></tr><tr><td class="confluenceTd">ManagementNetwork</td><td class="confluenceTd">This is a Management Network, very similar to an application network, but used for management traffic e.g. startup/shutdown commands, releases, puppet updates etc. Coloured in blue to make it easy to distinguish on the diagram.</td></tr><tr><td class="confluenceTd">ApplicationNetwork</td><td class="confluenceTd">This is an Application Network that transfers data between applications. It can have 2 types, &quot;Application&quot; or &quot;Organisational&quot;. An &quot;Application&quot;-network transfers data between machines in the same EnvironmentContainer, and an &quot;Organisational&quot;-network transfers data between different EnvironmentContainers. Organisational networks generally represent an organisation's backbone network</td></tr><tr><td class="confluenceTd">ClusterNetwork</td><td class="confluenceTd">This is a pair of VM's typically used as a High Availability (HA) Postgres cluster, with a heartbeat network keeping the two nodes in contact and a replication network to ensure both databases are up to date.</td></tr><tr><td class="confluenceTd">Router/Firewall Host</td><td class="confluenceTd">This is a router/firewall VM box</td></tr><tr><td class="confluenceTd">Router/Firewall Host x2</td><td class="confluenceTd">This is 2 router/firewall VM boxes, to make the diagrams clearer. 2 VM's will be instantiated in the cloud for this element.</td></tr><tr><td class="confluenceTd">Other Host</td><td class="confluenceTd">This is a general purpose VM to run application code on</td></tr><tr><td class="confluenceTd">Other Host x2</td><td class="confluenceTd">Use this to instantiate 2 general purpose VM's (e.g. for load balancing etc) with identical parameters but different instance numbers</td></tr><tr><td class="confluenceTd">Other Host x3</td><td class="confluenceTd">Use this to instantiate 3 general purpose VM's (e.g. in a cluster, or load balanced etc)</td></tr><tr><td class="confluenceTd">Other Host x4</td><td class="confluenceTd">Use this to instantiate 4 general purpose VM's (e.g. in a cluster, or load balanced etc)</td></tr><tr><td class="confluenceTd">Other Host x9</td><td class="confluenceTd">Use this to instantiate 9 general purpose VM's (e.g. in a cluster, or load balanced etc)</td></tr><tr><td class="confluenceTd">IT Health Check Host</td><td class="confluenceTd">This is a VM to run IT health checks on, it's the same as an &quot;Other Host&quot; element except coloured green in Visio</td></tr><tr><td class="confluenceTd">Management NIC</td><td class="confluenceTd">This is a Network Interface Controller (NIC) that connects a VM or Router to the Management network</td></tr><tr><td class="confluenceTd">Heartbeat/Replication label</td><td class="confluenceTd">This is just a label to show which VM's are clustered</td></tr><tr><td class="confluenceTd">TextBox</td><td class="confluenceTd">A text box to label the diagram with. Not instantiated in the cloud.</td></tr><tr><td colspan="1" class="confluenceTd">Application NIC</td><td colspan="1" class="confluenceTd">This is a Network Interface Controller (NIC) that connects a VM or Router to an application network to transfer application data</td></tr></tbody></table></div><h2 id="EBA-VisioPhysicalDesign-VisioShapedata">Visio Shape data</h2><p>Some of the data required for implementing a physical design is embedded in the Visio Stencil. The following highlights the shape data that a user might wish to customise to suit their specific circumstances prior to use. If you are not familiar with how to do this, then refer to the relevant <a href="https://support.office.com/en-SG/article/Edit-a-master-shape-8b74915c-6ae4-4051-89f2-c1972bd62c87" class="external-link" rel="nofollow">Microsoft Office online documentation</a>.</p><p> </p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Shape</th><th class="confluenceTh">Shape Data to customise</th><th class="confluenceTh">Explanation</th></tr><tr><td class="confluenceTd">Environment Container</td><td class="confluenceTd">name</td><td class="confluenceTd">The name attribute of the Environment Container is a fixed list to help enforce the <a href="EBA---Infrastructure-Naming-Standards_58295113.html">Infrastructure Naming Standards</a>. This list should be populated with the set of environment names that make sense in the users environment.</td></tr><tr><td colspan="1" class="confluenceTd">Environment Container</td><td colspan="1" class="confluenceTd">dataCentreName</td><td colspan="1" class="confluenceTd">This list should be populated with a list of the cloud provider data centre names that your cloud provider offers. This enables the correct data centre to be specified as part of the design.</td></tr><tr><td class="confluenceTd">Virtual machine Container</td><td class="confluenceTd">serviceLevel</td><td class="confluenceTd"><p>The service level is being used to determine two skyscape attributes, Service Level and Storage Profile. The combination of Service Level and Storage Profile exported to the XML for a given serviceLevel defined for a Virtual Machine Container is determined by configuration data that the export process will refer to and that should be set appropriately for your use (see the src\VisioExportConfig.xls file)</p><p>The serviceLevel is set to &lt;blank&gt; for an AWS environment - this cloud configuration tailoring is not yet implemented in these tools for AWS.</p></td></tr><tr><td colspan="1" class="confluenceTd">templateName</td><td colspan="1" class="confluenceTd">All Host shapes</td><td colspan="1" class="confluenceTd">The templateName is used to give a) a visual indication of the OS image that the VM will run on the design - it appears in the text overlaying each host shape and b) through configuration data used by the export process, it determines the actual image name, in the cloud, associated with the logical name.  For example a template name of &quot;MY_CO6.5&quot; might be intended to refer to your CentOS v6.5 image that you have uploaded to AWS and known in AWS as, for example,&quot;ami_a5b7e2189&quot;.</td></tr></tbody></table></div><h2 id="EBA-VisioPhysicalDesign-VisioExportConfigurationdata">Visio Export Configuration data</h2><p>The user should populate the Visio Export Configuration file (EBA-visio\src\VisioExportConfig.xls from the source code) to hold data that corresponds to the stencil data. The configuration file consist of three worksheets as follows:</p><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Worksheet</th><th class="confluenceTh">Purpose</th></tr><tr><td class="confluenceTd">Default Service levels</td><td class="confluenceTd"><p>This is a Skyscape specific setting - not required for Amazon. This worksheet is set up to allow a template Service Level and a Storage Profile to be configured for a given Storage Level. It consists of the following columns:</p><ul><li>Service Level</li><li>template Service Level (this is the VDC name in Skyscape)</li><li>Storage Profile (this is the Storage Policy in Skyscape)</li></ul><p>This mapping is only invoked if the Storage Policy for a host (see <span style="color: rgb(255,0,0);"><span style="color: rgb(51,51,51);"><a href="Metadata-Requirements_61112815.html">Metadata Requirements</a></span></span>) is non-blank. Leaving the storage policy blank invokes the mapping specified on this worksheet.</p><p>Essentially, the Service level set in Visio maps to a VDC+storage profile in Skyscape; you might e.g. have a Service Level=&quot;Performance_test&quot; which could map to the QA VDC and SSD-storage profile as required.</p><p> </p></td></tr><tr><td class="confluenceTd">VM Templates</td><td class="confluenceTd"><p>This worksheet specifies the customisation script that will be run against a host after the Operating System specified has been applied. The customisation script is presumed to end in &quot;.sh&quot; and should not be repeated in the worksheet, for example if your script is called &quot;customise-rhel-general.sh&quot; then &quot;customise-rhel-general&quot; should be the value used in this worksheet. </p><p>This worksheet also specifies the operating system image names of the operating system images that you have pre-loaded to your cloud provider.</p><p>The worksheet consists of the following columns:</p><ul><li>Template Name</li><li>Skyscape Customisation Script</li><li>AWS Customisation Script</li><li>Skyskape Image</li><li>AWS Image</li></ul><p>Note that there should be one row in the worksheet for each templateName (see stencil data in table above). If a templateName is used from the stencil with no corresponding row in this worksheet, then an error will occur when you attempt to export the design.</p></td></tr><tr><td colspan="1" class="confluenceTd">Environments</td><td colspan="1" class="confluenceTd"><p>This worksheet specifies which of your environments, specified as the &quot;name&quot; attribute of the &quot;Environment Container&quot; shape (see stencil data in table above), is valid per cloud environment. This worksheet consist of three columns:</p><ul><li>AWS Environment</li><li>Skyscape Environment</li><li>AWS Hardware Profiles</li></ul><p>The AWS Environment and Skyscape Environment column should be populated with the environment names valid for the column, i.e. AWS and/or Skyscape, with a blank row signifying no more data, so do not leave blank rows in the middle of valid rows. These two columns do not have to contain the same number of entries.</p><p>The AWS Hardware Profiles column should be populated with the set of AWS hardware profiles that you wish to use in your designs (see <a href="https://aws.amazon.com/ec2/instance-types/" class="external-link" rel="nofollow">https://aws.amazon.com/ec2/instance-types/</a>).</p></td></tr></tbody></table></div><h2 id="EBA-VisioPhysicalDesign-MandatoryRules">Mandatory Rules</h2><ul><li>A design is created on 200% and all shapes must be drawn on the grid lines.  Also ensure all data is visible and clear to a viewer.</li><li>The documents name should be the same as the <em><strong>Virtual Machine Container</strong></em> name.</li><li>Where there a several hosts, ensure all VMs are aligned neatly on two rows, on the grid lines.</li><li>Once a grouped VM has been dragged onto a sheet from the stencil, one will notice not all the shapes sit on the grid lines; DO NOT align them, but instead align <u>only</u> the first VM as a group.</li><li>Shapes should only be created by using the stencil.  Do not cut and paste, or copy and paste shapes as this could lead to errors in the metadata for an object in the model.  This will result in errors in the environment build automation.</li><li>Only edit the metadata using the Shape Data window.  Do not edit the text directly on the shape.</li><li>The stencil must be imported into Visio to be used by using 'File-Open'.</li><li>Each Visio design document should contain <em><strong>one and ONLY one</strong></em> 'Environment Container' (Fig 5). It provides options for:<ul><li>name</li><li>drop-down list of cloud providers (Skyscape or AWS)</li><li>classless inter domain routing (cidr)</li><li>data centre<strong><span style="color: rgb(255,0,0);"><br /></span></strong></li><li>environment name<strong><span style="color: rgb(255,0,0);"><br /></span></strong></li></ul></li></ul><p style="margin-left: 30.0px;"><span style="color: rgb(255,0,0);"><strong>         <span style="color: rgb(0,0,0);"> Fig 5 .</span></strong> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/66421096.png" data-image-src="attachments/57512650/66421096.png" data-unresolved-comment-count="0" data-linked-resource-id="66421096" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Fig 5.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span><br /><span style="color: rgb(255,255,255);">.</span><strong><span style="color: rgb(0,0,0);"> </span></strong><span style="color: rgb(0,0,0);"><br /></span></span></p><ul><li>Each Visio design document should contain <em><strong>one</strong><strong> and only one</strong></em> 'VirtualMachineContainer'. It consists of:<ul><li>name</li><li>description</li><li>service level <strong><span style="color: rgb(255,0,0);"> </span></strong>(Leave blank for AWS).</li><li>domain</li></ul></li></ul><ul><li>Each Visio design should consist of <em><strong>only</strong></em> the following pages:<ul><li>Introduction</li><li>Version History</li><li>1 Environment Container  design</li></ul></li></ul><ul><li><p>An 'ApplicationNetwork' and 'ManagementNetwork' shapes can be found from the imported stencil, and need to be added (Fig 6). These shapes contain properties to cater for AWS VPC (Virtual Private Cloud) Peering.  A VPC is the equivalent of an environment group in the agnostic model.  VPC peering allows two environments to communicate with each other by linking the networks of different VPCs.  The master VPC does not need the peer information, but rather the child VPCs that connect to it would.  The master VPC is always the one that would be created first.  Peer information is only mentioned on organisation networks; this also applies to the gateway name:</p><ul><li><p>peerNetworkName - e.g. HO_IPT_NPA_CO_DAT1</p></li><li><p>peerEnvironmentName - e.g. HO_IPT_NPA_CO_DAT1_MABC</p></li><li><p>gatewayName</p></li></ul></li></ul><p style="margin-left: 60.0px;"><span class="confluence-embedded-file-wrapper"><strong>Fig 6.</strong><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114350.png" data-image-src="attachments/57512650/61114350.png" data-unresolved-comment-count="0" data-linked-resource-id="61114350" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig6.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></span><span style="color: rgb(255,255,255);"> <br /></span></p><p style="margin-left: 60.0px;"><span style="color: rgb(255,255,255);"><br /></span></p><ul><li>Each host should have a NIC 0, normally the management interface.</li><li>Where a NIC has a Virtual IP Address (VIP), remember to end the NIC name with '/0v'. E.g. artaa01/02/0v</li><li>When a VM is placed within the VM container ('Router/Firewall Host' and/or 'Other Host'), a user needs to ensure that it is connected to an 'Application NIC' or 'Management NIC' shape, and a NIC shape to an 'ApplicationNetwork' or 'ManagementNetwork' shape.  A user can check if they are connected by selecting the shape - a red square should appear at the end of the connector (Fig 8).</li><li>Security Compartments (Fig 7). All environments should use security compartments, starting with compartment E. The 'Compartment' shape can be found from the stencil once imported. Note that VMs will have their security compartment embedded in their names if following the <a href="EBA---Infrastructure-Naming-Standards_58295113.html">Infrastructure Naming Standards</a>. Application routers would be in compartment A, the management router in compartment C - see <a href="Security-Compartment-Principles_41488475.html">Security Compartment Principles</a><br /><br /></li></ul><p style="margin-left: 60.0px;"><br /><span class="confluence-embedded-file-wrapper"><strong>Fig 7.</strong><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114351.png" data-image-src="attachments/57512650/61114351.png" data-unresolved-comment-count="0" data-linked-resource-id="61114351" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig7.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></span><br /><span style="color: rgb(255,255,255);"> </span></p><ul><li>In the event a user wishes to add a new connection point elsewhere on the shape, press Shift+Ctrl+1. The connection points on the shapes will appear as small 'x' symbols (Fig 9); the user would then need to select the shape, hold down the Ctrl and place a connection point where necessary.  The user will then be able to add a new shape and drag one end to the desired connection point (Fig 10).<span style="color: rgb(255,0,0);"><br /></span></li><li>Ensure that when connecting to HA VM's, that the connector is linked to the primary VM and not the grouped shield (Fig 11<span style="color: rgb(255,0,0);"> <br /></span><strong>Fig 8.</strong><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/66421095.jpg" data-image-src="attachments/57512650/66421095.jpg" data-unresolved-comment-count="0" data-linked-resource-id="66421095" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Fig 8.jpg" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span><strong>          Fig 9.<span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/66421094.jpg" data-image-src="attachments/57512650/66421094.jpg" data-unresolved-comment-count="0" data-linked-resource-id="66421094" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig 9.jpg" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></strong><strong>   <br /></strong><strong>Fig 10.</strong><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/66421093.jpg" data-image-src="attachments/57512650/66421093.jpg" data-unresolved-comment-count="0" data-linked-resource-id="66421093" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig 10.jpg" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span>        <strong>Fig 11. <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114353.png" data-image-src="attachments/57512650/61114353.png" data-unresolved-comment-count="0" data-linked-resource-id="61114353" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig11.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></strong> </li></ul><p><strong>NOTE:</strong> All shapes must be connected, otherwise the XML export will not be successful. </p><p>Additional points to be aware of:</p><ul><li>To alter the shape data values, right-click the shape and select 'Data - Shape Data...'</li><li>To add or edit a property, right-click the shape and select 'Data - Define Shape Data...'</li><li>To insert a property onto the design, double click the shape until a text box appears and select 'Insert - Field - Shape Data'<br />Where there are multiple grouped VMs (this usually applies where HA is required), ensure the NIC shape is connected to the first box.  The 'Export from Visio' function will strip the information stated within the shape data to account for the rest of the VMs.  In addition, a user must ensure to populate all appropriate data to all VMs that are part of a grouped shape (shown in the stencil) (this currently does not populate automatically based on the specification of the first host).<br /><br />E.g. if there are 2 boxes, data must be populated twice, <span style="color: rgb(255,0,0);"> </span>however the hostname will altered accordingly.  Notice that the second host is selected; the hostname has altered, however the rest of the specification has stayed the same.<br /><br /></li></ul><p>                     <strong>Fig 12.  </strong>    <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/57512650/61114354.png" data-image-src="attachments/57512650/61114354.png" data-unresolved-comment-count="0" data-linked-resource-id="61114354" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig12.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span><br />                                          </p><ul><li>Where the provider is Skyscape, disk 1 should always and ONLY be 50. All other storage space is added to disk 2.  This may not be the case where the provider is otherwise.</li><li>The shape data does not support information regarding sub-boxes or additional sub-roles.  Therefore it would be useful to add a text box on the VM shape stating this information.</li></ul><ul><li>If a virtual machine container requires connectivity to another environment group, VPC Peering is required.  E.g HO_IPT_NPA_CTL1_CTZO would require connectivity to a management boundary control (MABC).  Therefore the network name would need to reflect this (Fig 13) - the name would begin with the Virtual machine Container name and end with the VPC peer master (Fig 14) - <a href="EBA---Infrastructure-Naming-Standards_58295113.html">Infrastructure Naming Standards</a></li></ul><p style="margin-left: 30.0px;"><br /><span class="confluence-embedded-file-wrapper"><strong>Fig 13.</strong><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114355.png" data-image-src="attachments/57512650/61114355.png" data-unresolved-comment-count="0" data-linked-resource-id="61114355" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig13.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span><br /><br /><strong> Fig 14.</strong><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114531.png" data-image-src="attachments/57512650/61114531.png" data-unresolved-comment-count="0" data-linked-resource-id="61114531" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig14.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></span></p><p style="margin-left: 30.0px;"> </p><ul><li>The first 3 addresses in each subnet are reserved by AWS - 1-3 are not available for use, therefore the available range is 4-254 in the 4th octet.  However, to avoid confusion, add 10 to the last octet of all IP addresses for environments hosted in AWS e.g. 10.x.x.1 --&gt; 10.x.x.11, 10.x.x.2 --&gt; 10.x.x.12, etc.<br /><br /></li></ul><ul><li>If there is a database VM within an environment, confirm<strong> </strong>whether it is to be HA configured. HA Postgres Databases have extra vLans - see Heartbeat and Replication vLANs below for more details.</li></ul><h3 id="EBA-VisioPhysicalDesign-HeartbeatandReplicationvLANs">Heartbeat and Replication vLANs</h3><p>Heartbeat and Replication vLANs connect multiple grouped VMs (i.e. a cluster) when required, typically for HA purposes. To avoid cluttering the diagram, they are defined separately to the right of the drawing, outside the Virtual Machine Container, under a red heading &quot;Heartbeat and Replication vLans&quot;</p><ul><li>Replication is defined for Postgres databases in an AP setup in order to transfer data from the active node to the passive node.  In the event fail over occurs, the passive node is up to date.</li><li>Heartbeat used to understand which node is active and which node is passive - defined for Postgres databases and Vyatta hosts.</li></ul><p style="margin-left: 60.0px;"><strong>Fig 15. </strong>   <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/57512650/61114534.png" data-image-src="attachments/57512650/61114534.png" data-unresolved-comment-count="0" data-linked-resource-id="61114534" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="fig15.png" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/png" data-linked-resource-container-id="57512650" data-linked-resource-container-version="63"></span></p><p>These are defined using the ClusterNetwork shape from the stencil:</p><ul><li>The Host shape only contains the vmName(s) (dbsam03/04 in this example). These must match to vmName(s) of hosts defined inside the Virtual Machine Container. The matching shapes inside the Virtual Machine Container define the rest of the host's properties (disk size etc).</li><li>The NIC shape works like the standard Application NIC shape. i.e. NIC names and IP addresses for each host are separated by a slash. A cluster network NIC should not be the primary NIC. Ensure each NIC is given an indexNumber which is unique for the Host it connects to.</li><li>The Network shape works like the standard Application Network shape. It's type can be &quot;Heartbeat&quot; or &quot;Replication&quot;.</li><li>The same Host and Network can appear in different ClusterNetwork shapes, if necessary.  </li><li><span style="color: rgb(255,0,0);"><a href="EBA---IP-Allocation-Standards_58294494.html">IP Allocation Standards</a><br /></span></li></ul><h3 id="EBA-VisioPhysicalDesign-Build-ornottobuild">Build - or not to build</h3><p>In the event you wish not to build a specific box within a Virtual Machine Container, the stencil contains a property which enables a user to prevent the host populating within the XML.  Using the host stencil, there is a property known as 'build' - this is a Boolean. The default value is 'TRUE'; if it is changed to 'FALSE', this informs the VBA macro, and the appropriate data will not be included in the XML.</p><p><strong>NOTE:</strong> When HA applies, all 'build' properties must be set to 'FALSE'. The reason for this is that there may be an occasion where a user would want to build one of the hosts, and not the other - this provides them with the ability to do this.</p><h2 id="EBA-VisioPhysicalDesign-MetaDataRequirements">Meta Data Requirements</h2><p><span style="color: rgb(255,0,0);"><span style="color: rgb(51,51,51);">The <a href="Metadata-Requirements_61112815.html">Metadata Requirements</a> <span style="color: rgb(255,0,0);"><span style="color: rgb(51,51,51);">identify which Visio stencil shape properties are required to be correctly populated for VmWare (Skyscape) and Amazon Web Services (AWS) provider designs.</span></span></span></span></p><h2 id="EBA-VisioPhysicalDesign-OrganisationNetworksandApplicationNetworks">Organisation Networks and Application Networks</h2><p>An Organisation Network is external to the VMC and can link multiple VM containers together. This would typically be the network backbone between sets of applications, and would tend to be generated once per datacentre then have applications connect onto them.</p><p>An Application Network is internal to the VMC and used to transport data between VM's in the same application. This would typically be updated along with every deployment of the application.</p><p>The Visio Export tool has two buttons, &quot;Export Organisation Network&quot; and &quot;Export Virtual Machine Container&quot;, which produce two different files. The &quot;Export Organisation Network&quot; button only exports the &quot;Organisation Network&quot; elements in the Visio, and the &quot;Export Virtual Machine Container&quot; button exports the rest - all the VM's, the application networks, the VMC settings etc. This is mainly so the Organisation Network doesn't have to be re-created every time an application is deployed.</p><h2 id="EBA-VisioPhysicalDesign-SecurityCompartments">Security Compartments</h2><p>A Security Compartment is a set of servers grouped together inside a firewall. The idea is defense in depth, i.e. to place firewalls between groups of logically connected servers, so e.g. if an attacker were to penetrate the application area they would not automatically have access to the database tier. The <a href="Security-Compartment-Principles_41488475.html">Security Compartment Principles</a> page lists the principles used in EBSA of when to put machines in different Security Compartments; basically the UI tier must be in a separate compartment to the application tier and the database tier. Multiple applications could reside in the same Security Compartment if they don't process business data on the way.</p><p>A Security Compartment is a single letter starting at &quot;D&quot;, so you might have &quot;D&quot; for UI's, compartment &quot;E&quot; for the applications and &quot;F&quot; for the databases as according to whatever naming convention was in use. From <a href="EBA---Infrastructure-Naming-Standards_58295113.html" rel="nofollow">EBA - Infrastructure Naming Standards</a>;</p><ul><li>Within a boundary control, the north router / firewall is assigned 'A', the south router is assigned 'B', the management router is assigned 'C', with subsequent letters being allocated to each security compartment within that boundary control.</li><li>Within a zone, the shared north / south router is assigned 'A', the management router is assigned 'B', with subsequent letters being allocated to each security compartment within that boundary control.</li></ul><p> </p><p>The Security Compartment stencil element is a label to enable a reviewer to quickly scan the VSD file and see where the security boundaries lie. The actual security compartment used for Hiera/Puppet facts is encapsulated in the 4th character of the Short Hostname as below; (from <a href="EBA---Infrastructure-Naming-Standards_58295113.html">EBA - Infrastructure Naming Standards</a>)</p><p><span class="confluence-embedded-file-wrapper"><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/58295113/58295106.jpg" data-image-src="attachments/58295113/58295106.jpg" data-unresolved-comment-count="0" data-linked-resource-id="58295106" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Host Name Standard3.jpg" data-base-url="https://<confluenceurl>" data-linked-resource-content-type="image/jpeg" data-linked-resource-container-id="58295113" data-linked-resource-container-version="20"></span></span></p><p>where wpx is a role (an Apache Web Proxy, as listed on <a href="VM-Role-Identifiers_24382975.html">VM Role Identifiers</a>), the &quot;d&quot; is Security Compartment d (as would need to be typed into the hostname shape data field in Visio), the m would signify it's Management network traffic (not application traffic) and the 01 that it's the 1st box of this type.</p><h2 id="EBA-VisioPhysicalDesign-UsefulPages">Useful Pages</h2><ul><li><a href="EBA---IP-Allocation-Standards_58294494.html">IP Allocation Standards</a></li><li><a href="EBA---Infrastructure-Naming-Standards_58295113.html">Infrastructure Naming Standards</a></li><li><a href="VM-Role-Identifiers_24382975.html">VM Role Identifiers</a></li><li><a href="Visio-Export---Knowledge-Base_58295391.html">Visio Export - Knowledge Base</a></li><li><a href="Security-Compartment-Principles_41488475.html">Security Compartment Principles</a></li><li><a href="36275591.html">VPC's and VPC Peer Vlans</a></li><li><span style="color: rgb(255,0,0);"><span style="color: rgb(51,51,51);"><a href="Metadata-Requirements_61112815.html">Metadata Requirements</a></span></span></li></ul><p> </p>
                    </div>

                                        
                    
                 
                </div>             </div> 
            
        </div>     </body>
</html>
